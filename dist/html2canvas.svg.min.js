/*
  html2canvas 0.5.0-beta4 <http://html2canvas.hertzen.com>
  Copyright (c) 2017 Niklas von Hertzen

  Released under  License
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(b.html2canvas||(b.html2canvas={})).svg=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g||b===l?62:b===h||b===m?63:b<i?-1:b<i+10?b-i+26+26:b<k+26?b-k:b<j+26?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;d<g;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;e<g;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0),l="-".charCodeAt(0),m="_".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],2:[function(a,b,c){},{}],3:[function(a,b,c){(function(b){"use strict";function d(){function a(){}try{var b=new Uint8Array(1);return b.foo=function(){return 42},b.constructor=a,42===b.foo()&&b.constructor===a&&"function"==typeof b.subarray&&0===b.subarray(1,1).byteLength}catch(c){return!1}}function e(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(a){return this instanceof f?(f.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof a?g(this,a):"string"==typeof a?h(this,a,arguments.length>1?arguments[1]:"utf8"):i(this,a)):arguments.length>1?new f(a,arguments[1]):new f(a)}function g(a,b){if(a=p(a,b<0?0:0|q(b)),!f.TYPED_ARRAY_SUPPORT)for(var c=0;c<b;c++)a[c]=0;return a}function h(a,b,c){"string"==typeof c&&""!==c||(c="utf8");var d=0|s(b,c);return a=p(a,d),a.write(b,c),a}function i(a,b){if(f.isBuffer(b))return j(a,b);if(Y(b))return k(a,b);if(null==b)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(b.buffer instanceof ArrayBuffer)return l(a,b);if(b instanceof ArrayBuffer)return m(a,b)}return b.length?n(a,b):o(a,b)}function j(a,b){var c=0|q(b.length);return a=p(a,c),b.copy(a,0,0,c),a}function k(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function l(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function m(a,b){return f.TYPED_ARRAY_SUPPORT?(b.byteLength,a=f._augment(new Uint8Array(b))):a=l(a,new Uint8Array(b)),a}function n(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function o(a,b){var c,d=0;"Buffer"===b.type&&Y(b.data)&&(c=b.data,d=0|q(c.length)),a=p(a,d);for(var e=0;e<d;e+=1)a[e]=255&c[e];return a}function p(a,b){f.TYPED_ARRAY_SUPPORT?(a=f._augment(new Uint8Array(b)),a.__proto__=f.prototype):(a.length=b,a._isBuffer=!0);var c=0!==b&&b<=f.poolSize>>>1;return c&&(a.parent=Z),a}function q(a){if(a>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|a}function r(a,b){if(!(this instanceof r))return new r(a,b);var c=new f(a,b);return delete c.parent,c}function s(a,b){"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"binary":case"raw":case"raws":return c;case"utf8":case"utf-8":return R(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return U(a).length;default:if(d)return R(a).length;b=(""+b).toLowerCase(),d=!0}}function t(a,b,c){var d=!1;if(b=0|b,c=void 0===c||c===1/0?this.length:0|c,a||(a="utf8"),b<0&&(b=0),c>this.length&&(c=this.length),c<=b)return"";for(;;)switch(a){case"hex":return F(this,b,c);case"utf8":case"utf-8":return B(this,b,c);case"ascii":return D(this,b,c);case"binary":return E(this,b,c);case"base64":return A(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function u(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;g<d;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function v(a,b,c,d){return V(R(b,a.length-c),a,c,d)}function w(a,b,c,d){return V(S(b),a,c,d)}function x(a,b,c,d){return w(a,b,c,d)}function y(a,b,c,d){return V(U(b),a,c,d)}function z(a,b,c,d){return V(T(b,a.length-c),a,c,d)}function A(a,b,c){return 0===b&&c===a.length?W.fromByteArray(a):W.fromByteArray(a.slice(b,c))}function B(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;e<c;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(e+h<=c){var i,j,k,l;switch(h){case 1:f<128&&(g=f);break;case 2:i=a[e+1],128===(192&i)&&(l=(31&f)<<6|63&i,l>127&&(g=l));break;case 3:i=a[e+1],j=a[e+2],128===(192&i)&&128===(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j,l>2047&&(l<55296||l>57343)&&(g=l));break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128===(192&i)&&128===(192&j)&&128===(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k,l>65535&&l<1114112&&(g=l))}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return C(d)}function C(a){var b=a.length;if(b<=$)return String.fromCharCode.apply(String,a);for(var c="",d=0;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=$));return c}function D(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;e++)d+=String.fromCharCode(127&a[e]);return d}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;e++)d+=String.fromCharCode(a[e]);return d}function F(a,b,c){var d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);for(var e="",f=b;f<c;f++)e+=Q(a[f]);return e}function G(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function H(a,b,c){if(a%1!==0||a<0)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function I(a,b,c,d,e,g){if(!f.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>e||b<g)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range")}function J(a,b,c,d){b<0&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);e<f;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function K(a,b,c,d){b<0&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);e<f;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function L(a,b,c,d,e,f){if(b>e||b<f)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");if(c<0)throw new RangeError("index out of range")}function M(a,b,c,d,e){return e||L(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(a,b,c,d,23,4),c+4}function N(a,b,c,d,e){return e||L(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(a,b,c,d,52,8),c+8}function O(a){if(a=P(a).replace(aa,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function P(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function Q(a){return a<16?"0"+a.toString(16):a.toString(16)}function R(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;g<d;g++){if(c=a.charCodeAt(g),c>55295&&c<57344){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(c<1114112))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function S(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function T(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);g++)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function U(a){return W.toByteArray(O(a))}function V(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}var W=a("base64-js"),X=a("ieee754"),Y=a("isarray");c.Buffer=f,c.SlowBuffer=r,c.INSPECT_MAX_BYTES=50,f.poolSize=8192;var Z={};f.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:d(),f.TYPED_ARRAY_SUPPORT?(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array):(f.prototype.length=void 0,f.prototype.parent=void 0),f.isBuffer=function(a){return!(null==a||!a._isBuffer)},f.compare=function(a,b){if(!f.isBuffer(a)||!f.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,g=Math.min(c,d);e<g&&a[e]===b[e];)++e;return e!==g&&(c=a[e],d=b[e]),c<d?-1:d<c?1:0},f.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(a,b){if(!Y(a))throw new TypeError("list argument must be an Array of Buffers.");if(0===a.length)return new f(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var d=new f(b),e=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(d,e),e+=g.length}return d},f.byteLength=s,f.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?B(this,0,a):t.apply(this,arguments)},f.prototype.equals=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a||0===f.compare(this,a)},f.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},f.prototype.compare=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?0:f.compare(this,a)},f.prototype.indexOf=function(a,b){function c(a,b,c){for(var d=-1,e=0;c+e<a.length;e++)if(a[c+e]===b[d===-1?0:e-d]){if(d===-1&&(d=e),e-d+1===b.length)return c+d}else d=-1;return-1}if(b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b>>=0,0===this.length)return-1;if(b>=this.length)return-1;if(b<0&&(b=Math.max(this.length+b,0)),"string"==typeof a)return 0===a.length?-1:String.prototype.indexOf.call(this,a,b);if(f.isBuffer(a))return c(this,a,b);if("number"==typeof a)return f.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,a,b):c(this,[a],b);throw new TypeError("val must be string, number or Buffer")},f.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},f.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},f.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b=0|b,isFinite(c)?(c=0|c,void 0===d&&(d="utf8")):(d=c,c=void 0);else{var e=d;d=b,b=0|c,c=e}var f=this.length-b;if((void 0===c||c>f)&&(c=f),a.length>0&&(c<0||b<0)||b>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(var g=!1;;)switch(d){case"hex":return u(this,a,b,c);case"utf8":case"utf-8":return v(this,a,b,c);case"ascii":return w(this,a,b,c);case"binary":return x(this,a,b,c);case"base64":return y(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,a,b,c);default:if(g)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),g=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;f.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c,a<0&&(a=0)):a>c&&(a=c),b<0?(b+=c,b<0&&(b=0)):b>c&&(b=c),b<a&&(b=a);var d;if(f.TYPED_ARRAY_SUPPORT)d=f._augment(this.subarray(a,b));else{var e=b-a;d=new f(e,(void 0));for(var g=0;g<e;g++)d[g]=this[g+a]}return d.length&&(d.parent=this.parent||this),d},f.prototype.readUIntLE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},f.prototype.readUIntBE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},f.prototype.readUInt8=function(a,b){return b||H(a,1,this.length),this[a]},f.prototype.readUInt16LE=function(a,b){return b||H(a,2,this.length),this[a]|this[a+1]<<8},f.prototype.readUInt16BE=function(a,b){return b||H(a,2,this.length),this[a]<<8|this[a+1]},f.prototype.readUInt32LE=function(a,b){return b||H(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},f.prototype.readUInt32BE=function(a,b){return b||H(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},f.prototype.readIntLE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},f.prototype.readIntBE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},f.prototype.readInt8=function(a,b){return b||H(a,1,this.length),128&this[a]?(255-this[a]+1)*-1:this[a]},f.prototype.readInt16LE=function(a,b){b||H(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt16BE=function(a,b){b||H(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt32LE=function(a,b){return b||H(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},f.prototype.readInt32BE=function(a,b){return b||H(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},f.prototype.readFloatLE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!0,23,4)},f.prototype.readFloatBE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!1,23,4)},f.prototype.readDoubleLE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!0,52,8)},f.prototype.readDoubleBE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!1,52,8)},f.prototype.writeUIntLE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},f.prototype.writeUIntBE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},f.prototype.writeUInt8=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,1,255,0),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},f.prototype.writeUInt16LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeUInt16BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeUInt32LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):K(this,a,b,!0),b+4},f.prototype.writeUInt32BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=0,g=1,h=a<0?1:0;for(this[b]=255&a;++f<c&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=a<0?1:0;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeInt8=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,1,127,-128),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),a<0&&(a=255+a+1),this[b]=255&a,b+1},f.prototype.writeInt16LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeInt16BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeInt32LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):K(this,a,b,!0),b+4},f.prototype.writeInt32BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeFloatLE=function(a,b,c){return M(this,a,b,!0,c)},f.prototype.writeFloatBE=function(a,b,c){return M(this,a,b,!1,c)},f.prototype.writeDoubleLE=function(a,b,c){return N(this,a,b,!0,c)},f.prototype.writeDoubleBE=function(a,b,c){return N(this,a,b,!1,c)},f.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("sourceStart out of bounds");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,g=d-c;if(this===a&&c<b&&b<d)for(e=g-1;e>=0;e--)a[e+b]=this[e+c];else if(g<1e3||!f.TYPED_ARRAY_SUPPORT)for(e=0;e<g;e++)a[e+b]=this[e+c];else a._set(this.subarray(c,c+g),b);return g},f.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),c<b)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(b<0||b>=this.length)throw new RangeError("start out of bounds");if(c<0||c>this.length)throw new RangeError("end out of bounds");var d;if("number"==typeof a)for(d=b;d<c;d++)this[d]=a;else{var e=R(a.toString()),f=e.length;for(d=b;d<c;d++)this[d]=e[d%f]}return this}},f.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(f.TYPED_ARRAY_SUPPORT)return new f(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;b<c;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var _=f.prototype;f._augment=function(a){return a.constructor=f,a._isBuffer=!0,a._set=a.set,a.get=_.get,a.set=_.set,a.write=_.write,a.toString=_.toString,a.toLocaleString=_.toString,a.toJSON=_.toJSON,a.equals=_.equals,a.compare=_.compare,a.indexOf=_.indexOf,a.copy=_.copy,a.slice=_.slice,a.readUIntLE=_.readUIntLE,a.readUIntBE=_.readUIntBE,a.readUInt8=_.readUInt8,a.readUInt16LE=_.readUInt16LE,a.readUInt16BE=_.readUInt16BE,a.readUInt32LE=_.readUInt32LE,a.readUInt32BE=_.readUInt32BE,a.readIntLE=_.readIntLE,a.readIntBE=_.readIntBE,a.readInt8=_.readInt8,a.readInt16LE=_.readInt16LE,a.readInt16BE=_.readInt16BE,a.readInt32LE=_.readInt32LE,a.readInt32BE=_.readInt32BE,a.readFloatLE=_.readFloatLE,a.readFloatBE=_.readFloatBE,a.readDoubleLE=_.readDoubleLE,a.readDoubleBE=_.readDoubleBE,a.writeUInt8=_.writeUInt8,a.writeUIntLE=_.writeUIntLE,a.writeUIntBE=_.writeUIntBE,a.writeUInt16LE=_.writeUInt16LE,a.writeUInt16BE=_.writeUInt16BE,a.writeUInt32LE=_.writeUInt32LE,a.writeUInt32BE=_.writeUInt32BE,a.writeIntLE=_.writeIntLE,a.writeIntBE=_.writeIntBE,a.writeInt8=_.writeInt8,a.writeInt16LE=_.writeInt16LE,a.writeInt16BE=_.writeInt16BE,a.writeInt32LE=_.writeInt32LE,a.writeInt32BE=_.writeInt32BE,a.writeFloatLE=_.writeFloatLE,a.writeFloatBE=_.writeFloatBE,a.writeDoubleLE=_.writeDoubleLE,a.writeDoubleBE=_.writeDoubleBE,a.fill=_.fill,a.inspect=_.inspect,a.toArrayBuffer=_.toArrayBuffer,a};var aa=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:4,isarray:5}],4:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],5:[function(a,b,c){var d={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==d.call(a)}},{}],6:[function(a,b,c){(function(b){function d(a,b){var c=a.canvas,d=b.getContext("2d");d.translate(0,b.height),d.scale(1,-1);var e=c.height-b.height;d.drawImage(c,0,e,b.width,b.height,0,0,b.width,b.height)}function e(a,b){var c=b.getContext("2d"),d=b.width,e=b.height,f=d*e*4,g=new Uint8Array(this.imageBuffer,0,f),h=new Uint8ClampedArray(this.imageBuffer,0,f);a.readPixels(0,0,d,e,a.RGBA,a.UNSIGNED_BYTE,g);var i=new ImageData(h,d);c.putImageData(i,0,0)}var f=f||{version:"2.0.0-beta5"};"undefined"!=typeof c&&(c.fabric=f),"undefined"!=typeof document&&"undefined"!=typeof window?(f.document=document,f.window=window,window.fabric=f):(f.document=a("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),f.window=f.document.defaultView),f.isTouchSupported="ontouchstart"in f.document.documentElement,f.isLikelyNode="undefined"!=typeof b&&"undefined"==typeof window,f.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],f.DPI=96,f.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",f.fontPaths={},f.iMatrix=[1,0,0,1,0,0],f.canvasModule="canvas",f.perfLimitSizeTotal=2097152,f.maxCacheSideLimit=4096,f.minCacheSideLimit=256,f.charWidthsCache={},f.textureSize=2048,f.enableGLFiltering=!0,f.devicePixelRatio=f.window.devicePixelRatio||f.window.webkitDevicePixelRatio||f.window.mozDevicePixelRatio||1,f.initFilterBackend=function(){return f.isWebglSupported&&f.isWebglSupported(f.textureSize)&&f.enableGLFiltering?(console.log("max texture size: "+f.maxTextureSize),new f.WebglFilterBackend({tileSize:f.textureSize})):f.Canvas2dFilterBackend?new f.Canvas2dFilterBackend:void 0},function(){function a(a,b){if(this.__eventListeners[a]){var c=this.__eventListeners[a];b?c[c.indexOf(b)]=!1:f.util.array.fill(c,!1)}}function b(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(b,c){if(this.__eventListeners){if(0===arguments.length)for(b in this.__eventListeners)a.call(this,b);else if(1===arguments.length&&"object"==typeof arguments[0])for(var d in b)a.call(this,d,b[d]);else a.call(this,b,c);return this}}function d(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;d<e;d++)c[d]&&c[d].call(this,b||{});return this.__eventListeners[a]=c.filter(function(a){return a!==!1}),this}}}f.Observable={observe:b,stopObserving:c,fire:d,on:b,off:c,trigger:d}}(),f.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,b=arguments.length;a<b;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(a,b,c){var d=this.getObjects();return c?d[b]=a:d.splice(b,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a,b=this.getObjects(),c=!1,d=0,e=arguments.length;d<e;d++)a=b.indexOf(arguments[d]),a!==-1&&(c=!0,b.splice(a,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));return this.renderOnAddRemove&&c&&this.requestRenderAll(),this},forEachObject:function(a,b){for(var c=this.getObjects(),d=0,e=c.length;d<e;d++)a.call(b,c[d],d,c);return this},getObjects:function(a){return"undefined"==typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}},f.CommonMethods={_setOptions:function(a){for(var b in a)this.set(b,a[b])},_initGradient:function(a,b){!a||!a.colorStops||a instanceof f.Gradient||this.set(b,new f.Gradient(a))},_initPattern:function(a,b,c){!a||!a.source||a instanceof f.Pattern?c&&c():this.set(b,new f.Pattern(a,c))},_initClipping:function(a){if(a.clipTo&&"string"==typeof a.clipTo){var b=f.util.getFunctionBody(a.clipTo);"undefined"!=typeof b&&(this.clipTo=new Function("ctx",b))}},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"==typeof a?this._setObject(a):"function"==typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,b){this[a]=b},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},get:function(a){return this[a]}},function(a){var b=Math.sqrt,c=Math.atan2,d=Math.pow,e=Math.abs,g=Math.PI/180;f.util={removeFromArray:function(a,b){var c=a.indexOf(b);return c!==-1&&a.splice(c,1),a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*g},radiansToDegrees:function(a){return a/g},rotatePoint:function(a,b,c){a.subtractEquals(b);var d=f.util.rotateVector(a,c);return new f.Point(d.x,d.y).addEquals(b)},rotateVector:function(a,b){var c=Math.sin(b),d=Math.cos(b),e=a.x*d-a.y*c,f=a.x*c+a.y*d;return{x:e,y:f}},transformPoint:function(a,b,c){return c?new f.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new f.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},makeBoundingBoxFromPoints:function(a){var b=[a[0].x,a[1].x,a[2].x,a[3].x],c=f.util.array.min(b),d=f.util.array.max(b),e=Math.abs(c-d),g=[a[0].y,a[1].y,a[2].y,a[3].y],h=f.util.array.min(g),i=f.util.array.max(g),j=Math.abs(h-i);return{left:c,top:h,width:e,height:j}},invertTransform:function(a){var b=1/(a[0]*a[3]-a[1]*a[2]),c=[b*a[3],-b*a[1],-b*a[2],b*a[0]],d=f.util.transformPoint({x:a[4],y:a[5]},c,!0);return c[4]=-d.x,c[5]=-d.y,c},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);switch(b||(b=f.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return d*f.DPI/25.4;case"cm":return d*f.DPI/2.54;case"in":return d*f.DPI;case"pt":return d*f.DPI/72;case"pc":return d*f.DPI/72*12;case"em":return d*b;default:return d}},falseFunction:function(){return!1},getKlass:function(a,b){return a=f.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),f.util.resolveNamespace(b)[a]},resolveNamespace:function(b){if(!b)return f;var c,d=b.split("."),e=d.length,g=a||f.window;for(c=0;c<e;++c)g=g[d[c]];return g},loadImage:function(a,b,c,d){if(!a)return void(b&&b.call(c,a));var e=f.util.createImage();e.onload=function(){b&&b.call(c,e),e=e.onload=e.onerror=null},e.onerror=function(){f.log("Error loading "+e.src),b&&b.call(c,null,!0),e=e.onload=e.onerror=null},0!==a.indexOf("data")&&d&&(e.crossOrigin=d),e.src=a},enlivenObjects:function(a,b,c,d){function e(){++h===i&&b&&b(g)}a=a||[];var g=[],h=0,i=a.length;return i?void a.forEach(function(a,b){if(!a||!a.type)return void e();var h=f.util.getKlass(a.type,c);h.fromObject(a,function(c,f){f||(g[b]=c),d&&d(a,c,f),e()})}):void(b&&b(g))},enlivenPatterns:function(a,b){function c(){++e===g&&b&&b(d)}a=a||[];var d=[],e=0,g=a.length;return g?void a.forEach(function(a,b){a&&a.source?new f.Pattern(a,function(a){d[b]=a,c()}):(d[b]=a,c())}):void(b&&b(d))},groupSVGElements:function(a,b,c){var d;return 1===a.length?a[0]:(b&&(b.width&&b.height?b.centerPoint={x:b.width/2,y:b.height/2}:(delete b.width,delete b.height)),d=new f.Group(a,b),"undefined"!=typeof c&&(d.sourcePath=c),d)},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;d<e;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,d,e,f,g,h){var i=f-d,j=g-e,k=b(i*i+j*j),l=c(j,i),m=h.length,n=0,o=!0;for(a.save(),a.translate(d,e),a.moveTo(0,0),a.rotate(l),d=0;k>d;)d+=h[n++%m],d>k&&(d=k),a[o?"lineTo":"moveTo"](d,0),o=!o;a.restore()},createCanvasElement:function(){return f.document.createElement("canvas")},createImage:function(){return f.document.createElement("img")},clipContext:function(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()},multiplyTransformMatrices:function(a,b,c){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],c?0:a[0]*b[4]+a[2]*b[5]+a[4],c?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(a){var e=c(a[1],a[0]),f=d(a[0],2)+d(a[1],2),h=b(f),i=(a[0]*a[3]-a[2]*a[1])/h,j=c(a[0]*a[2]+a[1]*a[3],f);return{angle:e/g,scaleX:h,scaleY:i,skewX:j/g,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(a,b,c){var d=[1,0,e(Math.tan(c*g)),1],h=[e(a),0,0,e(b)];return f.util.multiplyTransformMatrices(h,d,!0)},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.setAngle(0)},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,c,d){d>0&&(b>d?b-=d:b=0,c>d?c-=d:c=0);var e,f,g=!0,h=a.getImageData(b,c,2*d||1,2*d||1),i=h.data.length;for(e=3;e<i&&(f=h.data[e],g=f<=0,g!==!1);e+=4);return h=null,g},parsePreserveAspectRatioAttribute:function(a){var b,c="meet",d="Mid",e="Mid",f=a.split(" ");return f&&f.length&&(c=f.pop(),"meet"!==c&&"slice"!==c?(b=c,c="meet"):f.length&&(b=f.pop())),d="none"!==b?b.slice(1,4):"none",e="none"!==b?b.slice(5,8):"none",{meetOrSlice:c,alignX:d,alignY:e}},clearFabricFontCache:function(a){a?f.charWidthsCache[a]&&delete f.charWidthsCache[a]:f.charWidthsCache={}},limitDimsByArea:function(a,b){var c=Math.sqrt(b*a),d=Math.floor(b/c);return{x:Math.floor(c),y:d}},capValue:function(a,b,c){return Math.max(a,Math.min(b,c))},findScaleToFit:function(a,b){return Math.min(b.width/a.width,b.height/a.height)},findScaleToCover:function(a,b){return Math.max(b.width/a.width,b.height/a.height)}}}("undefined"!=typeof c?c:this),function(){function a(a,d,f,g,h,j,k){var l=i.call(arguments);if(e[l])return e[l];var m=Math.PI,n=k*m/180,o=Math.sin(n),p=Math.cos(n),q=0,r=0;f=Math.abs(f),g=Math.abs(g);var s=-p*a*.5-o*d*.5,t=-p*d*.5+o*a*.5,u=f*f,v=g*g,w=t*t,x=s*s,y=u*v-u*w-v*x,z=0;
if(y<0){var A=Math.sqrt(1-y/(u*v));f*=A,g*=A}else z=(h===j?-1:1)*Math.sqrt(y/(u*w+v*x));var B=z*f*t/g,C=-z*g*s/f,D=p*B-o*C+.5*a,E=o*B+p*C+.5*d,F=c(1,0,(s-B)/f,(t-C)/g),G=c((s-B)/f,(t-C)/g,(-s-B)/f,(-t-C)/g);0===j&&G>0?G-=2*m:1===j&&G<0&&(G+=2*m);for(var H=Math.ceil(Math.abs(G/m*2)),I=[],J=G/H,K=8/3*Math.sin(J/4)*Math.sin(J/4)/Math.sin(J/2),L=F+J,M=0;M<H;M++)I[M]=b(F,L,p,o,f,g,D,E,K,q,r),q=I[M][4],r=I[M][5],F=L,L+=J;return e[l]=I,I}function b(a,b,c,d,e,f,h,j,k,l,m){var n=i.call(arguments);if(g[n])return g[n];var o=Math.cos(a),p=Math.sin(a),q=Math.cos(b),r=Math.sin(b),s=c*e*q-d*f*r+h,t=d*e*q+c*f*r+j,u=l+k*(-c*e*p-d*f*o),v=m+k*(-d*e*p+c*f*o),w=s+k*(c*e*r+d*f*q),x=t+k*(d*e*r-c*f*q);return g[n]=[u,v,w,x,s,t],g[n]}function c(a,b,c,d){var e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)}function d(a,b,c,d,e,f,g,j){var k=i.call(arguments);if(h[k])return h[k];var l,m,n,o,p,q,r,s,t=Math.sqrt,u=Math.min,v=Math.max,w=Math.abs,x=[],y=[[],[]];m=6*a-12*c+6*e,l=-3*a+9*c-9*e+3*g,n=3*c-3*a;for(var z=0;z<2;++z)if(z>0&&(m=6*b-12*d+6*f,l=-3*b+9*d-9*f+3*j,n=3*d-3*b),w(l)<1e-12){if(w(m)<1e-12)continue;o=-n/m,0<o&&o<1&&x.push(o)}else r=m*m-4*n*l,r<0||(s=t(r),p=(-m+s)/(2*l),0<p&&p<1&&x.push(p),q=(-m-s)/(2*l),0<q&&q<1&&x.push(q));for(var A,B,C,D=x.length,E=D;D--;)o=x[D],C=1-o,A=C*C*C*a+3*C*C*o*c+3*C*o*o*e+o*o*o*g,y[0][D]=A,B=C*C*C*b+3*C*C*o*d+3*C*o*o*f+o*o*o*j,y[1][D]=B;y[0][E]=a,y[1][E]=b,y[0][E+1]=g,y[1][E+1]=j;var F=[{x:u.apply(null,y[0]),y:u.apply(null,y[1])},{x:v.apply(null,y[0]),y:v.apply(null,y[1])}];return h[k]=F,F}var e={},g={},h={},i=Array.prototype.join;f.util.drawArc=function(b,c,d,e){for(var f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=[[],[],[],[]],n=a(k-c,l-d,f,g,i,j,h),o=0,p=n.length;o<p;o++)m[o][0]=n[o][0]+c,m[o][1]=n[o][1]+d,m[o][2]=n[o][2]+c,m[o][3]=n[o][3]+d,m[o][4]=n[o][4]+c,m[o][5]=n[o][5]+d,b.bezierCurveTo.apply(b,m[o])},f.util.getBoundsOfArc=function(b,c,e,f,g,h,i,j,k){for(var l,m=0,n=0,o=[],p=a(j-b,k-c,e,f,h,i,g),q=0,r=p.length;q<r;q++)l=d(m,n,p[q][0],p[q][1],p[q][2],p[q][3],p[q][4],p[q][5]),o.push({x:l[0].x+b,y:l[0].y+c}),o.push({x:l[1].x+b,y:l[1].y+c}),m=p[q][4],n=p[q][5];return o},f.util.getBoundsOfCurve=d}(),function(){function a(a,b){for(var c=g.call(arguments,2),d=[],e=0,f=a.length;e<f;e++)d[e]=c.length?a[e][b].apply(a[e],c):a[e][b].call(a[e]);return d}function b(a,b){return e(a,b,function(a,b){return a>=b})}function c(a,b){return e(a,b,function(a,b){return a<b})}function d(a,b){for(var c=a.length;c--;)a[c]=b;return a}function e(a,b,c){if(a&&0!==a.length){var d=a.length-1,e=b?a[d][b]:a[d];if(b)for(;d--;)c(a[d][b],e)&&(e=a[d][b]);else for(;d--;)c(a[d],e)&&(e=a[d]);return e}}var g=Array.prototype.slice;f.util.array={fill:d,invoke:a,min:c,max:b}}(),function(){function a(b,c,d){if(d)if(!f.isLikelyNode&&c instanceof Element)b=c;else if(c instanceof Array){b=[];for(var e=0,g=c.length;e<g;e++)b[e]=a({},c[e],d)}else if(c&&"object"==typeof c)for(var h in c)c.hasOwnProperty(h)&&(b[h]=a({},c[h],d));else b=c;else for(var h in c)b[h]=c[h];return b}function b(b,c){return a({},b,c)}f.util.object={extend:a,clone:b},f.util.object.extend(f.util,f.Observable)}(),function(){function a(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function b(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())}function c(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function d(a){var b,c=0,d=[];for(c=0,b;c<a.length;c++)(b=e(a,c))!==!1&&d.push(b);return d}function e(a,b){var c=a.charCodeAt(b);if(isNaN(c))return"";if(c<55296||c>57343)return a.charAt(b);if(55296<=c&&c<=56319){if(a.length<=b+1)throw"High surrogate without following low surrogate";var d=a.charCodeAt(b+1);if(56320>d||d>57343)throw"High surrogate without following low surrogate";return a.charAt(b)+a.charAt(b+1)}if(0===b)throw"Low surrogate without preceding high surrogate";var e=a.charCodeAt(b-1);if(55296>e||e>56319)throw"Low surrogate without preceding high surrogate";return!1}f.util.string={camelize:a,capitalize:b,escapeXml:c,graphemeSplit:d}}(),function(){function a(){}function b(a){for(var b=null,c=this;c.constructor.superclass;){var e=c.constructor.superclass.prototype[a];if(c[a]!==e){b=e;break}c=c.constructor.superclass.prototype}return b?arguments.length>1?b.apply(this,d.call(arguments,1)):b.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}function c(){function c(){this.initialize.apply(this,arguments)}var f=null,g=d.call(arguments,0);"function"==typeof g[0]&&(f=g.shift()),c.superclass=f,c.subclasses=[],f&&(a.prototype=f.prototype,c.prototype=new a,f.subclasses.push(c));for(var i=0,j=g.length;i<j;i++)h(c,g[i],f);return c.prototype.initialize||(c.prototype.initialize=e),c.prototype.constructor=c,c.prototype.callSuper=b,c}var d=Array.prototype.slice,e=function(){},g=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),h=function(a,b,c){for(var d in b)d in a.prototype&&"function"==typeof a.prototype[d]&&(b[d]+"").indexOf("callSuper")>-1?a.prototype[d]=function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=c;var e=b[a].apply(this,arguments);if(this.constructor.superclass=d,"initialize"!==a)return e}}(d):a.prototype[d]=b[d],g&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};f.util.createClass=c}(),function(){function a(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;c<e;c++)if(b=typeof a[d[c]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function b(a,b){return{handler:b,wrappedHandler:c(a,b)}}function c(a,b){return function(c){b.call(h(a),c||f.window.event)}}function d(a,b){return function(c){if(q[a]&&q[a][b])for(var d=q[a][b],e=0,g=d.length;e<g;e++)d[e].call(this,c||f.window.event)}}function e(a){a||(a=f.window.event);var b=a.target||(typeof a.srcElement!==j?a.srcElement:null),c=f.util.getScrollLeftTop(b);return{x:r(a)+c.left,y:s(a)+c.top}}function g(a,b,c){var d="touchend"===a.type?"changedTouches":"touches";return a[d]&&a[d][0]?a[d][0][b]-(a[d][0][b]-a[d][0][c])||a[c]:a[c]}var h,i,j="unknown",k=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};h=function(b){return a[b]},i=function(b,c){a[b]=c}}();var l,m,n=a(f.document.documentElement,"addEventListener","removeEventListener")&&a(f.window,"addEventListener","removeEventListener"),o=a(f.document.documentElement,"attachEvent","detachEvent")&&a(f.window,"attachEvent","detachEvent"),p={},q={};n?(l=function(a,b,c,d){a&&a.addEventListener(b,c,!o&&d)},m=function(a,b,c,d){a&&a.removeEventListener(b,c,!o&&d)}):o?(l=function(a,c,d){if(a){var e=k(a);i(e,a),p[e]||(p[e]={}),p[e][c]||(p[e][c]=[]);var f=b(e,d);p[e][c].push(f),a.attachEvent("on"+c,f.wrappedHandler)}},m=function(a,b,c){if(a){var d,e=k(a);if(p[e]&&p[e][b])for(var f=0,g=p[e][b].length;f<g;f++)d=p[e][b][f],d&&d.handler===c&&(a.detachEvent("on"+b,d.wrappedHandler),p[e][b][f]=null)}}):(l=function(a,b,c){if(a){var e=k(a);if(q[e]||(q[e]={}),!q[e][b]){q[e][b]=[];var f=a["on"+b];f&&q[e][b].push(f),a["on"+b]=d(e,b)}q[e][b].push(c)}},m=function(a,b,c){if(a){var d=k(a);if(q[d]&&q[d][b])for(var e=q[d][b],f=0,g=e.length;f<g;f++)e[f]===c&&e.splice(f,1)}}),f.util.addListener=l,f.util.removeListener=m;var r=function(a){return a.clientX},s=function(a){return a.clientY};f.isTouchSupported&&(r=function(a){return g(a,"pageX","clientX")},s=function(a){return g(a,"pageY","clientY")}),f.util.getPointer=e}(),function(){function a(a,b){var c=a.style;if(!c)return a;if("string"==typeof b)return a.style.cssText+=";"+b,b.indexOf("opacity")>-1?g(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)if("opacity"===d)g(a,b[d]);else{var e="float"===d||"cssFloat"===d?"undefined"==typeof c.styleFloat?"cssFloat":"styleFloat":d;c[e]=b[d]}return a}var b=f.document.createElement("div"),c="string"==typeof b.style.opacity,d="string"==typeof b.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,g=function(a){return a};c?g=function(a,b){return a.style.opacity=b,a}:d&&(g=function(a,b){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),e.test(c.filter)?(b=b>=.9999?"":"alpha(opacity="+100*b+")",c.filter=c.filter.replace(e,b)):c.filter+=" alpha(opacity="+100*b+")",a}),f.util.setStyle=a}(),function(){function a(a){return"string"==typeof a?f.document.getElementById(a):a}function b(a,b){var c=f.document.createElement(a);for(var d in b)"class"===d?c.className=b[d]:"for"===d?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}function c(a,b){a&&(" "+a.className+" ").indexOf(" "+b+" ")===-1&&(a.className+=(a.className?" ":"")+b)}function d(a,c,d){return"string"==typeof c&&(c=b(c,d)),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),c}function e(a){for(var b=0,c=0,d=f.document.documentElement,e=f.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===f.document?(b=e.scrollLeft||d.scrollLeft||0,c=e.scrollTop||d.scrollTop||0):(b+=a.scrollLeft||0,c+=a.scrollTop||0),1!==a.nodeType||"fixed"!==f.util.getElementStyle(a,"position")););return{left:b,top:c}}function g(a){var b,c,d=a&&a.ownerDocument,f={left:0,top:0},g={left:0,top:0},h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d)return g;for(var i in h)g[h[i]]+=parseInt(l(a,i),10)||0;return b=d.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(f=a.getBoundingClientRect()),c=e(a),{left:f.left+c.left-(b.clientLeft||0)+g.left,top:f.top+c.top-(b.clientTop||0)+g.top}}var h,i=Array.prototype.slice,j=function(a){return i.call(a,0)};try{h=j(f.document.childNodes)instanceof Array}catch(k){}h||(j=function(a){for(var b=new Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var l;l=f.document.defaultView&&f.document.defaultView.getComputedStyle?function(a,b){var c=f.document.defaultView.getComputedStyle(a,null);return c?c[b]:void 0}:function(a,b){var c=a.style[b];return!c&&a.currentStyle&&(c=a.currentStyle[b]),c},function(){function a(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=f.util.falseFunction),d?a.style[d]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a}function b(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=null),d?a.style[d]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}var c=f.document.documentElement.style,d="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";f.util.makeElementUnselectable=a,f.util.makeElementSelectable=b}(),function(){function a(a,b){var c=f.document.getElementsByTagName("head")[0],d=f.document.createElement("script"),e=!0;d.onload=d.onreadystatechange=function(a){if(e){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;e=!1,b(a||f.window.event),d=d.onload=d.onreadystatechange=null}},d.src=a,c.appendChild(d)}f.util.getScript=a}(),f.util.getById=a,f.util.toArray=j,f.util.makeElement=b,f.util.addClass=c,f.util.wrapElement=d,f.util.getScrollLeftTop=e,f.util.getElementOffset=g,f.util.getElementStyle=l}(),function(){function a(a,b){return a+(/\?/.test(a)?"&":"?")+b}function b(){}function c(c,e){e||(e={});var f=e.method?e.method.toUpperCase():"GET",g=e.onComplete||function(){},h=d(),i=e.body||e.parameters;return h.onreadystatechange=function(){4===h.readyState&&(g(h),h.onreadystatechange=b)},"GET"===f&&(i=null,"string"==typeof e.parameters&&(c=a(c,e.parameters))),h.open(f,c,!0),"POST"!==f&&"PUT"!==f||h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.send(i),h}var d=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{var c=a[b]();if(c)return a[b]}catch(d){}}();f.util.request=c}(),f.log=function(){},f.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(a){"undefined"!=typeof console[a]&&"function"==typeof console[a].apply&&(f[a]=function(){return console[a].apply(console,arguments)})}),function(){function a(){return!1}function b(b){c(function(d){b||(b={});var e,f=d||+new Date,g=b.duration||500,h=f+g,i=b.onChange||a,j=b.abort||a,k=b.onComplete||a,l=b.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},m="startValue"in b?b.startValue:0,n="endValue"in b?b.endValue:100,o=b.byValue||n-m;b.onStart&&b.onStart(),function p(a){if(j())return void k(n,1,1);e=a||+new Date;var d=e>h?g:e-f,q=d/g,r=l(d,m,o,g),s=Math.abs((r-m)/o);return i(r,s,q),e>h?void(b.onComplete&&b.onComplete()):void c(p)}(f)})}function c(){return d.apply(f.window,arguments)}var d=f.window.requestAnimationFrame||f.window.webkitRequestAnimationFrame||f.window.mozRequestAnimationFrame||f.window.oRequestAnimationFrame||f.window.msRequestAnimationFrame||function(a){return f.window.setTimeout(a,1e3/60)};f.util.animate=b,f.util.requestAnimFrame=c}(),function(){function a(a,b,c){var d="rgba("+parseInt(a[0]+c*(b[0]-a[0]),10)+","+parseInt(a[1]+c*(b[1]-a[1]),10)+","+parseInt(a[2]+c*(b[2]-a[2]),10);return d+=","+(a&&b?parseFloat(a[3]+c*(b[3]-a[3])):1),d+=")"}function b(b,c,d,e){var g=new f.Color(b).getSource(),h=new f.Color(c).getSource();e=e||{},f.util.animate(f.util.object.extend(e,{duration:d||500,startValue:g,endValue:h,byValue:h,easing:function(b,c,d,f){var g=e.colorEasing?e.colorEasing(b,f):1-Math.cos(b/f*(Math.PI/2));return a(c,d,g)}}))}f.util.animateColor=b}(),function(a){"use strict";function b(a){return a in z?z[a]:a}function c(a,b,c,d){var e,f="[object Array]"===Object.prototype.toString.call(b);return"fill"!==a&&"stroke"!==a||"none"!==b?"strokeDashArray"===a?b="none"===b?null:b.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?b=c&&c.transformMatrix?u(c.transformMatrix,p.parseTransformAttribute(b)):p.parseTransformAttribute(b):"visible"===a?(b="none"!==b&&"hidden"!==b,c&&c.visible===!1&&(b=!1)):"opacity"===a?(b=parseFloat(b),c&&"undefined"!=typeof c.opacity&&(b*=c.opacity)):"textAnchor"===a?b="start"===b?"left":"end"===b?"right":"center":e=f?b.map(t):t(b,d):b="",!f&&isNaN(e)?b:e}function d(a){for(var b in A)if("undefined"!=typeof a[A[b]]&&""!==a[b]){if("undefined"==typeof a[b]){if(!p.Object.prototype[b])continue;a[b]=p.Object.prototype[b]}if(0!==a[b].indexOf("url(")){var c=new p.Color(a[b]);a[b]=c.setAlpha(s(c.getAlpha()*a[A[b]],2)).toRgba()}}return a}function e(a,b){var c,d,e,f,g=[];for(e=0,f=b.length;e<f;e++)c=b[e],d=a.getElementsByTagName(c),g=g.concat(Array.prototype.slice.call(d));return g}function f(a,b){var c,d;a.replace(/;\s*$/,"").split(";").forEach(function(a){var e=a.split(":");c=e[0].trim().toLowerCase(),d=e[1].trim(),b[c]=d})}function g(a,b){var c,d;for(var e in a)"undefined"!=typeof a[e]&&(c=e.toLowerCase(),d=a[e],b[c]=d)}function h(a,b){var c={};for(var d in p.cssRules[b])if(i(a,d.split(" ")))for(var e in p.cssRules[b][d])c[e]=p.cssRules[b][d][e];return c}function i(a,b){var c,d=!0;return c=k(a,b.pop()),c&&b.length&&(d=j(a,b)),c&&d&&0===b.length}function j(a,b){for(var c,d=!0;a.parentNode&&1===a.parentNode.nodeType&&b.length;)d&&(c=b.pop()),a=a.parentNode,d=k(a,c);return 0===b.length}function k(a,b){var c,d,e=a.nodeName,f=a.getAttribute("class"),g=a.getAttribute("id");if(c=new RegExp("^"+e,"i"),b=b.replace(c,""),g&&b.length&&(c=new RegExp("#"+g+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")),f&&b.length)for(f=f.split(" "),d=f.length;d--;)c=new RegExp("\\."+f[d]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"");return 0===b.length}function l(a,b){var c;if(a.getElementById&&(c=a.getElementById(b)),c)return c;var d,e,f,g=a.getElementsByTagName("*");for(e=0,f=g.length;e<f;e++)if(d=g[e],b===d.getAttribute("id"))return d}function m(a){for(var b=e(a,["use","svg:use"]),c=0;b.length&&c<b.length;){var d,f,g,h,i,j=b[c],k=j.getAttribute("xlink:href").substr(1),m=j.getAttribute("x")||0,o=j.getAttribute("y")||0,p=l(a,k).cloneNode(!0),q=(p.getAttribute("transform")||"")+" translate("+m+", "+o+")",r=b.length;if(n(p),/^svg$/i.test(p.nodeName)){var s=p.ownerDocument.createElement("g");for(g=0,h=p.attributes,i=h.length;g<i;g++)f=h.item(g),s.setAttribute(f.nodeName,f.nodeValue);for(;p.firstChild;)s.appendChild(p.firstChild);p=s}for(g=0,h=j.attributes,i=h.length;g<i;g++)f=h.item(g),"x"!==f.nodeName&&"y"!==f.nodeName&&"xlink:href"!==f.nodeName&&("transform"===f.nodeName?q=f.nodeValue+" "+q:p.setAttribute(f.nodeName,f.nodeValue));p.setAttribute("transform",q),p.setAttribute("instantiated_by_use","1"),p.removeAttribute("id"),d=j.parentNode,d.replaceChild(p,j),b.length===r&&c++}}function n(a){var b,c,d,e,f=a.getAttribute("viewBox"),g=1,h=1,i=0,j=0,k=a.getAttribute("width"),l=a.getAttribute("height"),m=a.getAttribute("x")||0,n=a.getAttribute("y")||0,o=a.getAttribute("preserveAspectRatio")||"",q=!f||!w.test(a.nodeName)||!(f=f.match(B)),r=!k||!l||"100%"===k||"100%"===l,s=q&&r,u={},v="";if(u.width=0,u.height=0,u.toBeParsed=s,s)return u;if(q)return u.width=t(k),u.height=t(l),u;if(i=-parseFloat(f[1]),j=-parseFloat(f[2]),b=parseFloat(f[3]),c=parseFloat(f[4]),r?(u.width=b,u.height=c):(u.width=t(k),u.height=t(l),g=u.width/b,h=u.height/c),o=p.util.parsePreserveAspectRatioAttribute(o),"none"!==o.alignX&&(h=g=g>h?h:g),1===g&&1===h&&0===i&&0===j&&0===m&&0===n)return u;if((m||n)&&(v=" translate("+t(m)+" "+t(n)+") "),d=v+" matrix("+g+" 0 0 "+h+" "+i*g+" "+j*h+") ","svg"===a.nodeName){for(e=a.ownerDocument.createElement("g");a.firstChild;)e.appendChild(a.firstChild);a.appendChild(e)}else e=a,d=e.getAttribute("transform")+d;return e.setAttribute("transform",d),u}function o(a,b){for(;a&&(a=a.parentNode);)if(a.nodeName&&b.test(a.nodeName.replace("svg:",""))&&!a.getAttribute("instantiated_by_use"))return!0;return!1}var p=a.fabric||(a.fabric={}),q=p.util.object.extend,r=p.util.object.clone,s=p.util.toFixed,t=p.util.parseUnit,u=p.util.multiplyTransformMatrices,v=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,w=/^(symbol|image|marker|pattern|view|svg)$/i,x=/^(?:pattern|defs|symbol|metadata|clipPath|mask)$/i,y=/^(symbol|g|a|svg)$/i,z={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity"},A={stroke:"strokeOpacity",fill:"fillOpacity"};p.cssRules={},p.gradientDefs={},p.parseTransformAttribute=function(){function a(a,b){var c=Math.cos(b[0]),d=Math.sin(b[0]),e=0,f=0;3===b.length&&(e=b[1],f=b[2]),a[0]=c,a[1]=d,a[2]=-d,a[3]=c,a[4]=e-(c*e-d*f),a[5]=f-(d*e+c*f)}function b(a,b){var c=b[0],d=2===b.length?b[1]:b[0];a[0]=c,a[3]=d}function c(a,b,c){a[c]=Math.tan(p.util.degreesToRadians(b[0]))}function d(a,b){a[4]=b[0],2===b.length&&(a[5]=b[1])}var e=[1,0,0,1,0,0],f=p.reNum,g="(?:\\s+,?\\s*|,\\s*)",h="(?:(skewX)\\s*\\(\\s*("+f+")\\s*\\))",i="(?:(skewY)\\s*\\(\\s*("+f+")\\s*\\))",j="(?:(rotate)\\s*\\(\\s*("+f+")(?:"+g+"("+f+")"+g+"("+f+"))?\\s*\\))",k="(?:(scale)\\s*\\(\\s*("+f+")(?:"+g+"("+f+"))?\\s*\\))",l="(?:(translate)\\s*\\(\\s*("+f+")(?:"+g+"("+f+"))?\\s*\\))",m="(?:(matrix)\\s*\\(\\s*("+f+")"+g+"("+f+")"+g+"("+f+")"+g+"("+f+")"+g+"("+f+")"+g+"("+f+")\\s*\\))",n="(?:"+m+"|"+l+"|"+k+"|"+j+"|"+h+"|"+i+")",o="(?:"+n+"(?:"+g+"*"+n+")*)",q="^\\s*(?:"+o+"?)\\s*$",r=new RegExp(q),s=new RegExp(n,"g");return function(f){var g=e.concat(),h=[];if(!f||f&&!r.test(f))return g;f.replace(s,function(f){var i=new RegExp(n).exec(f).filter(function(a){return!!a}),j=i[1],k=i.slice(2).map(parseFloat);switch(j){case"translate":d(g,k);break;case"rotate":k[0]=p.util.degreesToRadians(k[0]),a(g,k);break;case"scale":b(g,k);break;case"skewX":c(g,k,2);break;case"skewY":c(g,k,1);break;case"matrix":g=k}h.push(g.concat()),g=e.concat()});for(var i=h[0];h.length>1;)h.shift(),i=p.util.multiplyTransformMatrices(i,h[0]);return i}}();var B=new RegExp("^\\s*("+p.reNum+"+)\\s*,?\\s*("+p.reNum+"+)\\s*,?\\s*("+p.reNum+"+)\\s*,?\\s*("+p.reNum+"+)\\s*$");p.parseSVGDocument=function(a,b,c,d){if(a){m(a);var e,f,g=p.Object.__uid++,h=n(a),i=p.util.toArray(a.getElementsByTagName("*"));if(h.crossOrigin=d&&d.crossOrigin,h.svgUid=g,0===i.length&&p.isLikelyNode){i=a.selectNodes('//*[name(.)!="svg"]');var j=[];for(e=0,f=i.length;e<f;e++)j[e]=i[e];i=j}var k=i.filter(function(a){return n(a),v.test(a.nodeName.replace("svg:",""))&&!o(a,x)});if(!k||k&&!k.length)return void(b&&b([],{}));p.gradientDefs[g]=p.getGradientDefs(a),p.cssRules[g]=p.getCSSRules(a),p.parseElements(k,function(a,c){b&&b(a,h,c,i)},r(h),c,d)}};var C=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+p.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+p.reNum+"))?\\s+(.*)");q(p,{parseFontDeclaration:function(a,b){var c=a.match(C);if(c){var d=c[1],e=c[3],f=c[4],g=c[5],h=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),f&&(b.fontSize=t(f)),h&&(b.fontFamily=h),g&&(b.lineHeight="normal"===g?1:g)}},getGradientDefs:function(a){var b,c,d,f=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],g=e(a,f),h=0,i={},j={};for(h=g.length;h--;)b=g[h],d=b.getAttribute("xlink:href"),c=b.getAttribute("id"),d&&(j[c]=d.substr(1)),i[c]=b;for(c in j){var k=i[j[c]].cloneNode(!0);for(b=i[c];k.firstChild;)b.appendChild(k.firstChild)}return i},parseAttributes:function(a,e,f){if(a){var g,i,j={};"undefined"==typeof f&&(f=a.getAttribute("svgUid")),a.parentNode&&y.test(a.parentNode.nodeName)&&(j=p.parseAttributes(a.parentNode,e,f)),i=j&&j.fontSize||a.getAttribute("font-size")||p.Text.DEFAULT_SVG_FONT_SIZE;var k=e.reduce(function(b,c){return g=a.getAttribute(c),g&&(b[c]=g),b},{});k=q(k,q(h(a,f),p.parseStyleAttribute(a)));var l,m,n={};for(var o in k)l=b(o),m=c(l,k[o],j,i),n[l]=m;n&&n.font&&p.parseFontDeclaration(n.font,n);var r=q(j,n);return y.test(a.nodeName)?r:d(r)}},parseElements:function(a,b,c,d,e){new p.ElementsParser(a,b,c,d,e).parse()},parseStyleAttribute:function(a){var b={},c=a.getAttribute("style");return c?("string"==typeof c?f(c,b):g(c,b),b):b},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim(),a=a.split(/\s+/);var b,c,d=[];for(b=0,c=a.length;b<c;b+=2)d.push({x:parseFloat(a[b]),y:parseFloat(a[b+1])});return d},getCSSRules:function(a){var b,c,d,e=a.getElementsByTagName("style"),f={};for(b=0,c=e.length;b<c;b++){var g=e[b].textContent||e[b].text;g=g.replace(/\/\*[\s\S]*?\*\//g,""),""!==g.trim()&&(d=g.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(a){return a.trim()}),d.forEach(function(a){var d=a.match(/([\s\S]*?)\s*\{([^}]*)\}/),e={},g=d[2].trim(),h=g.replace(/;$/,"").split(/\s*;\s*/);for(b=0,c=h.length;b<c;b++){var i=h[b].split(/\s*:\s*/),j=i[0],k=i[1];e[j]=k}a=d[1],a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim(),""!==a&&(f[a]?p.util.object.extend(f[a],e):f[a]=p.util.object.clone(e))})}))}return f},loadSVGFromURL:function(a,b,c,d){function e(a){var e=a.responseXML;e&&!e.documentElement&&p.window.ActiveXObject&&a.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(a.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e&&e.documentElement||b&&b(null),p.parseSVGDocument(e.documentElement,function(a,c,d,e){b&&b(a,c,d,e)},c,d)}a=a.replace(/^\n\s*/,"").trim(),new p.util.request(a,{method:"get",onComplete:e})},loadSVGFromString:function(a,b,c,d){a=a.trim();var e;if("undefined"!=typeof DOMParser){var f=new DOMParser;f&&f.parseFromString&&(e=f.parseFromString(a,"text/xml"))}else p.window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));p.parseSVGDocument(e.documentElement,function(a,c,d,e){b(a,c,d,e)},c,d)}})}("undefined"!=typeof c?c:this),f.ElementsParser=function(a,b,c,d,e){this.elements=a,this.callback=b,this.options=c,this.reviver=d,this.svgUid=c&&c.svgUid||0,this.parsingOptions=e},f.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},f.ElementsParser.prototype.createObjects=function(){for(var a=0,b=this.elements.length;a<b;a++)this.elements[a].setAttribute("svgUid",this.svgUid),function(a,b){setTimeout(function(){a.createObject(a.elements[b],b)},0)}(this,a)},f.ElementsParser.prototype.createObject=function(a,b){var c=f[f.util.string.capitalize(a.tagName.replace("svg:",""))];if(c&&c.fromElement)try{this._createObject(c,a,b)}catch(d){f.log(d)}else this.checkIfDone()},f.ElementsParser.prototype._createObject=function(a,b,c){a.fromElement(b,this.createCallback(c,b),this.options)},f.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.resolveGradient(d,"fill"),c.resolveGradient(d,"stroke"),d._removeTransformMatrix(),d instanceof f.Image&&d.parsePreserveAspectRatioAttribute(b),c.reviver&&c.reviver(b,d),c.instances[a]=d,c.checkIfDone()}},f.ElementsParser.prototype.resolveGradient=function(a,b){var c=a.get(b);if(/^url\(/.test(c)){var d=c.slice(5,c.length-1);f.gradientDefs[this.svgUid][d]&&a.set(b,f.Gradient.fromElement(f.gradientDefs[this.svgUid][d],a))}},f.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances,this.elements))},function(a){"use strict";function b(a,b){this.x=a,this.y=b}var c=a.fabric||(a.fabric={});return c.Point?void c.warn("fabric.Point is already defined"):(c.Point=b,void(b.prototype={type:"point",constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){return this.x+=a.x,this.y+=a.y,this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){return this.x+=a,this.y+=a,this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){return this.x-=a.x,this.y-=a.y,this},scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){return this.x-=a,this.y-=a,this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){return this.x/=a,this.y/=a,this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,c){return"undefined"==typeof c&&(c=.5),c=Math.max(Math.min(1,c),0),new b(this.x+(a.x-this.x)*c,this.y+(a.y-this.y)*c)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return this.lerp(a)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setFromPoint:function(a){return this.x=a.x,this.y=a.y,this},swap:function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c},clone:function(){return new b(this.x,this.y)}}))}("undefined"!=typeof c?c:this),function(a){"use strict";function b(a){this.status=a,this.points=[]}var c=a.fabric||(a.fabric={});return c.Intersection?void c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={constructor:b,appendPoint:function(a){return this.points.push(a),this},appendPoints:function(a){return this.points=this.points.concat(a),this}},c.Intersection.intersectLineLine=function(a,d,e,f){var g,h=(f.x-e.x)*(a.y-e.y)-(f.y-e.y)*(a.x-e.x),i=(d.x-a.x)*(a.y-e.y)-(d.y-a.y)*(a.x-e.x),j=(f.y-e.y)*(d.x-a.x)-(f.x-e.x)*(d.y-a.y);if(0!==j){var k=h/j,l=i/j;0<=k&&k<=1&&0<=l&&l<=1?(g=new b("Intersection"),g.appendPoint(new c.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):g=new b}else g=new b(0===h||0===i?"Coincident":"Parallel");return g},c.Intersection.intersectLinePolygon=function(a,c,d){var e,f,g,h,i=new b,j=d.length;for(h=0;h<j;h++)e=d[h],f=d[(h+1)%j],g=b.intersectLineLine(a,c,e,f),i.appendPoints(g.points);return i.points.length>0&&(i.status="Intersection"),i},c.Intersection.intersectPolygonPolygon=function(a,c){var d,e=new b,f=a.length;for(d=0;d<f;d++){var g=a[d],h=a[(d+1)%f],i=b.intersectLinePolygon(g,h,c);e.appendPoints(i.points)}return e.points.length>0&&(e.status="Intersection"),e},void(c.Intersection.intersectPolygonRectangle=function(a,d,e){var f=d.min(e),g=d.max(e),h=new c.Point(g.x,f.y),i=new c.Point(f.x,g.y),j=b.intersectLinePolygon(f,h,a),k=b.intersectLinePolygon(h,g,a),l=b.intersectLinePolygon(g,i,a),m=b.intersectLinePolygon(i,f,a),n=new b;return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n}))}("undefined"!=typeof c?c:this),function(a){"use strict";function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var d=a.fabric||(a.fabric={});return d.Color?void d.warn("fabric.Color is already defined."):(d.Color=b,d.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&(a=b.colorNameMap[a]),"transparent"===a&&(c=[255,255,255,0]),c||(c=b.sourceFromHex(a)),c||(c=b.sourceFromRgb(a)),c||(c=b.sourceFromHsl(a)),c||(c=[0,0,0,1]),c&&this.setSource(c)},_rgbToHsl:function(a,b,c){a/=255,b/=255,c/=255;var e,f,g,h=d.util.array.max([a,b,c]),i=d.util.array.min([a,b,c]);if(g=(h+i)/2,h===i)e=f=0;else{var j=h-i;switch(f=g>.5?j/(2-h-i):j/(h+i),h){case a:e=(b-c)/j+(b<c?6:0);break;case b:e=(c-a)/j+2;break;case c:e=(a-b)/j+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a,b,c,d=this.getSource();return a=d[0].toString(16),a=1===a.length?"0"+a:a,b=d[1].toString(16),b=1===b.length?"0"+b:b,c=d[2].toString(16),c=1===c.length?"0"+c:c,a.toUpperCase()+b.toUpperCase()+c.toUpperCase()},toHexa:function(){var a,b=this.getSource();return a=255*b[3],a=a.toString(16),a=1===a.length?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10),c=a[3];return this.setSource([b,b,b,c]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),d=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(a){a instanceof b||(a=new b(a));var c,d=[],e=this.getAlpha(),f=.5,g=this.getSource(),h=a.getSource();for(c=0;c<3;c++)d.push(Math.round(g[c]*(1-f)+h[c]*f));return d[3]=e,this.setSource(d),this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/,d.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,
d.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},d.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},d.Color.sourceFromRgb=function(a){var c=a.match(b.reRGBa);if(c){var d=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),e=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),f=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(d,10),parseInt(e,10),parseInt(f,10),c[4]?parseFloat(c[4]):1]}},d.Color.fromRgba=b.fromRgb,d.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},d.Color.sourceFromHsl=function(a){var d=a.match(b.reHSLa);if(d){var e,f,g,h=(parseFloat(d[1])%360+360)%360/360,i=parseFloat(d[2])/(/%$/.test(d[2])?100:1),j=parseFloat(d[3])/(/%$/.test(d[3])?100:1);if(0===i)e=f=g=j;else{var k=j<=.5?j*(i+1):j+i-j*i,l=2*j-k;e=c(l,k,h+1/3),f=c(l,k,h),g=c(l,k,h-1/3)}return[Math.round(255*e),Math.round(255*f),Math.round(255*g),d[4]?parseFloat(d[4]):1]}},d.Color.fromHsla=b.fromHsl,d.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},d.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length||4===c.length,e=8===c.length||4===c.length,f=d?c.charAt(0)+c.charAt(0):c.substring(0,2),g=d?c.charAt(1)+c.charAt(1):c.substring(2,4),h=d?c.charAt(2)+c.charAt(2):c.substring(4,6),i=e?d?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(f,16),parseInt(g,16),parseInt(h,16),parseFloat((parseInt(i,16)/255).toFixed(2))]}},void(d.Color.fromSource=function(a){var c=new b;return c.setSource(a),c}))}("undefined"!=typeof c?c:this),function(){function a(a){var b,c,d,e,g=a.getAttribute("style"),h=a.getAttribute("offset")||0;if(h=parseFloat(h)/(/%$/.test(h)?100:1),h=h<0?0:h>1?1:h,g){var i=g.split(/\s*;\s*/);for(""===i[i.length-1]&&i.pop(),e=i.length;e--;){var j=i[e].split(/\s*:\s*/),k=j[0].trim(),l=j[1].trim();"stop-color"===k?b=l:"stop-opacity"===k&&(d=l)}}return b||(b=a.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=a.getAttribute("stop-opacity")),b=new f.Color(b),c=b.getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=c,{offset:h,color:b.toRgb(),opacity:d}}function b(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function c(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}function d(a,b,c){var d,e=0,f=1,g="";for(var h in b)"Infinity"===b[h]?b[h]=1:"-Infinity"===b[h]&&(b[h]=0),d=parseFloat(b[h],10),f="string"==typeof b[h]&&/^\d+%$/.test(b[h])?.01:1,"x1"===h||"x2"===h||"r2"===h?(f*="objectBoundingBox"===c?a.width:1,e="objectBoundingBox"===c?a.left||0:0):"y1"!==h&&"y2"!==h||(f*="objectBoundingBox"===c?a.height:1,e="objectBoundingBox"===c?a.top||0:0),b[h]=d*f+e;if("ellipse"===a.type&&null!==b.r2&&"objectBoundingBox"===c&&a.rx!==a.ry){var i=a.ry/a.rx;g=" scale(1, "+i+")",b.y1&&(b.y1/=i),b.y2&&(b.y2/=i)}return g}var e=f.util.object.clone;f.Gradient=f.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var b={};this.id=f.Object.__uid++,this.type=a.type||"linear",b={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},"radial"===this.type&&(b.r1=a.coords.r1||0,b.r2=a.coords.r2||0),this.coords=b,this.colorStops=a.colorStops.slice(),a.gradientTransform&&(this.gradientTransform=a.gradientTransform),this.offsetX=a.offsetX||this.offsetX,this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var b in a){var c=new f.Color(a[b]);this.colorStops.push({offset:parseFloat(b),color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(a){var b={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return f.util.populateWithProperties(this,b,a),b},toSVG:function(a){var b,c,d,f,g=e(this.coords,!0),h=e(this.colorStops,!0),i=g.r1>g.r2;h.sort(function(a,b){return a.offset-b.offset});for(var j in g)"x1"===j||"x2"===j?g[j]+=this.offsetX-a.width/2:"y1"!==j&&"y2"!==j||(g[j]+=this.offsetY-a.height/2);if(f='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(f+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?d=["<linearGradient ",f,' x1="',g.x1,'" y1="',g.y1,'" x2="',g.x2,'" y2="',g.y2,'">\n']:"radial"===this.type&&(d=["<radialGradient ",f,' cx="',i?g.x1:g.x2,'" cy="',i?g.y1:g.y2,'" r="',i?g.r1:g.r2,'" fx="',i?g.x2:g.x1,'" fy="',i?g.y2:g.y1,'">\n']),"radial"===this.type){if(i)for(h=h.concat(),h.reverse(),b=0,c=h.length;b<c;b++)h[b].offset=1-h[b].offset;var k=Math.min(g.r1,g.r2);if(k>0){var l=Math.max(g.r1,g.r2),m=k/l;for(b=0,c=h.length;b<c;b++)h[b].offset+=m*(1-h[b].offset)}}for(b=0,c=h.length;b<c;b++){var n=h[b];d.push("<stop ",'offset="',100*n.offset+"%",'" style="stop-color:',n.color,null!==n.opacity?";stop-opacity: "+n.opacity:";",'"/>\n')}return d.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),d.join("")},toLive:function(a){var b,c,d,e=f.util.object.clone(this.coords);if(this.type){for("linear"===this.type?b=a.createLinearGradient(e.x1,e.y1,e.x2,e.y2):"radial"===this.type&&(b=a.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2)),c=0,d=this.colorStops.length;c<d;c++){var g=this.colorStops[c].color,h=this.colorStops[c].opacity,i=this.colorStops[c].offset;"undefined"!=typeof h&&(g=new f.Color(g).setAlpha(h).toRgba()),b.addColorStop(i,g)}return b}}}),f.util.object.extend(f.Gradient,{fromElement:function(e,g){var h,i,j,k,l=e.getElementsByTagName("stop"),m=e.getAttribute("gradientUnits")||"objectBoundingBox",n=e.getAttribute("gradientTransform"),o=[];for(h="linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?"linear":"radial","linear"===h?i=b(e):"radial"===h&&(i=c(e)),k=l.length;k--;)o.push(a(l[k]));j=d(g,i,m);var p=new f.Gradient({type:h,coords:i,colorStops:o,offsetX:-g.left,offsetY:-g.top});return(n||""!==j)&&(p.gradientTransform=f.parseTransformAttribute((n||"")+j)),p},forObject:function(a,b){return b||(b={}),d(a,b.coords,"userSpaceOnUse"),new f.Gradient(b)}})}(),function(){"use strict";var a=f.util.toFixed;f.Pattern=f.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a,b){if(a||(a={}),this.id=f.Object.__uid++,this.setOptions(a),!a.source||a.source&&"string"!=typeof a.source)return void(b&&b(this));if("undefined"!=typeof f.util.getFunctionBody(a.source))this.source=new Function(f.util.getFunctionBody(a.source)),b&&b(this);else{var c=this;this.source=f.util.createImage(),f.util.loadImage(a.source,function(a){c.source=a,b&&b(c)})}},toObject:function(b){var c,d,e=f.Object.NUM_FRACTION_DIGITS;return"function"==typeof this.source?c=String(this.source):"string"==typeof this.source.src?c=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(c=this.source.toDataURL()),d={type:"pattern",source:c,repeat:this.repeat,offsetX:a(this.offsetX,e),offsetY:a(this.offsetY,e)},f.util.populateWithProperties(this,d,b),d},toSVG:function(a){var b="function"==typeof this.source?this.source():this.source,c=b.width/a.width,d=b.height/a.height,e=this.offsetX/a.width,f=this.offsetY/a.height,g="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(d=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(c=1),b.src?g=b.src:b.toDataURL&&(g=b.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+f+'" width="'+c+'" height="'+d+'">\n<image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},setOptions:function(a){for(var b in a)this[b]=a[b]},toLive:function(a){var b="function"==typeof this.source?this.source():this.source;if(!b)return"";if("undefined"!=typeof b.src){if(!b.complete)return"";if(0===b.naturalWidth||0===b.naturalHeight)return""}return a.createPattern(b,this.repeat)}})}(),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed;return b.Shadow?void b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"==typeof a&&(a=this._parseShadow(a));for(var c in a)this[c]=a[c];this.id=b.Object.__uid++},_parseShadow:function(a){var c=a.trim(),d=b.Shadow.reOffsetsAndBlur.exec(c)||[],e=c.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var d=40,e=40,f=b.Object.NUM_FRACTION_DIGITS,g=b.util.rotateVector({x:this.offsetX,y:this.offsetY},b.util.degreesToRadians(-a.angle)),h=20;return a.width&&a.height&&(d=100*c((Math.abs(g.x)+this.blur)/a.width,f)+h,e=100*c((Math.abs(g.y)+this.blur)/a.height,f)+h),a.flipX&&(g.x*=-1),a.flipY&&(g.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+e+'%" height="'+(100+2*e)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+c(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+c(g.x,f)+'" dy="'+c(g.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var a={},c=b.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(b){this[b]!==c[b]&&(a[b]=this[b])},this),a}}),void(b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof c?c:this),function(){"use strict";if(f.StaticCanvas)return void f.warn("fabric.StaticCanvas is already defined.");var a=f.util.object.extend,b=f.util.getElementOffset,c=f.util.removeFromArray,d=f.util.toFixed,e=f.util.transformPoint,g=f.util.invertTransform,h=new Error("Could not initialize `canvas` element");f.StaticCanvas=f.util.createClass(f.CommonMethods,{initialize:function(a,b){b||(b={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:f.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,_initStatic:function(a,b){var c=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(a),this._initOptions(b),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),b.overlayImage&&this.setOverlayImage(b.overlayImage,c),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,c),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,c),b.overlayColor&&this.setOverlayColor(b.overlayColor,c),this.calcOffset()},_isRetinaScaling:function(){return 1!==f.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?f.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*f.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*f.devicePixelRatio),this.contextContainer.scale(f.devicePixelRatio,f.devicePixelRatio))},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=a.imageSmoothingEnabled||a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||a.msImageSmoothingEnabled||a.oImageSmoothingEnabled,a.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){return"string"==typeof b?f.util.loadImage(b,function(b){b&&(this[a]=new f.Image(b,d)),c&&c(b)},this,d&&d.crossOrigin):(d&&b.setOptions(d),this[a]=b,c&&c(b)),this},__setBgOverlayColor:function(a,b,c){return this[a]=b,this._initGradient(b,a),this._initPattern(b,a,c),this},_createCanvasElement:function(){var a=f.util.createCanvasElement();if(!a)throw h;if(a.style||(a.style={}),"undefined"==typeof a.getContext)throw h;return a},_initOptions:function(a){this._setOptions(a),this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){a.getContext?this.lowerCanvasEl=a:this.lowerCanvasEl=f.util.getById(a)||this._createCanvasElement(),f.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px"),b.backstoreOnly||this._setCssDimension(d,c);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),b.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var b,c,d,e=this._activeObject,f=!1,g=!0;for(this.viewportTransform=a,c=0,d=this._objects.length;c<d;c++)b=this._objects[c],b.group||b.setCoords(f,g);return e&&"activeSelection"===e.type&&e.setCoords(f,g),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(a,b){var c=a,d=this.viewportTransform.slice(0);a=e(a,g(this.viewportTransform)),d[0]=b,d[3]=b;var f=e(a,d);return d[4]+=c.x-f.x,d[5]+=c.y-f.y,this.setViewportTransform(d)},setZoom:function(a){return this.zoomToPoint(new f.Point(0,0),a),this},absolutePan:function(a){var b=this.viewportTransform.slice(0);return b[4]=-a.x,b[5]=-a.y,this.setViewportTransform(b)},relativePan:function(a){return this.absolutePan(new f.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState(),a._set("canvas",this),a.setCoords(),this.fire("object:added",{target:a}),a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a}),a.fire("removed"),delete a.canvas},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var a=this.contextContainer;return this.rendering&&f.window.cancelAnimationFrame(this.rendering),this.renderCanvas(a,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=f.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var a={},b=this.width,c=this.height,d=g(this.viewportTransform);return a.tl=e({x:0,y:0},d),a.br=e({x:b,y:c},d),a.tr=new f.Point(a.br.x,a.tl.y),a.bl=new f.Point(a.tl.x,a.br.y),this.vptCoords=a,a},renderCanvas:function(a,b){this.calcViewportBoundaries(),this.clearContext(a),this.fire("before:render"),this.clipTo&&f.util.clipContext(this,a),this._renderBackground(a),a.save(),a.transform.apply(a,this.viewportTransform),this._renderObjects(a,b),a.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.clipTo&&a.restore(),this._renderOverlay(a),this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.fire("after:render")},_renderObjects:function(a,b){var c,d;for(c=0,d=b.length;c<d;++c)b[c]&&b[c].render(a)},_renderBackgroundOrOverlay:function(a,b){var c=this[b+"Color"];c&&(a.fillStyle=c.toLive?c.toLive(a,this):c,a.fillRect(c.offsetX||0,c.offsetY||0,this.width,this.height)),c=this[b+"Image"],c&&(this[b+"Vpt"]&&(a.save(),a.transform.apply(a,this.viewportTransform)),c.render(a),this[b+"Vpt"]&&a.restore())},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(a){return this._centerObject(a,new f.Point(this.getCenter().left,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,new f.Point(a.getCenterPoint().x,this.getCenter().top))},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new f.Point(b.left,b.top))},viewportCenterObject:function(a){var b=this.getVpCenter();return this._centerObject(a,b)},viewportCenterObjectH:function(a){var b=this.getVpCenter();return this._centerObject(a,new f.Point(b.x,a.getCenterPoint().y)),this},viewportCenterObjectV:function(a){var b=this.getVpCenter();return this._centerObject(a,new f.Point(a.getCenterPoint().x,b.y))},getVpCenter:function(){var a=this.getCenter(),b=g(this.viewportTransform);return e({x:a.left,y:a.top},b)},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center","center"),this.requestRenderAll(),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(b,c){var d={objects:this._toObjects(b,c)};return a(d,this.__serializeBgOverlay(b,c)),f.util.populateWithProperties(this,d,c),d},_toObjects:function(a,b){return this.getObjects().filter(function(a){return!a.excludeFromExport}).map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);var e=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=d),e},__serializeBgOverlay:function(a,b){var c={},d=this.backgroundImage,e=this.overlayImage;return this.backgroundColor&&(c.background=this.backgroundColor.toObject?this.backgroundColor.toObject(b):this.backgroundColor),this.overlayColor&&(c.overlay=this.overlayColor.toObject?this.overlayColor.toObject(b):this.overlayColor),d&&!d.excludeFromExport&&(c.backgroundImage=this._toObject(d,a,b)),e&&!e.excludeFromExport&&(c.overlayImage=this._toObject(e,a,b)),c},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage",b),this._setSVGObjects(c,b),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage",b),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var c,e=b.width||this.width,g=b.height||this.height,h='viewBox="0 0 '+this.width+" "+this.height+'" ',i=f.Object.NUM_FRACTION_DIGITS;b.viewBox?h='viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(c=this.viewportTransform,h='viewBox="'+d(-c[4]/c[0],i)+" "+d(-c[5]/c[3],i)+" "+d(this.width/c[0],i)+" "+d(this.height/c[3],i)+'" '),a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e,'" ','height="',g,'" ',h,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",f.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),"</defs>\n")},createSVGRefElementsMarkup:function(){var a=this,b=["backgroundColor","overlayColor"].map(function(b){var c=a[b];if(c&&c.toLive)return c.toSVG(a,!1)});return b.join("")},createSVGFontFacesMarkup:function(){var a,b,c,d,e,g,h,i,j,k="",l={},m=f.fontPaths,n=this.getObjects();for(i=0,j=n.length;i<j;i++)if(a=n[i],b=a.fontFamily,a.type.indexOf("text")!==-1&&!l[b]&&m[b]&&(l[b]=!0,a.styles)){c=a.styles;for(e in c){d=c[e];for(h in d)g=d[h],b=g.fontFamily,!l[b]&&m[b]&&(l[b]=!0)}}for(var o in l)k+=["\t\t@font-face {\n","\t\t\tfont-family: '",o,"';\n","\t\t\tsrc: url('",m[o],"');\n","\t\t}\n"].join("");return k&&(k=['\t<style type="text/css">',"<![CDATA[\n",k,"]]>","</style>\n"].join("")),k},_setSVGObjects:function(a,b){var c,d,e,f=this.getObjects();for(d=0,e=f.length;d<e;d++)c=f[d],c.excludeFromExport||this._setSVGObject(a,c,b)},_setSVGObject:function(a,b,c){a.push(b.toSVG(c))},_setSVGBgOverlayImage:function(a,b,c){this[b]&&this[b].toSVG&&a.push(this[b].toSVG(c))},_setSVGBgOverlayColor:function(a,b){var c=this[b];if(c)if(c.toLive){var d=c.repeat;a.push('<rect transform="translate(',this.width/2,",",this.height/2,')"',' x="',c.offsetX-this.width/2,'" y="',c.offsetY-this.height/2,'" ','width="',"repeat-y"===d||"no-repeat"===d?c.source.width:this.width,'" height="',"repeat-x"===d||"no-repeat"===d?c.source.height:this.height,'" fill="url(#SVGID_'+c.id+')"',"></rect>\n")}else a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>\n")},sendToBack:function(a){if(!a)return this;var b,d,e,f=this._activeObject;if(a===f&&"activeSelection"===a.type)for(e=f._objects,b=e.length;b--;)d=e[b],c(this._objects,d),this._objects.unshift(d);else c(this._objects,a),this._objects.unshift(a);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(a){if(!a)return this;var b,d,e,f=this._activeObject;if(a===f&&"activeSelection"===a.type)for(e=f._objects,b=0;b<e.length;b++)d=e[b],c(this._objects,d),this._objects.push(d);else c(this._objects,a),this._objects.push(a);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(a,b){if(!a)return this;var d,e,f,g,h,i=this._activeObject,j=0;if(a===i&&"activeSelection"===a.type)for(h=i._objects,d=0;d<h.length;d++)e=h[d],f=this._objects.indexOf(e),f>0+j&&(g=f-1,c(this._objects,e),this._objects.splice(g,0,e)),j++;else f=this._objects.indexOf(a),0!==f&&(g=this._findNewLowerIndex(a,f,b),c(this._objects,a),this._objects.splice(g,0,a));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(a,b,c){var d,e;if(c)for(d=b,e=b-1;e>=0;--e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}else d=b-1;return d},bringForward:function(a,b){if(!a)return this;var d,e,f,g,h,i=this._activeObject,j=0;if(a===i&&"activeSelection"===a.type)for(h=i._objects,d=h.length;d--;)e=h[d],f=this._objects.indexOf(e),f<this._objects.length-1-j&&(g=f+1,c(this._objects,e),this._objects.splice(g,0,e)),j++;else f=this._objects.indexOf(a),f!==this._objects.length-1&&(g=this._findNewUpperIndex(a,f,b),c(this._objects,a),this._objects.splice(g,0,a));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(a,b,c){var d,e,f;if(c)for(d=b,e=b+1,f=this._objects.length;e<f;++e){var g=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(g){d=e;break}}else d=b+1;return d},moveTo:function(a,b){return c(this._objects,a),this._objects.splice(b,0,a),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),a(f.StaticCanvas.prototype,f.Observable),a(f.StaticCanvas.prototype,f.Collection),a(f.StaticCanvas.prototype,f.DataURLExporter),a(f.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=f.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case"getImageData":return"undefined"!=typeof c.getImageData;case"setLineDash":return"undefined"!=typeof c.setLineDash;case"toDataURL":return"undefined"!=typeof b.toDataURL;case"toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}}),f.StaticCanvas.prototype.toJSON=f.StaticCanvas.prototype.toObject}(),f.BaseBrush=f.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(a){return this.shadow=new f.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,this.strokeDashArray&&f.StaticCanvas.supports("setLineDash")&&a.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var a=this.canvas.contextTop,b=this.canvas.getZoom();a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*b,a.shadowOffsetX=this.shadow.offsetX*b,a.shadowOffsetY=this.shadow.offsetY*b}},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),function(){f.PencilBrush=f.util.createClass(f.BaseBrush,{initialize:function(a){this.canvas=a,this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a),this._captureDrawingPath(a),this._render()},onMouseMove:function(a){this._captureDrawingPath(a),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){var b=new f.Point(a.x,a.y);this._reset(),this._addPoint(b),this.canvas.contextTop.moveTo(b.x,b.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(a){var b=new f.Point(a.x,a.y);this._addPoint(b)},_render:function(){var a,b,c=this.canvas.contextTop,d=this.canvas.viewportTransform,e=this._points[0],f=this._points[1];for(c.save(),c.transform(d[0],d[1],d[2],d[3],d[4],d[5]),c.beginPath(),2===this._points.length&&e.x===f.x&&e.y===f.y&&(e.x-=.5,f.x+=.5),c.moveTo(e.x,e.y),a=1,b=this._points.length;a<b;a++){var g=e.midPointFrom(f);c.quadraticCurveTo(e.x,e.y,g.x,g.y),e=this._points[a],f=this._points[a+1]}c.lineTo(e.x,e.y),c.stroke(),c.restore()},convertPointsToSVGPath:function(a){var b,c,d=[],e=new f.Point(a[0].x,a[0].y),g=new f.Point(a[1].x,a[1].y);for(d.push("M ",a[0].x," ",a[0].y," "),b=1,c=a.length;b<c;b++){var h=e.midPointFrom(g);d.push("Q ",e.x," ",e.y," ",h.x," ",h.y," "),e=new f.Point(a[b].x,a[b].y),b+1<a.length&&(g=new f.Point(a[b+1].x,a[b+1].y))}return d.push("L ",e.x," ",e.y," "),d},createPath:function(a){var b=new f.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow)),b},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var b=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)return void this.canvas.requestRenderAll();var c=this.createPath(b);this.canvas.add(c),c.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.requestRenderAll(),this.canvas.fire("path:created",{path:c})}})}(),f.CircleBrush=f.util.createClass(f.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var b=this.addPoint(a),c=this.canvas.contextTop,d=this.canvas.viewportTransform;c.save(),c.transform(d[0],d[1],d[2],d[3],d[4],d[5]),
c.fillStyle=b.fill,c.beginPath(),c.arc(b.x,b.y,b.radius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var a,b,c=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var d=[];for(a=0,b=this.points.length;a<b;a++){var e=this.points[a],g=new f.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&g.setShadow(this.shadow),d.push(g)}var h=new f.Group(d,{originX:"center",originY:"center"});h.canvas=this.canvas,this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=c,this.canvas.requestRenderAll()},addPoint:function(a){var b=new f.Point(a.x,a.y),c=f.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new f.Color(this.color).setAlpha(f.util.getRandomInt(0,100)/100).toRgba();return b.radius=c,b.fill=d,this.points.push(b),b}}),f.SprayBrush=f.util.createClass(f.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render()},onMouseMove:function(a){this.addSprayChunk(a),this.render()},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.sprayChunks.length;c<d;c++)for(var e=this.sprayChunks[c],g=0,h=e.length;g<h;g++){var i=new f.Rect({width:e[g].width,height:e[g].width,left:e[g].x+1,top:e[g].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&i.setShadow(this.shadow),b.push(i)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));var j=new f.Group(b,{originX:"center",originY:"center"});j.canvas=this.canvas,this.canvas.add(j),this.canvas.fire("path:created",{path:j}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},_getOptimizedRects:function(a){var b,c,d,e={};for(c=0,d=a.length;c<d;c++)b=a[c].left+""+a[c].top,e[b]||(e[b]=a[c]);var f=[];for(b in e)f.push(e[b]);return f},render:function(){var a=this.canvas.contextTop;a.fillStyle=this.color;var b,c,d=this.canvas.viewportTransform;for(a.save(),a.transform(d[0],d[1],d[2],d[3],d[4],d[5]),b=0,c=this.sprayChunkPoints.length;b<c;b++){var e=this.sprayChunkPoints[b];"undefined"!=typeof e.opacity&&(a.globalAlpha=e.opacity),a.fillRect(e.x,e.y,e.width,e.width)}a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var b,c,d,e,g=this.width/2;for(e=0;e<this.density;e++){b=f.util.getRandomInt(a.x-g,a.x+g),c=f.util.getRandomInt(a.y-g,a.y+g),d=this.dotWidthVariance?f.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var h=new f.Point(b,c);h.width=d,this.randomOpacity&&(h.opacity=f.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(h)}this.sprayChunks.push(this.sprayChunkPoints)}}),f.PatternBrush=f.util.createClass(f.PencilBrush,{getPatternSrc:function(){var a=20,b=5,c=f.document.createElement("canvas"),d=c.getContext("2d");return c.width=c.height=a+b,d.fillStyle=this.color,d.beginPath(),d.arc(a/2,a/2,a/2,0,2*Math.PI,!1),d.closePath(),d.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(a){var b=this.callSuper("createPath",a),c=b._getLeftTopCoords().scalarAdd(b.strokeWidth/2);return b.stroke=new f.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-c.x,offsetY:-c.y}),b}}),function(){var a=f.util.getPointer,b=f.util.degreesToRadians,c=f.util.radiansToDegrees,d=Math.atan2,e=Math.abs,g=f.StaticCanvas.supports("setLineDash"),h=.5;f.Canvas=f.util.createClass(f.StaticCanvas,{initialize:function(a,b){b||(b={}),this.renderAndResetBound=this.renderAndReset.bind(this),this._initStatic(a,b),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=f.PencilBrush&&new f.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var a,b,c,d=this.getActiveObjects();if(d.length>0&&!this.preserveObjectStacking){b=[],c=[];for(var e=0,f=this._objects.length;e<f;e++)a=this._objects[e],d.indexOf(a)===-1?b.push(a):c.push(a);d.length>1&&(this._activeObject._objects=c),b.push.apply(b,c)}else b=this._objects;return b},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var a=this.contextContainer;return this.renderCanvas(a,this._chooseObjectsToRender()),this},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.selection&&this._groupSelector&&this._drawSelection(a),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top}),this._shouldCenterTransform(a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&("right"===a.originX?a.mouseXSign=-1:a.mouseXSign=1),"center"!==a.originY&&("bottom"===a.originY?a.mouseYSign=-1:a.mouseYSign=1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b,c){var d,e=!0,f=c||this.getPointer(a,e);return d=b.group&&b.group===this._activeObject&&"activeSelection"===b.group.type?this._normalizePointer(b.group,f):{x:f.x,y:f.y},b.containsPoint(d)||b._findTargetCorner(f)},_normalizePointer:function(a,b){var c=a.calcTransformMatrix(),d=f.util.invertTransform(c),e=this.restorePointerVpt(b);return f.util.transformPoint(e,d)},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners,g=this.contextCache,h=a.selectionBackgroundColor;a.hasBorders=a.transparentCorners=!1,a.selectionBackgroundColor="",g.save(),g.transform.apply(g,this.viewportTransform),a.render(g),g.restore(),a.active&&a._renderControls(g),a.hasBorders=d,a.transparentCorners=e,a.selectionBackgroundColor=h;var i=f.util.isTransparent(g,b,c,this.targetFindTolerance);return this.clearContext(g),i},_shouldClearSelection:function(a,b){var c=this.getActiveObjects(),d=this._activeObject;return!b||b&&d&&c.length>1&&c.indexOf(b)===-1&&d!==b&&!a[this.selectionKey]||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a){if(a){var b,c=this._currentTransform;return"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?b=this.centeredScaling||a.centeredScaling:"rotate"===c.action&&(b=this.centeredRotation||a.centeredRotation),b?!c.altKey:c.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":"mr"!==b&&"tr"!==b&&"br"!==b||(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":"bl"!==b&&"mb"!==b&&"br"!==b||(c.y="top"),c},_getActionFromCorner:function(a,b,c){if(!b)return"drag";switch(b){case"mtr":return"rotate";case"ml":case"mr":return c[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return c[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,c){if(c){var d=this.getPointer(a),e=c._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(c,e,a),g=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:f,corner:e,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:g.x,originY:g.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,left:c.left,top:c.top,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey]},this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,originX:g.x,originY:g.y},this._resetCurrentTransform()}},_translateObject:function(a,b){var c=this._currentTransform,d=c.target,e=a-c.offsetX,f=b-c.offsetY,g=!d.get("lockMovementX")&&d.left!==e,h=!d.get("lockMovementY")&&d.top!==f;return g&&d.set("left",e),h&&d.set("top",f),g||h},_changeSkewTransformOrigin:function(a,b,c){var d="originX",e={0:"center"},f=b.target.skewX,g="left",h="right",i="mt"===b.corner||"ml"===b.corner?1:-1,j=1;a=a>0?1:-1,"y"===c&&(f=b.target.skewY,g="top",h="bottom",d="originY"),e[-1]=g,e[1]=h,b.target.flipX&&(j*=-1),b.target.flipY&&(j*=-1),0===f?(b.skewSign=-i*a*j,b[d]=e[-a]):(f=f>0?1:-1,b.skewSign=f,b[d]=e[f*i*j])},_skewObject:function(a,b,c){var d=this._currentTransform,e=d.target,g=!1,h=e.get("lockSkewingX"),i=e.get("lockSkewingY");if(h&&"x"===c||i&&"y"===c)return!1;var j,k,l=e.getCenterPoint(),m=e.toLocalPoint(new f.Point(a,b),"center","center")[c],n=e.toLocalPoint(new f.Point(d.lastX,d.lastY),"center","center")[c],o=e._getTransformedDimensions();return this._changeSkewTransformOrigin(m-n,d,c),j=e.toLocalPoint(new f.Point(a,b),d.originX,d.originY)[c],k=e.translateToOriginPoint(l,d.originX,d.originY),g=this._setObjectSkew(j,d,c,o),d.lastX=a,d.lastY=b,e.setPositionByOrigin(k,d.originX,d.originY),g},_setObjectSkew:function(a,b,c,d){var e,g,h,i,j,k,l,m,n,o=b.target,p=!1,q=b.skewSign;return"x"===c?(i="y",j="Y",k="X",m=0,n=o.skewY):(i="x",j="X",k="Y",m=o.skewX,n=0),h=o._getTransformedDimensions(m,n),l=2*Math.abs(a)-h[c],l<=2?e=0:(e=q*Math.atan(l/o["scale"+k]/(h[i]/o["scale"+j])),e=f.util.radiansToDegrees(e)),p=o["skew"+k]!==e,o.set("skew"+k,e),0!==o["skew"+j]&&(g=o._getTransformedDimensions(),e=d[i]/g[i]*o["scale"+j],o.set("scale"+j,e)),p},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,g=e.get("lockScalingX"),h=e.get("lockScalingY"),i=e.get("lockScalingFlip");if(g&&h)return!1;var j=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY),k=e.toLocalPoint(new f.Point(a,b),d.originX,d.originY),l=e._getTransformedDimensions(),m=!1;return this._setLocalMouse(k,d),m=this._setObjectScale(k,d,g,h,c,i,l),e.setPositionByOrigin(j,d.originX,d.originY),m},_setObjectScale:function(a,b,c,d,e,f,g){var h,i,j,k,l=b.target,m=!1,n=!1,o=!1;return j=a.x*l.scaleX/g.x,k=a.y*l.scaleY/g.y,h=l.scaleX!==j,i=l.scaleY!==k,f&&j<=0&&j<l.scaleX&&(m=!0),f&&k<=0&&k<l.scaleY&&(n=!0),"equally"!==e||c||d?e?"x"!==e||l.get("lockUniScaling")?"y"!==e||l.get("lockUniScaling")||n||d||l.set("scaleY",k)&&(o=o||i):m||c||l.set("scaleX",j)&&(o=o||h):(m||c||l.set("scaleX",j)&&(o=o||h),n||d||l.set("scaleY",k)&&(o=o||i)):m||n||(o=this._scaleObjectEqually(a,l,b,g)),b.newScaleX=j,b.newScaleY=k,m||n||this._flipObject(b,e),o},_scaleObjectEqually:function(a,b,c,d){var e,f=a.y+a.x,g=d.y*c.original.scaleY/b.scaleY+d.x*c.original.scaleX/b.scaleX;return c.newScaleX=c.original.scaleX*f/g,c.newScaleY=c.original.scaleY*f/g,e=c.newScaleX!==b.scaleX||c.newScaleY!==b.scaleY,b.set("scaleX",c.newScaleX),b.set("scaleY",c.newScaleY),e},_flipObject:function(a,b){a.newScaleX<0&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left")),a.newScaleY<0&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target,d=this.getZoom(),f=c.padding/d;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x*=2*b.mouseXSign,a.x<0&&(b.mouseXSign=-b.mouseXSign)),"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y*=2*b.mouseYSign,a.y<0&&(b.mouseYSign=-b.mouseYSign)),e(a.x)>f?a.x<0?a.x+=f:a.x-=f:a.x=0,e(a.y)>f?a.y<0?a.y+=f:a.y-=f:a.y=0},_rotateObject:function(a,b){var e=this._currentTransform;if(e.target.get("lockRotation"))return!1;var f=d(e.ey-e.top,e.ex-e.left),g=d(b-e.top,a-e.left),h=c(g-f+e.theta),i=!0;if(e.target.snapAngle>0){var j=e.target.snapAngle,k=e.target.snapThreshold||j,l=Math.ceil(h/j)*j,m=Math.floor(h/j)*j;Math.abs(h-m)<k?h=m:Math.abs(h-l)<k&&(h=l)}return h<0&&(h=360+h),h%=360,e.target.angle===h?i=!1:e.target.angle=h,i},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.setAngle(0)},_drawSelection:function(a){var b=this._groupSelector,c=b.left,d=b.top,i=e(c),j=e(d);if(this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(c>0?0:-c),b.ey-(d>0?0:-d),i,j)),this.selectionLineWidth&&this.selectionBorderColor)if(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!g){var k=b.ex+h-(c>0?0:i),l=b.ey+h-(d>0?0:j);a.beginPath(),f.util.drawDashedLine(a,k,l,k+i,l,this.selectionDashArray),f.util.drawDashedLine(a,k,l+j-1,k+i,l+j-1,this.selectionDashArray),f.util.drawDashedLine(a,k,l,k,l+j,this.selectionDashArray),f.util.drawDashedLine(a,k+i-1,l,k+i-1,l+j,this.selectionDashArray),a.closePath(),a.stroke()}else f.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(b.ex+h-(c>0?0:i),b.ey+h-(d>0?0:j),i,j)},findTarget:function(a,b){if(!this.skipTargetFind){var c,d=!0,e=this.getPointer(a,d),f=this._activeObject,g=this.getActiveObjects();if(this.targets=[],g.length>1&&!b&&f===this._searchPossibleTargets([f],e))return this._fireOverOutEvents(f,a),f;if(1===g.length&&f._findTargetCorner(e))return this._fireOverOutEvents(f,a),f;if(1===g.length&&f===this._searchPossibleTargets([f],e)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(f,a),f;c=f}var h=this._searchPossibleTargets(this._objects,e);return a[this.altSelectionKey]&&h&&c&&h!==c&&(h=c),this._fireOverOutEvents(h,a),h}},_fireOverOutEvents:function(a,b){var c,d,e=this._hoveredTarget;e!==a&&(c={e:b,target:a,previousTarget:this._hoveredTarget},d={e:b,target:this._hoveredTarget,nextTarget:a},this._hoveredTarget=a),a?e!==a&&(e&&(this.fire("mouse:out",d),e.fire("mouseout",d)),this.fire("mouse:over",c),a.fire("mouseover",c)):e&&(this.fire("mouse:out",d),e.fire("mouseout",d))},_checkTarget:function(a,b){if(b&&b.visible&&b.evented&&this.containsPoint(null,b,a)){if(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing)return!0;var c=this.isTargetTransparent(b,a.x,a.y);if(!c)return!0}},_searchPossibleTargets:function(a,b){for(var c,d,e,f=a.length;f--;)if(this._checkTarget(b,a[f])){c=a[f],"group"===c.type&&c.subTargetCheck&&(d=this._normalizePointer(c,b),e=this._searchPossibleTargets(c._objects,d),e&&this.targets.push(e));break}return c},restorePointerVpt:function(a){return f.util.transformPoint(a,f.util.invertTransform(this.viewportTransform))},getPointer:function(b,c,d){d||(d=this.upperCanvasEl);var e,f=a(b),g=d.getBoundingClientRect(),h=g.width||0,i=g.height||0;return h&&i||("top"in g&&"bottom"in g&&(i=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(h=Math.abs(g.right-g.left))),this.calcOffset(),f.x=f.x-this._offset.left,f.y=f.y-this._offset.top,c||(f=this.restorePointerVpt(f)),e=0===h||0===i?{width:1,height:1}:{width:d.width/h,height:d.height/i},{x:f.x*e.width,y:f.y*e.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),f.util.addClass(this.upperCanvasEl,"upper-canvas "+a),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=f.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),f.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),f.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.width||a.width,c=this.height||a.height;f.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0,"touch-action":"none"}),a.width=b,a.height=c,f.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?"activeSelection"===a.type&&a._objects?a._objects:[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),this._hoveredTarget===a&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",a)},setActiveObject:function(a,b){var c=this._activeObject;return a===c?this:(this._setActiveObject(a,b)&&(c&&c.fire("deselected",{e:b}),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b})),this)},_setActiveObject:function(a,b){var c=this._activeObject;return c!==a&&!a.onSelect({e:b})&&(!!this._discardActiveObject(b)&&(this._activeObject=a,a.set("active",!0),!0))},_discardActiveObject:function(a){var b=this._activeObject;if(b&&b.onDeselect&&"function"==typeof b.onDeselect){if(b.onDeselect({e:a}))return!1;b.set("active",!1),this._activeObject=null}return!0},discardActiveObject:function(a){var b=this._activeObject;return b&&(this.fire("before:selection:cleared",{target:b,e:a}),this._discardActiveObject(a)&&(this.fire("selection:cleared",{e:a}),b.fire("deselected",{e:a}))),this},dispose:function(){f.StaticCanvas.prototype.dispose.call(this);var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var b=this._activeObject;b&&b._renderControls(a)},_toObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(a),e=this.callSuper("_toObject",a,b,c);return this._unwindGroupTransformOnObject(a,d),e},_realizeGroupTransformOnObject:function(a){if(a.group&&"activeSelection"===a.group.type&&this._activeObject===a.group){var b=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],c={};return b.forEach(function(b){c[b]=a[b]}),this._activeObject.realizeTransform(a),c}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},_setSVGObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(b);this.callSuper("_setSVGObject",a,b,c),this._unwindGroupTransformOnObject(b,d)}});for(var i in f.StaticCanvas)"prototype"!==i&&(f.Canvas[i]=f.StaticCanvas[i]);f.isTouchSupported&&(f.Canvas.prototype._setCursorFromEvent=function(){})}(),function(){function a(a,b){return"which"in a?a.which===b:a.button===b-1}var b={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=f.util.addListener,d=f.util.removeListener,e=3,g=2,h=1;f.util.object.extend(f.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),c(f.window,"resize",this._onResize),c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"dblclick",this._onDoubleClick),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"mouseout",this._onMouseOut),c(this.upperCanvasEl,"mouseenter",this._onMouseEnter),c(this.upperCanvasEl,"wheel",this._onMouseWheel),c(this.upperCanvasEl,"contextmenu",this._onContextMenu),c(this.upperCanvasEl,"touchstart",this._onMouseDown,{passive:!1}),c(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this.eventsBinded||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this.eventsBinded=!0)},removeListeners:function(){d(f.window,"resize",this._onResize),d(this.upperCanvasEl,"mousedown",this._onMouseDown),d(this.upperCanvasEl,"mousemove",this._onMouseMove),d(this.upperCanvasEl,"mouseout",this._onMouseOut),d(this.upperCanvasEl,"mouseenter",this._onMouseEnter),d(this.upperCanvasEl,"wheel",this._onMouseWheel),d(this.upperCanvasEl,"contextmenu",this._onContextMenu),d(this.upperCanvasEl,"doubleclick",this._onDoubleClick),d(this.upperCanvasEl,"touchstart",this._onMouseDown),d(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var b=this._hoveredTarget;this.fire("mouse:out",{target:b,e:a}),this._hoveredTarget=null,b&&b.fire("mouseout",{e:a}),this._iTextInstances&&this._iTextInstances.forEach(function(a){a.isEditing&&a.hiddenTextarea.focus()})},_onMouseEnter:function(a){this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){var b;this._handleEvent(a,"dblclick",b)},_onMouseDown:function(a){this.__onMouseDown(a),c(f.document,"touchend",this._onMouseUp,{passive:!1}),c(f.document,"touchmove",this._onMouseMove,{passive:!1}),d(this.upperCanvasEl,"mousemove",this._onMouseMove),d(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===a.type?d(this.upperCanvasEl,"mousedown",this._onMouseDown):(c(f.document,"mouseup",this._onMouseUp),c(f.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){if(this.__onMouseUp(a),d(f.document,"mouseup",this._onMouseUp),d(f.document,"touchend",this._onMouseUp),d(f.document,"mousemove",this._onMouseMove),d(f.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"touchend"===a.type){var b=this;setTimeout(function(){c(b.upperCanvasEl,"mousedown",b._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this._activeObject;return(!c||!c.isEditing||a!==c)&&!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(b){var c;if(a(b,e))return void(this.fireRightClick&&this._handleEvent(b,"up",c,e));if(a(b,g))return void(this.fireMiddleClick&&this._handleEvent(b,"up",c,g));if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(b);var d=!0,f=this._currentTransform,i=this._groupSelector,j=!i||0===i.left&&0===i.top;f&&(this._finalizeCurrentTransform(b),d=!f.actionPerformed),c=d?this.findTarget(b,!0):f.target;var k=this._shouldRender(c,this.getPointer(b));c||!j?this._maybeGroupObjects(b):(this._groupSelector=null,this._currentTransform=null),c&&(c.isMoving=!1),this._setCursorFromEvent(b,c),this._handleEvent(b,"up",c?c:null,h,j),c&&(c.__corner=0),k&&this.requestRenderAll()},_handleEvent:function(a,b,c,d,e){var f="undefined"==typeof c?this.findTarget(a):c,g=this.targets||[],i={e:a,target:f,subTargets:g,button:d||h,isClick:e||!1};this.fire("mouse:"+b,i),f&&f.fire("mouse"+b,i);for(var j=0;j<g.length;j++)g[j].fire("mouse"+b,i)},_finalizeCurrentTransform:function(a){var b=this._currentTransform,c=b.target;c._scaling&&(c._scaling=!1),c.setCoords(),this._restoreOriginXY(c),(b.actionPerformed||this.stateful&&c.hasStateChanged())&&(this.fire("object:modified",{target:c,e:a}),c.fire("modified",{e:a}))},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.discardActiveObject(a).requestRenderAll(),this.clipTo&&f.util.clipContext(this,this.contextTop);var b=this.getPointer(a);this.freeDrawingBrush.onMouseDown(b),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=this.getPointer(a);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(a,"up")},__onMouseDown:function(b){var c=this.findTarget(b);if(a(b,e))return void(this.fireRightClick&&this._handleEvent(b,"down",c?c:null,e));if(a(b,g))return void(this.fireMiddleClick&&this._handleEvent(b,"down",c?c:null,g));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(b);if(!this._currentTransform){var d=this.getPointer(b,!0);this._previousPointer=d;var f=this._shouldRender(c,d),h=this._shouldGroup(b,c);this._shouldClearSelection(b,c)?this.discardActiveObject(b):h&&(this._handleGrouping(b,c),c=this._activeObject),!this.selection||c&&(c.selectable||c.isEditing||c===this._activeObject)||(this._groupSelector={ex:d.x,ey:d.y,top:0,left:0}),c&&(!c.selectable&&c!==this._activeObject||!c.__corner&&h||(this._beforeTransform(b,c),this._setupCurrentTransform(b,c)),c.selectable&&this.setActiveObject(c,b)),this._handleEvent(b,"down",c?c:null),f&&this.requestRenderAll()}},_beforeTransform:function(a,b){this.stateful&&b.saveState(),b._findTargetCorner(this.getPointer(a))&&this.onBeforeScaleRotate(b)},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center",a.originY="center",a.left=b.x,a.top=b.y,this._currentTransform.left=a.left,this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);if(!("undefined"!=typeof a.touches&&a.touches.length>1)){var d=this._groupSelector;d?(c=this.getPointer(a,!0),d.left=c.x-d.ex,d.top=c.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),this._setCursorFromEvent(a,b)),this._handleEvent(a,"move",b?b:null)}},__onMouseWheel:function(a){this._handleEvent(a,"wheel")},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1,c.target.isMoving=!0,c.shiftKey=a.shiftKey,c.altKey=a[this.centeredKey],this._beforeScaleTransform(a,c),this._performTransformAction(a,c,b),c.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,b,c){var d=c.x,e=c.y,f=b.target,g=b.action,h=!1;"rotate"===g?(h=this._rotateObject(d,e))&&this._fire("rotating",f,a):"scale"===g?(h=this._onScale(a,b,d,e))&&this._fire("scaling",f,a):"scaleX"===g?(h=this._scaleObject(d,e,"x"))&&this._fire("scaling",f,a):"scaleY"===g?(h=this._scaleObject(d,e,"y"))&&this._fire("scaling",f,a):"skewX"===g?(h=this._skewObject(d,e,"x"))&&this._fire("skewing",f,a):"skewY"===g?(h=this._skewObject(d,e,"y"))&&this._fire("skewing",f,a):(h=this._translateObject(d,e),h&&(this._fire("moving",f,a),this.setCursor(f.moveCursor||this.moveCursor))),b.actionPerformed=b.actionPerformed||h},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c}),b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(),b.reset=!0)}},_onScale:function(a,b,c,d){return this._isUniscalePossible(a,b.target)?(b.currentAction="scale",this._scaleObject(c,d)):(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(c,d,"equally"))},_isUniscalePossible:function(a,b){return(a[this.uniScaleKey]||this.uniScaleTransform)&&!b.get("lockUniScaling")},_setCursorFromEvent:function(a,b){if(!b)return this.setCursor(this.defaultCursor),!1;var c=b.hoverCursor||this.hoverCursor,d=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,e=(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));e?this.setCursor(this.getCornerCursor(e,b,a)):this.setCursor(c)},getCornerCursor:function(a,c,d){return this.actionIsDisabled(a,c,d)?this.notAllowedCursor:a in b?this._getRotatedCornerCursor(a,c,d):"mtr"===a&&c.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(a,b,c){return"mt"===a||"mb"===a?c[this.altActionKey]?b.lockSkewingX:b.lockScalingY:"ml"===a||"mr"===a?c[this.altActionKey]?b.lockSkewingY:b.lockScalingX:"mtr"===a?b.lockRotation:this._isUniscalePossible(c,b)?b.lockScalingX&&b.lockScalingY:b.lockScalingX||b.lockScalingY},_getRotatedCornerCursor:function(a,c,d){var e=Math.round(c.angle%360/45);return e<0&&(e+=8),e+=b[a],d[this.altActionKey]&&b[a]%2===0&&(e+=2),e%=8,this.cursorMap[e]}
})}(),function(){var a=Math.min,b=Math.max;f.util.object.extend(f.Canvas.prototype,{_shouldGroup:function(a,b){var c=this._activeObject;return c&&a[this.selectionKey]&&b&&b.selectable&&this.selection&&(c!==b||"activeSelection"===c.type)},_handleGrouping:function(a,b){var c=this._activeObject;c.__corner||(b!==c||(b=this.findTarget(a,!0)))&&(c&&"activeSelection"===c.type?this._updateActiveSelection(b,a):this._createActiveSelection(b,a))},_updateActiveSelection:function(a,b){var c=this._activeObject;if(c.contains(a)){if(c.removeWithUpdate(a),1===c.size())return void this.setActiveObject(c.item(0),b)}else c.addWithUpdate(a);this.fire("selection:created",{target:c,e:b})},_createActiveSelection:function(a,b){var c=this._createGroup(a);this.setActiveObject(c,b),this.fire("selection:created",{target:c,e:b})},_createGroup:function(a){var b=this.getObjects(),c=b.indexOf(this._activeObject)<b.indexOf(a),d=c?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new f.ActiveSelection(d,{canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],a):b.length>1&&(b=new f.ActiveSelection(b.reverse(),{canvas:this}),this.setActiveObject(b,a),this.fire("selection:created",{target:b,e:a}),this.requestRenderAll())},_collectObjects:function(){for(var c,d=[],e=this._groupSelector.ex,g=this._groupSelector.ey,h=e+this._groupSelector.left,i=g+this._groupSelector.top,j=new f.Point(a(e,h),a(g,i)),k=new f.Point(b(e,h),b(g,i)),l=e===h&&g===i,m=this._objects.length;m--&&(c=this._objects[m],!(c&&c.selectable&&c.visible&&(c.intersectsWithRect(j,k)||c.isContainedWithinRect(j,k)||c.containsPoint(j)||c.containsPoint(k))&&(d.push(c),l))););return d},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a),this.setCursor(this.defaultCursor),this._groupSelector=null,this._currentTransform=null}})}(),function(){var a=f.StaticCanvas.supports("toDataURLWithQuality");f.util.object.extend(f.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1,d=a.multiplier||1,e={left:a.left||0,top:a.top||0,width:a.width||0,height:a.height||0};return this.__toDataURLWithMultiplier(b,c,e,d)},__toDataURLWithMultiplier:function(a,b,c,d){var e=this.width,f=this.height,g=(c.width||this.width)*d,h=(c.height||this.height)*d,i=this.getZoom(),j=i*d,k=this.viewportTransform,l=(k[4]-c.left)*d,m=(k[5]-c.top)*d,n=[j,0,0,j,l,m],o=this.interactive,p=this.skipOffscreen;this.viewportTransform=n,this.skipOffscreen=!1,this.interactive=!1,e===g&&f===h||this.setDimensions({width:g,height:h}),this.renderAll();var q=this.__toDataURL(a,b,c);return this.interactive=o,this.skipOffscreen=p,this.viewportTransform=k,this.setDimensions({width:e,height:f}),q},__toDataURL:function(b,c){var d=this.contextContainer.canvas;"jpg"===b&&(b="jpeg");var e=a?d.toDataURL("image/"+b,c):d.toDataURL("image/"+b);return e}})}(),f.util.object.extend(f.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b,c){return this.loadFromJSON(a,b,c)},loadFromJSON:function(a,b,c){if(a){var d="string"==typeof a?JSON.parse(a):f.util.object.clone(a),e=this,g=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(d.objects,function(a){e.clear(),e._setBgOverlay(d,function(){a.forEach(function(a,b){e.insertAt(a,b)}),e.renderOnAddRemove=g,delete d.objects,delete d.backgroundImage,delete d.overlayImage,delete d.background,delete d.overlay,e._setOptions(d),e.renderAll(),b&&b()})},c),this}},_setBgOverlay:function(a,b){var c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(a.backgroundImage||a.overlayImage||a.background||a.overlay))return void(b&&b());var d=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&b&&b()};this.__setBgOverlay("backgroundImage",a.backgroundImage,c,d),this.__setBgOverlay("overlayImage",a.overlayImage,c,d),this.__setBgOverlay("backgroundColor",a.background,c,d),this.__setBgOverlay("overlayColor",a.overlay,c,d)},__setBgOverlay:function(a,b,c,d){var e=this;return b?void("backgroundImage"===a||"overlayImage"===a?f.util.enlivenObjects([b],function(b){e[a]=b[0],c[a]=!0,d&&d()}):this["set"+f.util.string.capitalize(a,!0)](b,function(){c[a]=!0,d&&d()})):(c[a]=!0,void(d&&d()))},_enlivenObjects:function(a,b,c){return a&&0!==a.length?void f.util.enlivenObjects(a,function(a){b&&b(a)},null,c):void(b&&b([]))},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(a,b))})},clone:function(a,b){var c=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(b){b.loadFromJSON(c,function(){a&&a(b)})})},cloneWithoutData:function(a){var b=f.document.createElement("canvas");b.width=this.width,b.height=this.height;var c=new f.Canvas(b);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e=b.util.toFixed,f=b.util.string.capitalize,g=b.util.degreesToRadians,h=b.StaticCanvas.supports("setLineDash"),i=!b.isLikelyNode,j=2;b.Object||(b.Object=b.util.createClass(b.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:i,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=b.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas()},_limitCacheSize:function(a){var c=b.perfLimitSizeTotal,d=b.cacheSideLimit,e=a.width,f=a.height,g=e/f,h=b.util.limitDimsByArea(g,c,d),i=b.util.capValue,j=b.maxCacheSideLimit,k=b.minCacheSideLimit,l=i(k,h.x,j),m=i(k,h.y,j);return e>l?(a.zoomX/=e/l,a.width=l):e<k&&(a.width=k),f>m?(a.zoomY/=f/m,a.height=m):f<k&&(a.height=k),a},_getCacheCanvasDimensions:function(){var a=this.canvas&&this.canvas.getZoom()||1,c=this.getObjectScaling(),d=this._getNonTransformedDimensions(),e=this.canvas&&this.canvas._isRetinaScaling()?b.devicePixelRatio:1,f=c.scaleX*a*e,g=c.scaleY*a*e,h=d.x*f,i=d.y*g;return{width:h+j,height:i+j,zoomX:f,zoomY:g}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var a=this.canvas._currentTransform.action;if(a.slice&&"scale"===a.slice(0,5))return!1}var c=this._limitCacheSize(this._getCacheCanvasDimensions()),d=b.minCacheSideLimit,e=c.width,f=c.height,g=c.zoomX,h=c.zoomY,i=e!==this.cacheWidth||f!==this.cacheHeight,j=this.zoomX!==g||this.zoomY!==h,k=i||j,l=0,m=0,n=!1;if(i){var o=this._cacheCanvas.width,p=this._cacheCanvas.height,q=e>o||f>p,r=(e<.9*o||f<.9*p)&&o>d&&p>d;n=q||r,q&&(l=.1*e&-2,m=.1*f&-2)}return!!k&&(n?(this._cacheCanvas.width=Math.max(Math.ceil(e)+l,d),this._cacheCanvas.height=Math.max(Math.ceil(f)+m,d),this.cacheTranslationX=(e+l)/2,this.cacheTranslationY=(f+m)/2):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,this._cacheCanvas.width,this._cacheCanvas.height)),this.cacheWidth=e,this.cacheHeight=f,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(g,h),this.zoomX=g,this.zoomY=h,!0)},setOptions:function(a){this._setOptions(a),this._initGradient(a.fill,"fill"),this._initGradient(a.stroke,"stroke"),this._initClipping(a),this._initPattern(a.fill,"fill"),this._initPattern(a.stroke,"stroke")},transform:function(a,b){this.group&&!this.group._transformDone&&this.group.transform(a);var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y),this.angle&&a.rotate(g(this.angle)),a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),this.skewX&&a.transform(1,0,Math.tan(g(this.skewX)),1,0,0),this.skewY&&a.transform(1,Math.tan(g(this.skewY)),0,1,0,0)},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS,d={type:this.type,originX:this.originX,originY:this.originY,left:e(this.left,c),top:e(this.top,c),width:e(this.width,c),height:e(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,c),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:e(this.strokeMiterLimit,c),scaleX:e(this.scaleX,c),scaleY:e(this.scaleY,c),angle:e(this.angle,c),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:e(this.skewX,c),skewY:e(this.skewY,c)};return b.util.populateWithProperties(this,d,a),this.includeDefaultValues||(d=this._removeDefaultValues(d)),d},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype,d=c.stateProperties;return d.forEach(function(b){a[b]===c[b]&&delete a[b];var d="[object Array]"===Object.prototype.toString.call(a[b])&&"[object Array]"===Object.prototype.toString.call(c[b]);d&&0===a[b].length&&0===c[b].length&&delete a[b]}),a},toString:function(){return"#<fabric."+f(this.type)+">"},getObjectScaling:function(){var a=this.scaleX,b=this.scaleY;if(this.group){var c=this.group.getObjectScaling();a*=c.scaleX,b*=c.scaleY}return{scaleX:a,scaleY:b}},getObjectOpacity:function(){var a=this.opacity;return this.group&&(a*=this.group.getObjectOpacity()),a},_set:function(a,c){var d="scaleX"===a||"scaleY"===a;return d&&(c=this._constrainScale(c)),"scaleX"===a&&c<0?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&c<0?(this.flipY=!this.flipY,c*=-1):"shadow"!==a||!c||c instanceof b.Shadow?"dirty"===a&&this.group&&this.group.set("dirty",c):c=new b.Shadow(c),this[a]=c,this.cacheProperties.indexOf(a)>-1&&(this.group&&this.group.set("dirty",!0),this.dirty=!0),this.group&&this.stateProperties.indexOf(a)>-1&&this.group.isOnACache()&&this.group.set("dirty",!0),"width"!==a&&"height"!==a||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},onDeselect:function(){},onSelect:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:b.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(a){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(a.save(),this._setupCompositeOperation(a),this.transform(a),this._setOpacity(a),this._setShadow(a,this),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.clipTo&&b.util.clipContext(this,a),this.shouldCache()?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext),this.dirty=!1),this.drawCacheOnCanvas(a)):(this.dirty=!1,this.drawObject(a),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&a.restore(),a.restore())},needsItsOwnCache:function(){return!1},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawObject:function(a){this._renderBackground(a),this._setStrokeStyles(a,this),this._setFillStyles(a,this),this._render(a)},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY),a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(a){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!a){var b=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-b/2,-c/2,b,c)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor,a.fillRect(-b.x/2,-b.y/2,b.x,b.y),this._removeShadow(a)}},_setOpacity:function(a){this.group&&!this.group._transformDone?a.globalAlpha=this.getObjectOpacity():a.globalAlpha*=this.opacity},_setStrokeStyles:function(a,b){b.stroke&&(a.lineWidth=b.strokeWidth,a.lineCap=b.strokeLineCap,a.lineJoin=b.strokeLineJoin,a.miterLimit=b.strokeMiterLimit,a.strokeStyle=b.stroke.toLive?b.stroke.toLive(a,this):b.stroke)},_setFillStyles:function(a,b){b.fill&&(a.fillStyle=b.fill.toLive?b.fill.toLive(a,this):b.fill)},_setLineDash:function(a,b,c){b&&(1&b.length&&b.push.apply(b,b),h?a.setLineDash(b):c&&c(a))},_renderControls:function(a,c){var d,e,f,h=this.getViewportTransform(),i=this.calcTransformMatrix();c=c||{},e="undefined"!=typeof c.hasBorders?c.hasBorders:this.hasBorders,f="undefined"!=typeof c.hasControls?c.hasControls:this.hasControls,i=b.util.multiplyTransformMatrices(h,i),d=b.util.qrDecompose(i),a.save(),a.translate(d.translateX,d.translateY),a.lineWidth=1*this.borderScaleFactor,this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),c.forActiveSelection?(a.rotate(g(d.angle)),e&&this.drawBordersInGroup(a,d,c)):(a.rotate(g(this.angle)),e&&this.drawBorders(a,c)),f&&this.drawControls(a,c),a.restore()},_setShadow:function(a){if(this.shadow){var c=this.canvas&&this.canvas.viewportTransform[0]||1,d=this.canvas&&this.canvas.viewportTransform[3]||1,e=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(c*=b.devicePixelRatio,d*=b.devicePixelRatio),a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*(c+d)*(e.scaleX+e.scaleY)/4,a.shadowOffsetX=this.shadow.offsetX*c*e.scaleX,a.shadowOffsetY=this.shadow.offsetY*d*e.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_applyPatternGradientTransform:function(a,b){if(b.toLive){var c=b.gradientTransform||b.patternTransform,d=-this.width/2+b.offsetX||0,e=-this.height/2+b.offsetY||0;a.translate(d,e),c&&a.transform.apply(a,c)}},_renderFill:function(a){this.fill&&(a.save(),this._applyPatternGradientTransform(a,this.fill),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(a,this.stroke),a.stroke(),a.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_removeTransformMatrix:function(){var a,c=this._findCenterFromElement();if(this.transformMatrix){var d=b.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",d.scaleX),this.set("scaleY",d.scaleY),this.angle=d.angle,this.skewX=d.skewX,this.skewY=0,c=b.util.transformPoint(c,this.transformMatrix)}a=this.translateToGivenOrigin(c,"left","top",this.originX,this.originY),this.transformMatrix=null,this.setPositionByOrigin(a,"center","center")},clone:function(a,c){var d=this.toObject(c);this.constructor.fromObject?this.constructor.fromObject(d,a):b.Object._fromObject("Object",d,a)},cloneAsImage:function(a,c){var d=this.toDataURL(c);return b.util.loadImage(d,function(c){a&&a(new b.Image(c))}),this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width,c.height=d.height,b.util.wrapElement(c,"div");var e=new b.StaticCanvas(c,{enableRetinaScaling:a.enableRetinaScaling});"jpg"===a.format&&(a.format="jpeg"),"jpeg"===a.format&&(e.backgroundColor="#fff");var f={active:this.active,left:this.left,top:this.top};this.set("active",!1),this.setPositionByOrigin(new b.Point(e.width/2,e.height/2),"center","center");var g=this.canvas;e.add(this);var h=e.toDataURL(a);return this.set(f).setCoords(),this.canvas=g,e.dispose(),e=null,h},isType:function(a){return this.type===a},complexity:function(){return 1},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};return d.type=c.type||(c.r1||c.r2?"radial":"linear"),d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2},(c.r1||c.r2)&&(d.coords.r1=c.r1,d.coords.r2=c.r2),d.gradientTransform=c.gradientTransform,b.Gradient.prototype.addColorStop.call(d,c.colorStops),this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(a,c){c=c||this.canvas.getPointer(a);var d=new b.Point(c.x,c.y),e=this._getLeftTopCoords();return this.angle&&(d=b.util.rotatePoint(d,e,g(-this.angle))),{x:d.x-e.x,y:d.y-e.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),b.util.createAccessors&&b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,c(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object._fromObject=function(a,c,e,f){var g=b[a];c=d(c,!0),b.util.enlivenPatterns([c.fill,c.stroke],function(a){"undefined"!=typeof a[0]&&(c.fill=a[0]),"undefined"!=typeof a[1]&&(c.stroke=a[1]);var b=f?new g(c[f],c):new g(c);e&&e(b)})},b.Object.__uid=0)}("undefined"!=typeof c?c:this),function(){var a=f.util.degreesToRadians,b={left:-.5,center:0,right:.5},c={top:-.5,center:0,bottom:.5};f.util.object.extend(f.Object.prototype,{translateToGivenOrigin:function(a,d,e,g,h){var i,j,k,l=a.x,m=a.y;return"string"==typeof d?d=b[d]:d-=.5,"string"==typeof g?g=b[g]:g-=.5,i=g-d,"string"==typeof e?e=c[e]:e-=.5,"string"==typeof h?h=c[h]:h-=.5,j=h-e,(i||j)&&(k=this._getTransformedDimensions(),l=a.x+i*k.x,m=a.y+j*k.y),new f.Point(l,m)},translateToCenterPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,c,d,"center","center");return this.angle?f.util.rotatePoint(e,b,a(this.angle)):e},translateToOriginPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,"center","center",c,d);return this.angle?f.util.rotatePoint(e,b,a(this.angle)):e},getCenterPoint:function(){var a=new f.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(b,c,d){var e,g,h=this.getCenterPoint();return e="undefined"!=typeof c&&"undefined"!=typeof d?this.translateToGivenOrigin(h,"center","center",c,d):new f.Point(this.left,this.top),g=new f.Point(b.x,b.y),this.angle&&(g=f.util.rotatePoint(g,h,-a(this.angle))),g.subtractEquals(e)},setPositionByOrigin:function(a,b,c){var d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(c){var d,e,f=a(this.angle),g=this.getScaledWidth(),h=Math.cos(f)*g,i=Math.sin(f)*g;d="string"==typeof this.originX?b[this.originX]:this.originX-.5,e="string"==typeof c?b[c]:c-.5,this.left+=h*(e-d),this.top+=i*(e-d),this.setCoords(),this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},onDeselect:function(){}})}(),function(){function a(a){return[new f.Point(a.tl.x,a.tl.y),new f.Point(a.tr.x,a.tr.y),new f.Point(a.br.x,a.br.y),new f.Point(a.bl.x,a.bl.y)]}var b=f.util.degreesToRadians,c=f.util.multiplyTransformMatrices;f.util.object.extend(f.Object.prototype,{oCoords:null,aCoords:null,getCoords:function(b,c){this.oCoords||this.setCoords();var d=b?this.aCoords:this.oCoords;return a(c?this.calcCoords(b):d)},intersectsWithRect:function(a,b,c,d){var e=this.getCoords(c,d),g=f.Intersection.intersectPolygonRectangle(e,a,b);return"Intersection"===g.status},intersectsWithObject:function(a,b,c){var d=f.Intersection.intersectPolygonPolygon(this.getCoords(b,c),a.getCoords(b,c));return"Intersection"===d.status||a.isContainedWithinObject(this,b,c)||this.isContainedWithinObject(a,b,c)},isContainedWithinObject:function(a,b,c){for(var d=this.getCoords(b,c),e=0,f=a._getImageLines(c?a.calcCoords(b):b?a.aCoords:a.oCoords);e<4;e++)if(!a.containsPoint(d[e],f))return!1;return!0},isContainedWithinRect:function(a,b,c,d){var e=this.getBoundingRect(c,d);return e.left>=a.x&&e.left+e.width<=b.x&&e.top>=a.y&&e.top+e.height<=b.y},containsPoint:function(a,b,c,d){var b=b||this._getImageLines(d?this.calcCoords(c):c?this.aCoords:this.oCoords),e=this._findCrossPoints(a,b);return 0!==e&&e%2===1},isOnScreen:function(a){if(!this.canvas)return!1;for(var b,c=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br,e=this.getCoords(!0,a),f=0;f<4;f++)if(b=e[f],b.x<=d.x&&b.x>=c.x&&b.y<=d.y&&b.y>=c.y)return!0;if(this.intersectsWithRect(c,d,!0))return!0;var g={x:(c.x+d.x)/2,y:(c.y+d.y)/2};return!!this.containsPoint(g,null,!0)},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,d,e,f,g,h,i=0;for(var j in b)if(h=b[j],!(h.o.y<a.y&&h.d.y<a.y||h.o.y>=a.y&&h.d.y>=a.y||(h.o.x===h.d.x&&h.o.x>=a.x?g=h.o.x:(c=0,d=(h.d.y-h.o.y)/(h.d.x-h.o.x),e=a.y-c*a.x,f=h.o.y-d*h.o.x,g=-(e-f)/(c-d)),g>=a.x&&(i+=1),2!==i)))break;return i},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(a,b){var c=this.getCoords(a,b);return f.util.makeBoundingBoxFromPoints(c)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),a<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords()},scaleToWidth:function(a){var b=this.getBoundingRect().width/this.getScaledWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRect().height/this.getScaledHeight();return this.scale(a/this.height/b)},calcCoords:function(a){var c=b(this.angle),d=this.getViewportTransform(),e=a?this._getTransformedDimensions():this._calculateCurrentDimensions(),g=e.x,h=e.y,i=Math.sin(c),j=Math.cos(c),k=g>0?Math.atan(h/g):0,l=g/Math.cos(k)/2,m=Math.cos(k+c)*l,n=Math.sin(k+c)*l,o=this.getCenterPoint(),p=a?o:f.util.transformPoint(o,d),q=new f.Point(p.x-m,p.y-n),r=new f.Point(q.x+g*j,q.y+g*i),s=new f.Point(q.x-h*i,q.y+h*j),t=new f.Point(p.x+m,p.y+n);if(!a)var u=new f.Point((q.x+s.x)/2,(q.y+s.y)/2),v=new f.Point((r.x+q.x)/2,(r.y+q.y)/2),w=new f.Point((t.x+r.x)/2,(t.y+r.y)/2),x=new f.Point((t.x+s.x)/2,(t.y+s.y)/2),y=new f.Point(v.x+i*this.rotatingPointOffset,v.y-j*this.rotatingPointOffset);var p={tl:q,tr:r,br:t,bl:s};return a||(p.ml=u,p.mt=v,p.mr=w,p.mb=x,p.mtr=y),p},setCoords:function(a,b){return this.oCoords=this.calcCoords(a),b||(this.aCoords=this.calcCoords(!0)),a||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var a=b(this.angle),c=Math.cos(a),d=Math.sin(a);return 6.123233995736766e-17!==c&&c!==-1.8369701987210297e-16||(c=0),[c,d,-d,c,0,0]}return f.iMatrix.concat()},calcTransformMatrix:function(a){var b,d,e=this.getCenterPoint(),f=[1,0,0,1,e.x,e.y],g=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return d=this.group&&!a?c(this.group.calcTransformMatrix(),f):f,this.angle&&(b=this._calcRotateMatrix(),d=c(d,b)),d=c(d,g)},_calcDimensionsTransformMatrix:function(a,d,e){var f,g=this.scaleX*(e&&this.flipX?-1:1),h=this.scaleY*(e&&this.flipY?-1:1),i=[g,0,0,h,0,0];return a&&(f=[1,0,Math.tan(b(a)),1],i=c(i,f,!0)),d&&(f=[1,Math.tan(b(d)),0,1],i=c(i,f,!0)),i},_getNonTransformedDimensions:function(){var a=this.strokeWidth,b=this.width+a,c=this.height+a;return{x:b,y:c}},_getTransformedDimensions:function(a,b){"undefined"==typeof a&&(a=this.skewX),"undefined"==typeof b&&(b=this.skewY);var c,d,e=this._getNonTransformedDimensions(),g=e.x/2,h=e.y/2,i=[{x:-g,y:-h},{x:g,y:-h},{x:-g,y:h},{x:g,y:h}],j=this._calcDimensionsTransformMatrix(a,b,!1);for(c=0;c<i.length;c++)i[c]=f.util.transformPoint(i[c],j);return d=f.util.makeBoundingBoxFromPoints(i),{x:d.width,y:d.height}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),b=this._getTransformedDimensions(),c=f.util.transformPoint(b,a,!0);return c.scalarAdd(2*this.padding)}})}(),f.util.object.extend(f.Object.prototype,{sendToBack:function(){return this.group?f.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?f.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?f.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?f.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group?f.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),function(){function a(a,b){if(b){if(b.toLive)return a+": url(#SVGID_"+b.id+"); ";var c=new f.Color(b),d=a+": "+c.toRgb()+"; ",e=c.getAlpha();return 1!==e&&(d+=a+"-opacity: "+e.toString()+"; "),d}return a+": none; "}var b=f.Object.NUM_FRACTION_DIGITS,c=f.util.toFixed;f.util.object.extend(f.Object.prototype,{getSvgStyles:function(b){var c=this.fillRule,d=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i="undefined"!=typeof this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=b?"":this.getSvgFilter(),l=a("fill",this.fill),m=a("stroke",this.stroke);return[m,"stroke-width: ",d,"; ","stroke-dasharray: ",e,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",h,"; ",l,"fill-rule: ",c,"; ","opacity: ",i,";",k,j].join("")},getSvgSpanStyles:function(b){var c=b.strokeWidth?"stroke-width: "+b.strokeWidth+"; ":"",d=b.fontFamily?"font-family: "+b.fontFamily.replace(/"/g,"'")+"; ":"",e=b.fontSize?"font-size: "+b.fontSize+"; ":"",f=b.fontStyle?"font-style: "+b.fontStyle+"; ":"",g=b.fontWeight?"font-weight: "+b.fontWeight+"; ":"",h=b.fill?a("fill",b.fill):"",i=b.stroke?a("stroke",b.stroke):"",j=this.getSvgTextDecoration(b);return[i,c,d,e,f,g,j,h].join("")},getSvgTextDecoration:function(a){return"overline"in a||"underline"in a||"linethrough"in a?"text-decoration: "+(a.overline?"overline ":"")+(a.underline?"underline ":"")+(a.linethrough?"line-through ":"")+";":""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){var a=this.angle,b=this.skewX%360,d=this.skewY%360,e=this.getCenterPoint(),g=f.Object.NUM_FRACTION_DIGITS,h="translate("+c(e.x,g)+" "+c(e.y,g)+")",i=0!==a?" rotate("+c(a,g)+")":"",j=1===this.scaleX&&1===this.scaleY?"":" scale("+c(this.scaleX,g)+" "+c(this.scaleY,g)+")",k=0!==b?" skewX("+c(b,g)+")":"",l=0!==d?" skewY("+c(d,g)+")":"",m=this.flipX?" matrix(-1 0 0 1 0 0) ":"",n=this.flipY?" matrix(1 0 0 -1 0 0)":"";return[h,i,j,m,n,k,l].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_setSVGBg:function(a){this.backgroundColor&&a.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,b),'" y="',c(-this.height/2,b),'" width="',c(this.width,b),'" height="',c(this.height,b),'"></rect>\n')},_createBaseSVGMarkup:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),this.shadow&&a.push(this.shadow.toSVG(this)),a}})}(),function(){function a(a,b,d){var e={},f=!0;d.forEach(function(b){e[b]=a[b]}),c(a[b],e,f)}function b(a,c,d){if(a===c)return!0;if(Array.isArray(a)){if(a.length!==c.length)return!1;for(var e=0,f=a.length;e<f;e++)if(!b(a[e],c[e]))return!1;return!0}if(a&&"object"==typeof a){var g,h=Object.keys(a);if(!d&&h.length!==Object.keys(c).length)return!1;for(var e=0,f=h.length;e<f;e++)if(g=h[e],!b(a[g],c[g]))return!1;return!0}}var c=f.util.object.extend,d="stateProperties";f.util.object.extend(f.Object.prototype,{hasStateChanged:function(a){a=a||d;var c="_"+a;return Object.keys(this[c]).length<this[a].length||!b(this[c],this,!0)},saveState:function(b){var c=b&&b.propertySet||d,e="_"+c;return this[e]?(a(this,e,this[c]),b&&b.stateProperties&&a(this,e,b.stateProperties),this):this.setupState(b)},setupState:function(a){a=a||{};var b=a.propertySet||d;return a.propertySet=b,
this["_"+b]={},this.saveState(a),this}})}(),function(){var a=f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active||this.group)return!1;var b,c,d=a.x,e=a.y;this.__corner=0;for(var f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)&&(c=this._getImageLines(this.oCoords[f].corner),b=this._findCrossPoints({x:d,y:e},c),0!==b&&b%2===1))return this.__corner=f,f;return!1},_setCornerCoords:function(){var b,c,d=this.oCoords,e=a(45-this.angle),f=.707106*this.cornerSize,g=f*Math.cos(e),h=f*Math.sin(e);for(var i in d)b=d[i].x,c=d[i].y,d[i].corner={tl:{x:b-h,y:c-g},tr:{x:b+g,y:c-h},bl:{x:b-g,y:c+h},br:{x:b+h,y:c+g}}},drawSelectionBackground:function(b){if(!this.selectionBackgroundColor||!this.active||this.canvas&&!this.canvas.interactive)return this;b.save();var c=this.getCenterPoint(),d=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;return b.translate(c.x,c.y),b.scale(1/e[0],1/e[3]),b.rotate(a(this.angle)),b.fillStyle=this.selectionBackgroundColor,b.fillRect(-d.x/2,-d.y/2,d.x,d.y),b.restore(),this},drawBorders:function(a,b){b=b||{};var c=this._calculateCurrentDimensions(),d=1/this.borderScaleFactor,e=c.x+d,f=c.y+d,g="undefined"!=typeof b.hasRotatingPoint?b.hasRotatingPoint:this.hasRotatingPoint,h="undefined"!=typeof b.hasControls?b.hasControls:this.hasControls,i="undefined"!=typeof b.rotatingPointOffset?b.rotatingPointOffset:this.rotatingPointOffset;if(a.save(),a.strokeStyle=b.borderColor||this.borderColor,this._setLineDash(a,b.borderDashArray||this.borderDashArray,null),a.strokeRect(-e/2,-f/2,e,f),g&&this.isControlVisible("mtr")&&h){var j=-f/2;a.beginPath(),a.moveTo(0,j),a.lineTo(0,j-i),a.closePath(),a.stroke()}return a.restore(),this},drawBordersInGroup:function(a,b,c){c=c||{};var d=this._getNonTransformedDimensions(),e=f.util.customTransformMatrix(b.scaleX,b.scaleY,b.skewX),g=f.util.transformPoint(d,e),h=1/this.borderScaleFactor,i=g.x+h,j=g.y+h;return a.save(),this._setLineDash(a,c.borderDashArray||this.borderDashArray,null),a.strokeStyle=c.borderColor||this.borderColor,a.strokeRect(-i/2,-j/2,i,j),a.restore(),this},drawControls:function(a,b){b=b||{};var c=this._calculateCurrentDimensions(),d=c.x,e=c.y,f=b.cornerSize||this.cornerSize,g=-(d+f)/2,h=-(e+f)/2,i="undefined"!=typeof b.transparentCorners?b.transparentCorners:this.transparentCorners,j="undefined"!=typeof b.hasRotatingPoint?b.hasRotatingPoint:this.hasRotatingPoint,k=i?"stroke":"fill";return a.save(),a.strokeStyle=a.fillStyle=b.cornerColor||this.cornerColor,this.transparentCorners||(a.strokeStyle=b.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(a,b.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",a,k,g,h,b),this._drawControl("tr",a,k,g+d,h,b),this._drawControl("bl",a,k,g,h+e,b),this._drawControl("br",a,k,g+d,h+e,b),this.get("lockUniScaling")||(this._drawControl("mt",a,k,g+d/2,h,b),this._drawControl("mb",a,k,g+d/2,h+e,b),this._drawControl("mr",a,k,g+d,h+e/2,b),this._drawControl("ml",a,k,g,h+e/2,b)),j&&this._drawControl("mtr",a,k,g+d/2,h-this.rotatingPointOffset,b),a.restore(),this},_drawControl:function(a,b,c,d,e,f){if(f=f||{},this.isControlVisible(a)){var g=this.cornerSize,h=!this.transparentCorners&&this.cornerStrokeColor;switch(f.cornerStyle||this.cornerStyle){case"circle":b.beginPath(),b.arc(d+g/2,e+g/2,g/2,0,2*Math.PI,!1),b[c](),h&&b.stroke();break;default:this.transparentCorners||b.clearRect(d,e,g,g),b[c+"Rect"](d,e,g,g),h&&b.strokeRect(d,e,g,g)}}},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,b){return this._getControlsVisibility()[a]=b,this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),f.util.object.extend(f.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,g=this;return f.util.animate({startValue:a.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){a.set("left",b),g.requestRenderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,g=this;return f.util.animate({startValue:a.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){a.set("top",b),g.requestRenderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxRemove:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,g=this;return f.util.animate({startValue:a.opacity,endValue:0,duration:this.FX_DURATION,onStart:function(){a.set("active",!1)},onChange:function(b){a.set("opacity",b),g.requestRenderAll(),e()},onComplete:function(){g.remove(a),d()}}),this}}),f.util.object.extend(f.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var a,b,c=[];for(a in arguments[0])c.push(a);for(var d=0,e=c.length;d<e;d++)a=c[d],b=d!==e-1,this._animate(a,arguments[0][a],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(a,b,c,d){var e,g=this;b=b.toString(),c=c?f.util.object.clone(c):{},~a.indexOf(".")&&(e=a.split("."));var h=e?this.get(e[0])[e[1]]:this.get(a);"from"in c||(c.from=h),b=~b.indexOf("=")?h+parseFloat(b.replace("=","")):parseFloat(b),f.util.animate({startValue:c.from,endValue:b,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(g)},onChange:function(b,f,h){e?g[e[0]][e[1]]=b:g.set(a,b),d||c.onChange&&c.onChange(b,f,h)},onComplete:function(a,b,e){d||(g.setCoords(),c.onComplete&&c.onComplete(a,b,e))}})}}),function(a){"use strict";function b(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,g=b.nearest,h=b.center,i=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(e));case h:return Math.min(this.get(d),this.get(e))+.5*this.get(f);case i:return Math.max(this.get(d),this.get(e))}}}var c=a.fabric||(a.fabric={}),d=c.util.object.extend,e=c.util.object.clone,f={x1:1,x2:1,y1:1,y2:1},g=c.StaticCanvas.supports("setLineDash");if(c.Line)return void c.warn("fabric.Line is already defined");var h=c.Object.prototype.cacheProperties.concat();h.push("x1","x2","y1","y2"),c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:h,initialize:function(a,b){a||(a=[0,0,0,0]),this.callSuper("initialize",b),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this.callSuper("_set",a,b),"undefined"!=typeof f[a]&&this._setWidthHeight(),this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){if(a.beginPath(),!this.strokeDashArray||this.strokeDashArray&&g){var b=this.calcLinePoints();a.moveTo(b.x1,b.y1),a.lineTo(b.x2,b.y2)}a.lineWidth=this.strokeWidth;var c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=c},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath(),c.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray),a.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(a){return d(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(a.y-=this.strokeWidth),0===this.height&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1,c=a*this.width*.5,d=b*this.height*.5,e=a*this.width*-.5,f=b*this.height*-.5;return{x1:c,x2:e,y1:d,y2:f}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.calcLinePoints();return b.push("<line ",this.getSvgId(),'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(a,b,e){e=e||{};var f=c.parseAttributes(a,c.Line.ATTRIBUTE_NAMES),g=[f.x1||0,f.y1||0,f.x2||0,f.y2||0];b(new c.Line(g,d(f,e)))},c.Line.fromObject=function(a,b){function d(a){delete a.points,b&&b(a)}var f=e(a,!0);f.points=[a.x1,a.y1,a.x2,a.y2],c.Object._fromObject("Line",f,d,"points")}}("undefined"!=typeof c?c:this),function(a){"use strict";function b(a){return"radius"in a&&a.radius>=0}var c=a.fabric||(a.fabric={}),d=Math.PI,e=c.util.object.extend;if(c.Circle)return void c.warn("fabric.Circle is already defined.");var f=c.Object.prototype.cacheProperties.concat();f.push("radius"),c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,cacheProperties:f,initialize:function(a){this.callSuper("initialize",a),this.set("radius",a&&a.radius||0)},_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(a){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,e=0,f=(this.endAngle-this.startAngle)%(2*d);if(0===f)b.push("<circle ",this.getSvgId(),'cx="'+c+'" cy="'+e+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var g=Math.cos(this.startAngle)*this.radius,h=Math.sin(this.startAngle)*this.radius,i=Math.cos(this.endAngle)*this.radius,j=Math.sin(this.endAngle)*this.radius,k=f>d?"1":"0";b.push('<path d="M '+g+" "+h," A "+this.radius+" "+this.radius," 0 ",+k+" 1"," "+i+" "+j,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(b.join("")):b.join("")},_render:function(a){a.beginPath(),a.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(a),this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){return this.radius=a,this.set("width",2*a).set("height",2*a)}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(a,d,f){f||(f={});var g=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!b(g))throw new Error("value of `r` attribute is required and can not be negative");g.left=(g.left||0)-g.radius,g.top=(g.top||0)-g.radius,d(new c.Circle(e(g,f)))},c.Circle.fromObject=function(a,b){return c.Object._fromObject("Circle",a,b)}}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){this.callSuper("initialize",a),this.set("width",a&&a.width||100).set("height",a&&a.height||100)},_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=this.width/2,d=this.height/2;a.beginPath(),b.util.drawDashedLine(a,-c,d,0,-d,this.strokeDashArray),b.util.drawDashedLine(a,0,-d,c,d,this.strokeDashArray),b.util.drawDashedLine(a,c,d,-c,d,this.strokeDashArray),a.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.width/2,d=this.height/2,e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return b.push("<polygon ",this.getSvgId(),'points="',e,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a?a(b.join("")):b.join("")}}),void(b.Triangle.fromObject=function(a,c){return b.Object._fromObject("Triangle",a,c)}))}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=2*Math.PI,d=b.util.object.extend;if(b.Ellipse)return void b.warn("fabric.Ellipse is already defined.");var e=b.Object.prototype.cacheProperties.concat();e.push("rx","ry"),b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e,initialize:function(a){this.callSuper("initialize",a),this.set("rx",a&&a.rx||0),this.set("ry",a&&a.ry||0)},_set:function(a,b){switch(this.callSuper("_set",a,b),a){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;return b.push("<ellipse ",this.getSvgId(),'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(0,0,this.rx,0,c,!1),a.restore(),this._renderFill(a),this._renderStroke(a)}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),b.Ellipse.fromElement=function(a,c,e){e||(e={});var f=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);f.left=(f.left||0)-f.rx,f.top=(f.top||0)-f.ry,c(new b.Ellipse(d(f,e)))},b.Ellipse.fromObject=function(a,c){return b.Object._fromObject("Ellipse",a,c)}}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect)return void b.warn("fabric.Rect is already defined");var d=b.Object.prototype.stateProperties.concat();d.push("rx","ry");var e=b.Object.prototype.cacheProperties.concat();e.push("rx","ry"),b.Rect=b.util.createClass(b.Object,{stateProperties:d,type:"rect",rx:0,ry:0,cacheProperties:e,initialize:function(a){this.callSuper("initialize",a),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){if(1===this.width&&1===this.height)return void a.fillRect(-.5,-.5,1,1);var b=this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,e=this.height,f=-this.width/2,g=-this.height/2,h=0!==b||0!==c,i=.4477152502;a.beginPath(),a.moveTo(f+b,g),a.lineTo(f+d-b,g),h&&a.bezierCurveTo(f+d-i*b,g,f+d,g+i*c,f+d,g+c),a.lineTo(f+d,g+e-c),h&&a.bezierCurveTo(f+d,g+e-i*c,f+d-i*b,g+e,f+d-b,g+e),a.lineTo(f+b,g+e),h&&a.bezierCurveTo(f+i*b,g+e,f,g+e-i*c,f,g+e-c),a.lineTo(f,g+c),h&&a.bezierCurveTo(f,g+i*c,f+i*b,g,f+b,g),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=-this.width/2,d=-this.height/2,e=this.width,f=this.height;a.beginPath(),b.util.drawDashedLine(a,c,d,c+e,d,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d,c+e,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d+f,c,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c,d+f,c,d,this.strokeDashArray),a.closePath()},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=-this.width/2,d=-this.height/2;return b.push("<rect ",this.getSvgId(),'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,d,e){if(!a)return d(null);e=e||{};var f=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);f.left=f.left||0,f.top=f.top||0;var g=new b.Rect(c(e?b.util.object.clone(e):{},f));g.visible=g.visible&&g.width>0&&g.height>0,d(g)},b.Rect.fromObject=function(a,c){return b.Object._fromObject("Rect",a,c)}}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed,g=b.Object.NUM_FRACTION_DIGITS;if(b.Polyline)return void b.warn("fabric.Polyline is already defined");var h=b.Object.prototype.cacheProperties.concat();h.push("points"),b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,cacheProperties:h,initialize:function(a,b){b=b||{},this.points=a||[],this.callSuper("initialize",b),this._calcDimensions(),"top"in b||(this.top=this.minY),"left"in b||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var a=this.points,b=d(a,"x"),c=d(a,"y"),f=e(a,"x"),g=e(a,"y");this.width=f-b||0,this.height=g-c||0,this.minX=b||0,this.minY=c||0},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this.pathOffset.x,d=this.pathOffset.y,e=this._createBaseSVGMarkup(),h=0,i=this.points.length;h<i;h++)b.push(f(this.points[h].x-c,g),",",f(this.points[h].y-d,g)," ");return e.push("<",this.type," ",this.getSvgId(),'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(e.join("")):e.join("")},commonRender:function(a){var b,c=this.points.length,d=this.pathOffset.x,e=this.pathOffset.y;if(!c||isNaN(this.points[c-1].y))return!1;a.beginPath(),a.moveTo(this.points[0].x-d,this.points[0].y-e);for(var f=0;f<c;f++)b=this.points[f],a.lineTo(b.x-d,b.y-e);return!0},_render:function(a){this.commonRender(a)&&(this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var e=0,f=this.points.length;e<f;e++)c=this.points[e],d=this.points[e+1]||c,b.util.drawDashedLine(a,c.x,c.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c,d){if(!a)return c(null);d||(d={});var e=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);c(new b.Polyline(e,b.util.object.extend(f,d)))},b.Polyline.fromObject=function(a,c){return b.Object._fromObject("Polyline",a,c,"points")}}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;return b.Polygon?void b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Polyline,{type:"polygon",_render:function(a){this.commonRender(a)&&(a.closePath(),this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){this.callSuper("_renderDashedStroke",a),a.closePath()}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d,e){if(!a)return d(null);e||(e={});var f=b.parsePointsAttribute(a.getAttribute("points")),g=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);d(new b.Polygon(f,c(g,e)))},void(b.Polygon.fromObject=function(a,c){return b.Object._fromObject("Polygon",a,c,"points")}))}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.array.min,d=b.util.array.max,e=b.util.object.extend,f=Object.prototype.toString,g=b.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};if(b.Path)return void b.warn("fabric.Path is already defined");var j=b.Object.prototype.stateProperties.concat();j.push("path");var k=b.Object.prototype.cacheProperties.concat();k.push("path","fillRule"),b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,cacheProperties:k,stateProperties:j,initialize:function(a,b){b=b||{},this.callSuper("initialize",b),a||(a=[]);var c="[object Array]"===f.call(a);this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(c||(this.path=this._parsePath()),this._setPositionDimensions(b))},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left,this.minY=b.top,this.width=b.width,this.height=b.height,"undefined"==typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),"undefined"==typeof a.top&&(this.top=b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(a){var b,c,d,e=null,f=0,h=0,i=0,j=0,k=0,l=0,m=-this.pathOffset.x,n=-this.pathOffset.y;a.beginPath();for(var o=0,p=this.path.length;o<p;++o){switch(b=this.path[o],b[0]){case"l":i+=b[1],j+=b[2],a.lineTo(i+m,j+n);break;case"L":i=b[1],j=b[2],a.lineTo(i+m,j+n);break;case"h":i+=b[1],a.lineTo(i+m,j+n);break;case"H":i=b[1],a.lineTo(i+m,j+n);break;case"v":j+=b[1],a.lineTo(i+m,j+n);break;case"V":j=b[1],a.lineTo(i+m,j+n);break;case"m":i+=b[1],j+=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"M":i=b[1],j=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"c":c=i+b[5],d=j+b[6],k=i+b[3],l=j+b[4],a.bezierCurveTo(i+b[1]+m,j+b[2]+n,k+m,l+n,c+m,d+n),i=c,j=d;break;case"C":i=b[5],j=b[6],k=b[3],l=b[4],a.bezierCurveTo(b[1]+m,b[2]+n,k+m,l+n,i+m,j+n);break;case"s":c=i+b[3],d=j+b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,i+b[1]+m,j+b[2]+n,c+m,d+n),k=i+b[1],l=j+b[2],i=c,j=d;break;case"S":c=b[3],d=b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"q":c=i+b[3],d=j+b[4],k=i+b[1],l=j+b[2],a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"Q":c=b[3],d=b[4],a.quadraticCurveTo(b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"t":c=i+b[1],d=j+b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"T":c=b[1],d=b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"a":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+i+m,b[7]+j+n]),i+=b[6],j+=b[7];break;case"A":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+m,b[7]+n]),i=b[6],j=b[7];break;case"z":case"Z":i=f,j=h,a.closePath()}e=b}},_render:function(a){this._renderPathCommands(a),this._renderFill(a),this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=e(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),top:this.top,left:this.left});return b},toDatalessObject:function(a){var b=this.toObject(["sourcePath"].concat(a));return b.sourcePath&&delete b.path,b},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;e<f;e++)b.push(this.path[e].join(" "));var g=b.join(" ");return d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ",c.push("<path ",this.getSvgId(),'d="',g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,d,e,f=[],g=[],j=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,k=0,l=this.path.length;k<l;k++){for(a=this.path[k],d=a.slice(1).trim(),g.length=0;c=j.exec(d);)g.push(c[0]);e=[a.charAt(0)];for(var m=0,n=g.length;m<n;m++)b=parseFloat(g[m]),isNaN(b)||e.push(b);var o=e[0],p=h[o.toLowerCase()],q=i[o]||o;if(e.length-1>p)for(var r=1,s=e.length;r<s;r+=p)f.push([o].concat(e.slice(r,r+p))),o=q;else f.push(e)}return f},_parseDimensions:function(){for(var a,e,f,g,h=[],i=[],j=null,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=this.path.length;q<r;++q){switch(a=this.path[q],a[0]){case"l":m+=a[1],n+=a[2],g=[];break;case"L":m=a[1],n=a[2],g=[];break;case"h":m+=a[1],g=[];break;case"H":m=a[1],g=[];break;case"v":n+=a[1],g=[];break;case"V":n=a[1],g=[];break;case"m":m+=a[1],n+=a[2],k=m,l=n,g=[];break;case"M":m=a[1],n=a[2],k=m,l=n,g=[];break;case"c":e=m+a[5],f=n+a[6],o=m+a[3],p=n+a[4],g=b.util.getBoundsOfCurve(m,n,m+a[1],n+a[2],o,p,e,f),m=e,n=f;break;case"C":o=a[3],p=a[4],g=b.util.getBoundsOfCurve(m,n,a[1],a[2],o,p,a[5],a[6]),m=a[5],n=a[6];break;case"s":e=m+a[3],f=n+a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,m+a[1],n+a[2],e,f),o=m+a[1],p=n+a[2],m=e,n=f;break;case"S":e=a[3],f=a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,a[1],a[2],e,f),m=e,n=f,o=a[1],p=a[2];break;case"q":e=m+a[3],f=n+a[4],o=m+a[1],p=n+a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"Q":o=a[1],p=a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,a[3],a[4]),m=a[3],n=a[4];break;case"t":e=m+a[1],f=n+a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"T":e=a[1],f=a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"a":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6]+m,a[7]+n),m+=a[6],n+=a[7];break;case"A":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6],a[7]),m=a[6],n=a[7];break;case"z":case"Z":m=k,n=l}j=a,g.forEach(function(a){h.push(a.x),i.push(a.y)}),h.push(m),i.push(n)}var s=c(h)||0,t=c(i)||0,u=d(h)||0,v=d(i)||0,w=u-s,x=v-t,y={left:s,top:t,width:w,height:x};return y}}),b.Path.fromObject=function(a,c){if("string"==typeof a.sourcePath){var d=a.sourcePath;b.loadSVGFromURL(d,function(b){var d=b[0];d.setOptions(a),c&&c(d)})}else b.Object._fromObject("Path",a,c,"path")},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(a,c,d){var f=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);c(new b.Path(f.d,e(f,d)))}}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max;b.Group||(b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(a,b,c){b=b||{},this._objects=[],c&&this.callSuper("initialize",b),this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;if(b.originX&&(this.originX=b.originX),b.originY&&(this.originY=b.originY),!c){var e=b&&b.centerPoint;e||this._calcBounds(),this._updateObjectsCoords(e),delete b.centerPoint,this.callSuper("initialize",b)}this.setCoords()},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),b=this._objects.length;b--;)this._updateObjectCoords(this._objects[b],a)},_updateObjectCoords:function(a,b){var c=a.left,d=a.top,e=!0,f=!0;a.set({left:c-b.x,top:d-b.y}),a.group=this,a.setCoords(e,f)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(a){this.dirty=!0,a.group=this},_onObjectRemoved:function(a){this.dirty=!0,delete a.group},_set:function(a,b){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(a,b);this.callSuper("_set",a,b)},toObject:function(a){var b=this.getObjects().map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=b.group.includeDefaultValues;var d=b.toObject(a);return b.includeDefaultValues=c,d});return c(this.callSuper("toObject",a),{objects:b})},toDatalessObject:function(a){var b,d=this.sourcePath;return b=d?d:this.getObjects().map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=b.group.includeDefaultValues;var d=b.toDatalessObject(a);return b.includeDefaultValues=c,d}),c(this.callSuper("toDatalessObject",a),{objects:b})},render:function(a){this._transformDone=!0,this.callSuper("render",a),this._transformDone=!1},shouldCache:function(){var a=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=a,a)for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b].willDrawShadow())return this.ownCaching=!1,!1;return a},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(a){for(var b=0,c=this._objects.length;b<c;b++)this._objects[b].render(a)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var c=this.cacheWidth/this.zoomX,d=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-c/2,-d/2,c,d)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){var c=a.calcTransformMatrix(),d=b.util.qrDecompose(c),e=new b.Point(d.translateX,d.translateY);return a.flipX=!1,a.flipY=!1,a.set("scaleX",d.scaleX),a.set("scaleY",d.scaleY),a.skewX=d.skewX,a.skewY=d.skewY,a.angle=d.angle,a.setPositionByOrigin(e,"center","center"),a},_restoreObjectState:function(a){return this.realizeTransform(a),a.setCoords(),delete a.group,this},destroy:function(){return this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var a=this._objects,c=this.canvas;this._objects=[];var d=this.toObject();delete d.objects;var e=new b.ActiveSelection([]);return e.set(d),e.type="activeSelection",c.remove(this),a.forEach(function(a){a.group=e,a.dirty=!0,c.add(a)}),e.canvas=c,e._objects=a,c._activeObject=e,e.setCoords(),e}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var a=!0,b=!0;return this.forEachObject(function(c){c.setCoords(a,b)}),this},_calcBounds:function(a){for(var b,c,d,e=[],f=[],g=["tr","br","bl","tl"],h=0,i=this._objects.length,j=g.length,k=!0;h<i;++h)for(b=this._objects[h],b.setCoords(k),d=0;d<j;d++)c=g[d],e.push(b.oCoords[c].x),f.push(b.oCoords[c].y);this.set(this._getBounds(e,f,a))},_getBounds:function(a,c,f){var g=new b.Point(d(a),d(c)),h=new b.Point(e(a),e(c)),i={width:h.x-g.x||0,height:h.y-g.y||0};return f||(i.left=g.x||0,i.top=g.y||0,"center"===this.originX&&(i.left+=i.width/2),"right"===this.originX&&(i.left+=i.width),"center"===this.originY&&(i.top+=i.height/2),"bottom"===this.originY&&(i.top+=i.height)),i},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var c=0,d=this._objects.length;c<d;c++)b.push("\t",this._objects[c].toSVG(a));return b.push("</g>\n"),a?a(b.join("")):b.join("")}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){var e=b.util.object.clone(a,!0);delete e.objects,c&&c(new b.Group(d,e,(!0)))})})}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.ActiveSelection||(b.ActiveSelection=b.util.createClass(b.Group,{type:"activeSelection",initialize:function(a,c){c=c||{},this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;c.originX&&(this.originX=c.originX),c.originY&&(this.originY=c.originY),this._calcBounds(),this._updateObjectsCoords(),b.Object.prototype.initialize.call(this,c),this.setCoords()},toGroup:function(){var a=this._objects;this._objects=[];var c=this.toObject(),d=new b.Group([]);
if(delete c.objects,d.set(c),d.type="group",a.forEach(function(a){a.group=d,a.canvas.remove(a)}),d._objects=a,!this.canvas)return d;var e=this.canvas;return e.add(d),e._activeObject=d,d.setCoords(),d},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},_set:function(a,c){var d=this._objects.length;if("canvas"===a)for(;d--;)this._objects[d].set(a,c);if(this.useSetOnGroup)for(;d--;)this._objects[d].setOnGroup(a,c);b.Object.prototype._set.call(this,a,c)},shouldCache:function(){return!1},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return!1},_renderControls:function(a,b,c){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,b),c=c||{},"undefined"==typeof c.hasControls&&(c.hasControls=!1),"undefined"==typeof c.hasRotatingPoint&&(c.hasRotatingPoint=!1),c.forActiveSelection=!0;for(var d=0,e=this._objects.length;d<e;d++)this._objects[d]._renderControls(a,c);a.restore()}}),b.ActiveSelection.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects,c&&c(new b.ActiveSelection(d,a,(!0)))})})}("undefined"!=typeof c?c:this),function(a){"use strict";var b=f.util.object.extend;if(a.fabric||(a.fabric={}),a.fabric.Image)return void f.warn("fabric.Image is already defined.");var c=f.Object.prototype.stateProperties.concat();c.push("cropX","cropY"),f.Image=f.util.createClass(f.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:c,objectCaching:!1,cacheKey:"",cropX:0,cropY:0,initialize:function(a,b){b||(b={}),this.filters=[],this.callSuper("initialize",b),this._initElement(a,b),this.cacheKey="texture"+f.Object.__uid++},getElement:function(){return this._element},setElement:function(a,b){return this._element=a,this._originalElement=a,this._initConfig(b),this.resizeFilter&&this.applyResizeFilters(),0!==this.filters.length&&this.applyFilters(),this},setCrossOrigin:function(a){return this.crossOrigin=a,this._element.crossOrigin=a,this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){if(this.stroke&&0!==this.strokeWidth){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,-c),a.lineTo(b,-c),a.lineTo(b,c),a.lineTo(-b,c),a.lineTo(-b,-c),a.closePath()}},_renderDashedStroke:function(a){var b=-this.width/2,c=-this.height/2,d=this.width,e=this.height;a.save(),this._setStrokeStyles(a,this),a.beginPath(),f.util.drawDashedLine(a,b,c,b+d,c,this.strokeDashArray),f.util.drawDashedLine(a,b+d,c,b+d,c+e,this.strokeDashArray),f.util.drawDashedLine(a,b+d,c+e,b,c+e,this.strokeDashArray),f.util.drawDashedLine(a,b,c+e,b,c,this.strokeDashArray),a.closePath(),a.restore()},toObject:function(a){var c=[];this.filters.forEach(function(a){a&&c.push(a.toObject())});var d=b(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(a)),{src:this.getSrc(),filters:c});return this.resizeFilter&&(d.resizeFilter=this.resizeFilter.toObject()),d.width/=this._filterScalingX,d.height/=this._filterScalingY,d},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=-this.width/2,d=-this.height/2;if(b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"\t<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'"></image>\n'),this.stroke||this.strokeDashArray){var e=this.fill;this.fill=null,b.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=e}return b.push("</g>\n"),a?a(b.join("")):b.join("")},getSrc:function(a){var b=a?this._element:this._originalElement;return b?b.toDataURL?b.toDataURL():f.isLikelyNode?b._src:b.src:this.src||""},setSrc:function(a,b,c){return f.util.loadImage(a,function(a){this.setElement(a,c),b(this)},this,c&&c.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var a=this.resizeFilter,b=this.canvas?this.canvas.getRetinaScaling():1,c=this.minimumScaleTrigger,d=this.scaleX<c?this.scaleX:1,e=this.scaleY<c?this.scaleY:1;if(d*b<1&&(d*=b),e*b<1&&(e*=b),!a||d>=1&&e>=1)return void(this._element=this._filteredEl);f.filterBackend||(f.filterBackend=f.initFilterBackend());var g,h=this._filteredEl||this._originalElement;if(this._element===this._originalElement){var i=f.util.createCanvasElement();i.width=h.width,i.height=h.height,this._element=i}var j=this._element.getContext("2d");h.getContext?g=h.getContext("2d").getImageData(0,0,h.width,h.height):(j.drawImage(h,0,0),g=j.getImageData(0,0,h.width,h.height));var k={imageData:g,scaleX:d,scaleY:e};a.applyTo2d(k),this.width=this._element.width=k.imageData.width,this.height=this._element.height=k.imageData.height,j.putImageData(k.imageData,0,0)},applyFilters:function(a){if(a=a||this.filters||[],a=a.filter(function(a){return a}),0===a.length)return this._element=this._originalElement,this._filterScalingX=1,this._filterScalingY=1,this;var b=this._originalElement,c=b.naturalWidth||b.width,d=b.naturalHeight||b.height;if(this._element===this._originalElement){var e=f.util.createCanvasElement();e.width=b.width,e.height=b.height,this._element=e}else this._element.getContext("2d").clearRect(0,0,c,d);return f.filterBackend||(f.filterBackend=f.initFilterBackend()),f.filterBackend.applyFilters(a,this._originalElement,c,d,this._element,this.cacheKey),this.width===this._element.width&&this.height===this._element.height||(this._filterScalingX=this._element.width/this.width,this._filterScalingY=this._element.height/this.height,this.width=this._element.width,this.height=this._element.height),this},_render:function(a){var b,c=-this.width/2,d=-this.height/2;this.isMoving===!1&&this.resizeFilter&&this._needsResize()&&(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,this.applyResizeFilters()),b=this._element,b&&a.drawImage(b,this.cropX,this.cropY,this.width,this.height,c,d,this.width,this.height),this._stroke(a),this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width),this.set("height",a.height)},_initElement:function(a,b){this.setElement(f.util.getById(a),b),f.util.addClass(this.getElement(),f.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a&&a.length?f.util.enlivenObjects(a,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0,this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},parsePreserveAspectRatioAttribute:function(){if(this.preserveAspectRatio){var a,b=f.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio),c=this._element.width,d=this._element.height,e=this.width,g=this.height,h={width:e,height:g};!b||"none"===b.alignX&&"none"===b.alignY?(this.scaleX=e/c,this.scaleY=g/d):("meet"===b.meetOrSlice&&(this.width=c,this.height=d,this.scaleX=this.scaleY=a=f.util.findScaleToFit(this._element,h),"Mid"===b.alignX&&(this.left+=(e-c*a)/2),"Max"===b.alignX&&(this.left+=e-c*a),"Mid"===b.alignY&&(this.top+=(g-d*a)/2),"Max"===b.alignY&&(this.top+=g-d*a)),"slice"===b.meetOrSlice&&(this.scaleX=this.scaleY=a=f.util.findScaleToCover(this._element,h),this.width=e/a,this.height=g/a,"Mid"===b.alignX&&(this.cropX=(c-this.width)/2),"Max"===b.alignX&&(this.cropX=c-this.width),"Mid"===b.alignY&&(this.cropY=(d-this.height)/2),"Max"===b.alignY&&(this.cropY=d-this.height)))}}}),f.Image.CSS_CANVAS="canvas-img",f.Image.prototype.getSvgSrc=f.Image.prototype.getSrc,f.Image.fromObject=function(a,b){f.util.loadImage(a.src,function(c,d){return d?void(b&&b(null,d)):void f.Image.prototype._initFilters.call(a,a.filters,function(d){a.filters=d||[],f.Image.prototype._initFilters.call(a,[a.resizeFilter],function(d){a.resizeFilter=d[0];var e=new f.Image(c,a);b(e)})})},null,a.crossOrigin)},f.Image.fromURL=function(a,b,c){f.util.loadImage(a,function(a){b&&b(new f.Image(a,c))},null,c&&c.crossOrigin)},f.Image.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),f.Image.fromElement=function(a,c,d){var e=f.parseAttributes(a,f.Image.ATTRIBUTE_NAMES);f.Image.fromURL(e["xlink:href"],c,b(d?f.util.object.clone(d):{},e))}}("undefined"!=typeof c?c:this),function(){"use strict";function a(a){a&&a.tileSize&&(this.tileSize=a.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}f.isWebglSupported=function(a){if(f.isLikelyNode)return!1;a=a||f.WebglFilterBackend.prototype.tileSize;var b=document.createElement("canvas"),c=b.getContext("webgl")||b.getContext("experimental-webgl"),d=!1;return c&&(f.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),d=f.maxTextureSize>=a),this.isSupported=d,d},f.WebglFilterBackend=a,a.prototype={tileSize:2048,resources:{},setupGLContext:function(a,b){this.dispose(),this.createWebGLCanvas(a,b),this.squareVertices=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(a,b)},chooseFastestCopyGLTo2DMethod:function(a,b){var c,g="undefined"!=typeof window.performance;try{new ImageData(1,1),c=!0}catch(h){c=!1}var i="undefined"!=typeof ArrayBuffer,j="undefined"!=typeof Uint8ClampedArray;if(g&&c&&i&&j){var k,l,m,n=f.util.createCanvasElement(),o=new ArrayBuffer(a*b*4),p={imageBuffer:o};n.width=a,n.height=b,k=window.performance.now(),d.call(p,this.gl,n),l=window.performance.now()-k,k=window.performance.now(),e.call(p,this.gl,n),m=window.performance.now()-k,l>m?(this.imageBuffer=o,this.copyGLTo2D=e):this.copyGLTo2D=d}},createWebGLCanvas:function(a,b){var c=f.util.createCanvasElement();c.width=a,c.height=b;var d={premultipliedAlpha:!1},e=c.getContext("webgl",d);e||(e=c.getContext("experimental-webgl",d)),e&&(e.clearColor(0,0,0,0),this.canvas=c,this.gl=e)},applyFilters:function(a,b,c,d,e,f){var g,h=this.gl;f&&(g=this.getCachedTexture(f,b));var i={originalWidth:b.width||b.originalWidth,originalHeight:b.height||b.originalHeight,sourceWidth:c,sourceHeight:d,context:h,sourceTexture:this.createTexture(h,c,d,!g&&b),targetTexture:this.createTexture(h,c,d),originalTexture:g||this.createTexture(h,c,d,!g&&b),passes:a.length,webgl:!0,squareVertices:this.squareVertices,programCache:this.programCache,pass:0,filterBackend:this},j=h.createFramebuffer();return h.bindFramebuffer(h.FRAMEBUFFER,j),a.forEach(function(a){a&&a.applyTo(i)}),this.copyGLTo2D(h,e),h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(i.sourceTexture),h.deleteTexture(i.targetTexture),h.deleteFramebuffer(j),e.getContext("2d").setTransform(1,0,0,1,0,0),i},applyFiltersDebug:function(a,b,c,d,e,f){var g=this.gl,h=this.applyFilters(a,b,c,d,e,f),i=g.getError();if(i!==g.NO_ERROR){var j=this.glErrorToString(g,i),k=new Error("WebGL Error "+j);throw k.glErrorCode=i,k}return h},glErrorToString:function(a,b){if(!a)return"Context undefined for error code: "+b;if("number"!=typeof b)return"Error code is not a number";switch(b){case a.NO_ERROR:return"NO_ERROR";case a.INVALID_ENUM:return"INVALID_ENUM";case a.INVALID_VALUE:return"INVALID_VALUE";case a.INVALID_OPERATION:return"INVALID_OPERATION";case a.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case a.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case a.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"UNKNOWN_ERROR"}},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(a,b,c,d){var e=a.createTexture();return a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),d?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),e},getCachedTexture:function(a,b){if(this.textureCache[a])return this.textureCache[a];var c=this.createTexture(this.gl,b.width,b.height,b);return this.textureCache[a]=c,c},evictCachesForKey:function(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])},copyGLTo2D:d,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var a=this.gl,b=a.getExtension("WEBGL_debug_renderer_info"),c={renderer:"",vendor:""};if(b){var d=a.getParameter(b.UNMASKED_RENDERER_WEBGL),e=a.getParameter(b.UNMASKED_VENDOR_WEBGL);d&&(c.renderer=d.toLowerCase()),e&&(c.vendor=e.toLowerCase())}return this.gpuInfo=c,c}}}(),function(){"use strict";function a(){}var b=function(){};f.Canvas2dFilterBackend=a,a.prototype={evictCachesForKey:b,dispose:b,clearWebGLCaches:b,resources:{},applyFilters:function(a,b,c,d,e){var f=e.getContext("2d");f.drawImage(b,0,0,c,d);var g=f.getImageData(0,0,c,d),h=f.getImageData(0,0,c,d),i={sourceWidth:c,sourceHeight:d,imageData:g,originalEl:b,originalImageData:h,canvasEl:e,ctx:f,filterBackend:this};return a.forEach(function(a){a.applyTo(i)}),i.imageData.width===c&&i.imageData.height===d||(e.width=i.imageData.width,e.height=i.imageData.height),f.putImageData(i.imageData,0,0),i}}}(),f.Image.filters=f.Image.filters||{},f.Image.filters.BaseFilter=f.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aTexCoord;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var b in a)this[b]=a[b]},createProgram:function(a,b,c){if(this.vertexSource&&this.fragmentSource){var d=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(d,c||this.vertexSource),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw new Error('Vertex shader compile error for "${this.type}": '+a.getShaderInfoLog(d));var e=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(e,b||this.fragmentSource),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw new Error('Fragment shader compile error for "${this.type}": '+a.getShaderInfoLog(e));var f=a.createProgram();if(a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+a.getProgramInfoLog(f));var g=this.getAttributeLocations(a,f),h=this.getUniformLocations(a,f)||{};return h.uStepW=a.getUniformLocation(f,"uStepW"),h.uStepH=a.getUniformLocation(f,"uStepH"),{program:f,attributeLocations:g,uniformLocations:h}}},getAttributeLocations:function(a,b){return{aPosition:a.getAttribLocation(b,"aPosition"),aTexCoord:a.getAttribLocation(b,"aTexCoord")}},getUniformLocations:function(){},sendAttributeData:function(a,b,c){["aPosition","aTexCoord"].forEach(function(d){var e=b[d],f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f),a.enableVertexAttribArray(e),a.vertexAttribPointer(e,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW)})},_setupFrameBuffer:function(a){var b=a.context;a.passes>1?b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a.targetTexture,0):(b.bindFramebuffer(b.FRAMEBUFFER,null),b.finish())},_swapTextures:function(a){a.passes--,a.pass++;var b=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=b},isNeutralState:function(){return!1},applyTo:function(a){if(a.webgl){if(a.passes>1&&this.isNeutralState(a))return;this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)}else this.applyTo2d(a)},retrieveShader:function(a){return a.programCache.hasOwnProperty(this.type)||(a.programCache[this.type]=this.createProgram(a.context)),a.programCache[this.type]},applyToWebGL:function(a){var b=a.context,c=this.retrieveShader(a);0===a.pass&&a.originalTexture?b.bindTexture(b.TEXTURE_2D,a.originalTexture):b.bindTexture(b.TEXTURE_2D,a.sourceTexture),b.useProgram(c.program),this.sendAttributeData(b,c.attributeLocations,a.squareVertices),b.uniform1f(c.uniformLocations.uStepW,1/a.sourceWidth),b.uniform1f(c.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(b,c.uniformLocations),b.viewport(0,0,a.sourceWidth,a.sourceHeight),b.drawArrays(b.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(a,b,c){a.activeTexture(c),a.bindTexture(a.TEXTURE_2D,b),a.activeTexture(a.TEXTURE0)},unbindAdditionalTexture:function(a,b){a.activeTexture(b),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var b=document.createElement("canvas");b.width=a.sourceWidth,b.height=a.sourceHeight,a.helpLayer=b}},toObject:function(){var a={type:this.type},b=this.mainParameter;return b&&(a[b]=this[b]),a},toJSON:function(){return this.toObject()}}),f.Image.filters.BaseFilter.fromObject=function(a,b){var c=new f.Image.filters[a.type](a);return b&&b(c),c},function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.ColorMatrix=d(c.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(a){this.callSuper("initialize",a),this.matrix=this.matrix.slice(0)},applyTo2d:function(a){var b,c,d,e,f,g=a.imageData,h=g.data,i=h.length,j=this.matrix,k=this.colorsOnly;for(f=0;f<i;f+=4)b=h[f],c=h[f+1],d=h[f+2],k?(h[f]=b*j[0]+c*j[1]+d*j[2]+255*j[4],h[f+1]=b*j[5]+c*j[6]+d*j[7]+255*j[9],h[f+2]=b*j[10]+c*j[11]+d*j[12]+255*j[14]):(e=h[f+3],h[f]=b*j[0]+c*j[1]+d*j[2]+e*j[3]+255*j[4],h[f+1]=b*j[5]+c*j[6]+d*j[7]+e*j[8]+255*j[9],h[f+2]=b*j[10]+c*j[11]+d*j[12]+e*j[13]+255*j[14],h[f+3]=b*j[15]+c*j[16]+d*j[17]+e*j[18]+255*j[19])},getUniformLocations:function(a,b){return{uColorMatrix:a.getUniformLocation(b,"uColorMatrix"),uConstants:a.getUniformLocation(b,"uConstants")}},sendUniformData:function(a,b){var c=this.matrix,d=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],e=[c[4],c[9],c[14],c[19]];a.uniformMatrix4fv(b.uColorMatrix,!1,d),a.uniform4fv(b.uConstants,e)}}),b.Image.filters.ColorMatrix.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Brightness=d(c.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(a){if(0!==this.brightness){var b,c=a.imageData,d=c.data,e=d.length,f=Math.round(255*this.brightness);for(b=0;b<e;b+=4)d[b]=d[b]+f,d[b+1]=d[b+1]+f,d[b+2]=d[b+2]+f}},getUniformLocations:function(a,b){return{uBrightness:a.getUniformLocation(b,"uBrightness")}},sendUniformData:function(a,b){a.uniform1f(b.uBrightness,this.brightness)}}),b.Image.filters.Brightness.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Convolute=e(d.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(a){var b=Math.sqrt(this.matrix.length),c=this.type+"_"+b+"_"+this.opaque?1:0,d=this.fragmentSource[c];return a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,d)),a.programCache[c]},applyTo2d:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=a.imageData,p=o.data,q=this.matrix,r=Math.round(Math.sqrt(q.length)),s=Math.floor(r/2),t=o.width,u=o.height,v=a.ctx.createImageData(t,u),w=v.data,x=this.opaque?1:0;for(l=0;l<u;l++)for(k=0;k<t;k++){for(f=4*(l*t+k),b=0,c=0,d=0,e=0,n=0;n<r;n++)for(m=0;m<r;m++)h=l+n-s,g=k+m-s,h<0||h>u||g<0||g>t||(i=4*(h*t+g),j=q[n*r+m],b+=p[i]*j,c+=p[i+1]*j,d+=p[i+2]*j,x||(e+=p[i+3]*j));w[f]=b,w[f+1]=c,w[f+2]=d,x?w[f+3]=p[f+3]:w[f+3]=e}a.imageData=v},getUniformLocations:function(a,b){return{uMatrix:a.getUniformLocation(b,"uMatrix"),uOpaque:a.getUniformLocation(b,"uOpaque"),uHalfSize:a.getUniformLocation(b,"uHalfSize"),uSize:a.getUniformLocation(b,"uSize")}},sendUniformData:function(a,b){a.uniform1fv(b.uMatrix,this.matrix)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),b.Image.filters.Convolute.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Grayscale=d(c.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(a){var b,c,d=a.imageData,e=d.data,f=e.length,g=this.mode;for(b=0;b<f;b+=4)"average"===g?c=(e[b]+e[b+1]+e[b+2])/3:"lightness"===g?c=(Math.min(e[b],e[b+1],e[b+2])+Math.max(e[b],e[b+1],e[b+2]))/2:"luminosity"===g&&(c=.21*e[b]+.72*e[b+1]+.07*e[b+2]),e[b]=c,e[b+1]=c,e[b+2]=c},retrieveShader:function(a){var b=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return a.programCache.hasOwnProperty(b)||(a.programCache[b]=this.createProgram(a.context,c)),a.programCache[b]},getUniformLocations:function(a,b){return{uMode:a.getUniformLocation(b,"uMode")}},sendUniformData:function(a,b){var c=1;a.uniform1i(b.uMode,c)}}),b.Image.filters.Grayscale.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Invert=d(c.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(a){if(this.invert){var b,c=a.imageData,d=c.data,e=d.length;for(b=0;b<e;b+=4)d[b]=255-d[b],d[b+1]=255-d[b+1],d[b+2]=255-d[b+2]}},getUniformLocations:function(a,b){return{uInvert:a.getUniformLocation(b,"uInvert")}},sendUniformData:function(a,b){a.uniform1i(b.uInvert,this.invert)}}),b.Image.filters.Invert.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Noise=e(d.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(a){if(0!==this.noise){var b,c,d=a.imageData,e=d.data,f=e.length,g=this.noise;for(b=0,f=e.length;b<f;b+=4)c=(.5-Math.random())*g,e[b]+=c,e[b+1]+=c,e[b+2]+=c}},getUniformLocations:function(a,b){return{uNoise:a.getUniformLocation(b,"uNoise"),uSeed:a.getUniformLocation(b,"uSeed")}},sendUniformData:function(a,b){a.uniform1f(b.uNoise,this.noise/255),a.uniform1f(b.uSeed,Math.random())},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),b.Image.filters.Noise.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Pixelate=d(c.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(a){if(1!==this.blocksize){var b,c,d,e,f,g,h,i,j,k,l,m=a.imageData,n=m.data,o=m.height,p=m.width;for(c=0;c<o;c+=this.blocksize)for(d=0;d<p;d+=this.blocksize)for(b=4*c*p+4*d,e=n[b],f=n[b+1],g=n[b+2],h=n[b+3],k=Math.min(c+this.blocksize,o),l=Math.min(d+this.blocksize,p),i=c;i<k;i++)for(j=d;j<l;j++)b=4*i*p+4*j,n[b]=e,n[b+1]=f,n[b+2]=g,n[b+3]=h}},getUniformLocations:function(a,b){return{uBlocksize:a.getUniformLocation(b,"uBlocksize"),uStepW:a.getUniformLocation(b,"uStepW"),uStepH:a.getUniformLocation(b,"uStepH")}},sendUniformData:function(a,b){a.uniform1f(b.uBlocksize,this.blocksize)}}),b.Image.filters.Pixelate.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.RemoveColor=e(d.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(a){var c,d,e,f,g=a.imageData,h=g.data,i=255*this.distance,j=new b.Color(this.color).getSource(),k=[j[0]-i,j[1]-i,j[2]-i],l=[j[0]+i,j[1]+i,j[2]+i];for(c=0;c<h.length;c+=4)d=h[c],e=h[c+1],f=h[c+2],d>k[0]&&e>k[1]&&f>k[2]&&d<l[0]&&e<l[1]&&f<l[2]&&(h[c+3]=0)},getUniformLocations:function(a,b){return{uLow:a.getUniformLocation(b,"uLow"),uHigh:a.getUniformLocation(b,"uHigh")}},sendUniformData:function(a,c){var d=new b.Color(this.color).getSource(),e=parseFloat(this.distance),f=[0+d[0]/255-e,0+d[1]/255-e,0+d[2]/255-e,1],g=[d[0]/255+e,d[1]/255+e,d[2]/255+e,1];a.uniform4fv(c.uLow,f),a.uniform4fv(c.uHigh,g)},toObject:function(){
return c(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),b.Image.filters.RemoveColor.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass,e={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var f in e)c[f]=d(c.ColorMatrix,{type:f,matrix:e[f],mainParameter:!1,colorsOnly:!0}),b.Image.filters[f].fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric,c=b.Image.filters,d=b.util.createClass;c.BlendColor=d(c.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb *= uColor.rgb;\ngl_FragColor = color;\n}",screen:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb = 1.0 - (1.0 - color.rgb) * (1.0 - uColor.rgb);\ngl_FragColor = color;\n}",add:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb += uColor.rgb;\n}",diff:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n}",subtract:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb -= uColor.rgb;\n}",lighten:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n}",darken:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n}",exclusion:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n}",overlay:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n}",tint:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n}"},retrieveShader:function(a){var b=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return a.programCache.hasOwnProperty(b)||(a.programCache[b]=this.createProgram(a.context,c)),a.programCache[b]},applyTo2d:function(a){var c,d,e,f,g,h,i,j=a.imageData,k=j.data,l=k.length,m=1-this.alpha;i=new b.Color(this.color).getSource(),c=i[0]*this.alpha,d=i[1]*this.alpha,e=i[2]*this.alpha;for(var n=0;n<l;n+=4)switch(f=k[n],g=k[n+1],h=k[n+2],this.mode){case"multiply":k[n]=f*c/255,k[n+1]=g*d/255,k[n+2]=h*e/255;break;case"screen":k[n]=255-(255-f)*(255-c)/255,k[n+1]=255-(255-g)*(255-d)/255,k[n+2]=255-(255-h)*(255-e)/255;break;case"add":k[n]=f+c,k[n+1]=g+d,k[n+2]=h+e;break;case"diff":case"difference":k[n]=Math.abs(f-c),k[n+1]=Math.abs(g-d),k[n+2]=Math.abs(h-e);break;case"subtract":k[n]=f-c,k[n+1]=g-d,k[n+2]=h-e;break;case"darken":k[n]=Math.min(f,c),k[n+1]=Math.min(g,d),k[n+2]=Math.min(h,e);break;case"lighten":k[n]=Math.max(f,c),k[n+1]=Math.max(g,d),k[n+2]=Math.max(h,e);break;case"overlay":k[n]=c<128?2*f*c/255:255-2*(255-f)*(255-c)/255,k[n+1]=d<128?2*g*d/255:255-2*(255-g)*(255-d)/255,k[n+2]=e<128?2*h*e/255:255-2*(255-h)*(255-e)/255;break;case"exclusion":k[n]=c+f-2*c*f/255,k[n+1]=d+g-2*d*g/255,k[n+2]=e+h-2*e*h/255;break;case"tint":k[n]=c+f*m,k[n+1]=d+g*m,k[n+2]=e+h*m}},getUniformLocations:function(a,b){return{uColor:a.getUniformLocation(b,"uColor")}},sendUniformData:function(a,c){var d=new b.Color(this.color).getSource();d[0]=this.alpha*d[0]/255,d[1]=this.alpha*d[1]/255,d[2]=this.alpha*d[2]/255,d[3]=this.alpha,a.uniform4fv(c.uColor,d)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),b.Image.filters.BlendColor.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric,c=b.Image.filters,d=b.util.createClass;c.BlendImage=d(c.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aTexCoord;\nvTexCoord2 = (uTransformMatrix * vec3(aTexCoord, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(a){var b=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return a.programCache.hasOwnProperty(b)||(a.programCache[b]=this.createProgram(a.context,c)),a.programCache[b]},applyToWebGL:function(a){var b=a.context,c=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(b,c,b.TEXTURE1),this.callSuper("applyToWebGL",a),this.unbindAdditionalTexture(b,b.TEXTURE1)},createTexture:function(a,b){return a.getCachedTexture(b.cacheKey,b._element)},calculateMatrix:function(){var a=this.image,b=a._element.width,c=a._element.height;return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/b,-a.top/c,1]},applyTo2d:function(a){var b,c,d,e,f,g,h,i,j,k,l,m=a.imageData,n=a.filterBackend.resources,o=m.data,p=o.length,q=a.imageData.width,r=a.imageData.height,s=this.image;n.blendImage||(n.blendImage=document.createElement("canvas")),j=n.blendImage,j.width===q&&j.height===r||(j.width=q,j.height=r),k=j.getContext("2d"),k.setTransform(s.scaleX,0,0,s.scaleY,s.left,s.top),k.drawImage(s._element,0,0,q,r),l=k.getImageData(0,0,q,r).data;for(var t=0;t<p;t+=4)switch(f=o[t],g=o[t+1],h=o[t+2],i=o[t+3],b=l[t],c=l[t+1],d=l[t+2],e=l[t+3],this.mode){case"multiply":o[t]=f*b/255,o[t+1]=g*c/255,o[t+2]=h*d/255,o[t+3]=i*e/255;break;case"mask":o[t+3]=e}},getUniformLocations:function(a,b){return{uTransformMatrix:a.getUniformLocation(b,"uTransformMatrix"),uImage:a.getUniformLocation(b,"uImage")}},sendUniformData:function(a,b){var c=this.calculateMatrix();a.uniform1i(b.uImage,1),a.uniformMatrix3fv(b.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),b.Image.filters.BlendImage.fromObject=function(a,c){b.Image.fromObject(a.image,function(d){var e=b.util.object.clone(a);e.image=d,c(new b.Image.filters.BlendImage(e))})}}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=Math.pow,d=Math.floor,e=Math.sqrt,f=Math.abs,g=Math.round,h=Math.sin,i=Math.ceil,j=b.Image.filters,k=b.util.createClass;j.Resize=k(j.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo2d:function(a){var b=a.imageData,c=a.scaleX||this.scaleX,d=a.scaleY||this.scaleY;if(1!==c||1!==d){this.rcpScaleX=1/c,this.rcpScaleY=1/d;var e,f=b.width,h=b.height,i=g(f*c),j=g(h*d);"sliceHack"===this.resizeType?e=this.sliceByTwo(a,f,h,i,j):"hermite"===this.resizeType?e=this.hermiteFastResize(a,f,h,i,j):"bilinear"===this.resizeType?e=this.bilinearFiltering(a,f,h,i,j):"lanczos"===this.resizeType&&(e=this.lanczosResize(a,f,h,i,j)),a.imageData=e}},sliceByTwo:function(a,c,e,f,g){var h,i,j=a.imageData,k=.5,l=!1,m=!1,n=c*k,o=e*k,p=b.filterBackend.resources,q=0,r=0,s=c,t=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),h=p.sliceByTwo,(h.width<1.5*c||h.height<e)&&(h.width=1.5*c,h.height=e),i=h.getContext("2d"),i.clearRect(0,0,1.5*c,e),i.putImageData(j,0,0),f=d(f),g=d(g);!l||!m;)c=n,e=o,f<d(n*k)?n=d(n*k):(n=f,l=!0),g<d(o*k)?o=d(o*k):(o=g,m=!0),i.drawImage(h,q,r,c,e,s,t,n,o),q=s,r=t,t+=o;return i.getImageData(q,r,f,g)},lanczosResize:function(a,b,g,j,k){function l(a){return function(b){if(b>a)return 0;if(b*=Math.PI,f(b)<1e-16)return 1;var c=b/a;return h(b)*h(c)/b/c}}function m(a){var h,i,l,A,B,C,D,E,F,G,H;for(y.x=(a+.5)*r,z.x=d(y.x),h=0;h<k;h++){for(y.y=(h+.5)*s,z.y=d(y.y),B=0,C=0,D=0,E=0,F=0,i=z.x-v;i<=z.x+v;i++)if(!(i<0||i>=b)){G=d(1e3*f(i-y.x)),x[G]||(x[G]={});for(var I=z.y-w;I<=z.y+w;I++)I<0||I>=g||(H=d(1e3*f(I-y.y)),x[G][H]||(x[G][H]=q(e(c(G*t,2)+c(H*u,2))/1e3)),l=x[G][H],l>0&&(A=4*(I*b+i),B+=l,C+=l*n[A],D+=l*n[A+1],E+=l*n[A+2],F+=l*n[A+3]))}A=4*(h*j+a),p[A]=C/B,p[A+1]=D/B,p[A+2]=E/B,p[A+3]=F/B}return++a<j?m(a):o}var n=a.imageData.data,o=a.ctx.creteImageData(j,k),p=o.data,q=l(this.lanczosLobes),r=this.rcpScaleX,s=this.rcpScaleY,t=2/this.rcpScaleX,u=2/this.rcpScaleY,v=i(r*this.lanczosLobes/2),w=i(s*this.lanczosLobes/2),x={},y={},z={};return m(0)},bilinearFiltering:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t=0,u=this.rcpScaleX,v=this.rcpScaleY,w=4*(b-1),x=a.imageData,y=x.data,z=a.ctx.createImageData(e,f),A=z.data;for(m=0;m<f;m++)for(n=0;n<e;n++)for(k=d(u*n),l=d(v*m),o=u*n-k,p=v*m-l,s=4*(l*b+k),q=0;q<4;q++)g=y[s+q],h=y[s+4+q],i=y[s+w+q],j=y[s+w+4+q],r=g*(1-o)*(1-p)+h*o*(1-p)+i*p*(1-o)+j*o*p,A[t++]=r;return z},hermiteFastResize:function(a,b,c,g,h){for(var j=this.rcpScaleX,k=this.rcpScaleY,l=i(j/2),m=i(k/2),n=a.imageData,o=n.data,p=a.ctx.createImageData(g,h),q=p.data,r=0;r<h;r++)for(var s=0;s<g;s++){for(var t=4*(s+r*g),u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=(r+.5)*k,C=d(r*k);C<(r+1)*k;C++)for(var D=f(B-(C+.5))/m,E=(s+.5)*j,F=D*D,G=d(s*j);G<(s+1)*j;G++){var H=f(E-(G+.5))/l,I=e(F+H*H);I>1&&I<-1||(u=2*I*I*I-3*I*I+1,u>0&&(H=4*(G+C*b),A+=u*o[H+3],w+=u,o[H+3]<255&&(u=u*o[H+3]/250),x+=u*o[H],y+=u*o[H+1],z+=u*o[H+2],v+=u))}q[t]=x/v,q[t+1]=y/v,q[t+2]=z/v,q[t+3]=A/w}return p},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),b.Image.filters.Resize.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Contrast=d(c.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(a){if(0!==this.contrast){var b,c,d=a.imageData,e=d.data,c=e.length,f=Math.floor(255*this.contrast),g=259*(f+255)/(255*(259-f));for(b=0;b<c;b+=4)e[b]=g*(e[b]-128)+128,e[b+1]=g*(e[b+1]-128)+128,e[b+2]=g*(e[b+2]-128)+128}},getUniformLocations:function(a,b){return{uContrast:a.getUniformLocation(b,"uContrast")}},sendUniformData:function(a,b){a.uniform1f(b.uContrast,this.contrast)}}),b.Image.filters.Contrast.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Saturation=d(c.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(a){if(0!==this.saturation){var b,c,d=a.imageData,e=d.data,f=e.length,g=-this.saturation;for(b=0;b<f;b+=4)c=Math.max(e[b],e[b+1],e[b+2]),e[b]+=c!==e[b]?(c-e[b])*g:0,e[b+1]+=c!==e[b+1]?(c-e[b+1])*g:0,e[b+2]+=c!==e[b+2]?(c-e[b+2])*g:0}},getUniformLocations:function(a,b){return{uSaturation:a.getUniformLocation(b,"uSaturation")}},sendUniformData:function(a,b){a.uniform1f(b.uSaturation,-this.saturation)}}),b.Image.filters.Saturation.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Blur=d(c.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(a){a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},applyTo2d:function(a){a.imageData=this.simpleBlur(a)},simpleBlur:function(a){var b,c,d=a.filterBackend.resources,e=a.imageData.width,f=a.imageData.height;d.blurLayer1||(d.blurLayer1=document.createElement("canvas"),d.blurLayer2=document.createElement("canvas")),b=d.blurLayer1,c=d.blurLayer2,b.width===e&&b.height===f||(c.width=b.width=e,c.height=b.height=f);var g,h,i,j,k=b.getContext("2d"),l=c.getContext("2d"),m=15,n=.06*this.blur*.5;for(k.putImageData(a.imageData,0,0),l.clearRect(0,0,e,f),j=-m;j<=m;j++)g=(Math.random()-.5)/4,h=j/m,i=n*h*e+g,l.globalAlpha=1-Math.abs(h),l.drawImage(b,i,g),k.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);for(j=-m;j<=m;j++)g=(Math.random()-.5)/4,h=j/m,i=n*h*f+g,l.globalAlpha=1-Math.abs(h),l.drawImage(b,g,i),k.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);a.ctx.drawImage(b,0,0);var o=a.ctx.getImageData(0,0,b.width,b.height);return k.globalAlpha=1,k.clearRect(0,0,b.width,b.height),o},getUniformLocations:function(a,b){return{delta:a.getUniformLocation(b,"uDelta")}},sendUniformData:function(a,b){var c=this.chooseRightDelta();a.uniform2fv(b.delta,c)},chooseRightDelta:function(){var a,b=1,c=[0,0];return this.horizontal?this.aspectRatio>1&&(b=1/this.aspectRatio):this.aspectRatio<1&&(b=this.aspectRatio),a=b*this.blur*.12,this.horizontal?c[0]=a:c[1]=a,c}}),c.Blur.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Gamma=d(c.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",applyTo2d:function(a){var b,c=a.imageData,d=c.data,e=this.gamma,f=d.length,g=1/e[0],h=1/e[1],i=1/e[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),b=0,f=256;b<f;b++)this.rVals[b]=255*Math.pow(b/255,g),this.gVals[b]=255*Math.pow(b/255,h),this.bVals[b]=255*Math.pow(b/255,i);for(b=0,f=d.length;b<f;b+=4)d[b]=this.rVals[d[b]],d[b+1]=this.gVals[d[b+1]],d[b+2]=this.bVals[d[b+2]]},getUniformLocations:function(a,b){return{uGamma:a.getUniformLocation(b,"uGamma")}},sendUniformData:function(a,b){a.uniform3fv(b.uGamma,this.gamma)}}),b.Image.filters.Gamma.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Composed=d(c.BaseFilter,{type:"Composed",subFilters:[],initialize:function(a){this.callSuper("initialize",a),this.subFilters=this.subFilters.slice(0)},applyTo:function(a){a.passes+=this.subFilters.length-1,this.subFilters.forEach(function(b){b.applyTo(a)})},toObject:function(){return b.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(a){return a.toObject()})})}}),b.Image.filters.Composed.fromObject=function(a,c){var d=a.subFilters||[],e=d.map(function(a){return new b.Image.filters[a.type](a)}),f=new b.Image.filters.Composed({subFilters:e});return c&&c(f),f}}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.HueRotation=d(c.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var a=this.rotation*Math.PI,b=Math.cos(a),c=Math.sin(a),d=1/3,e=Math.sqrt(d)*c,f=1-b;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=b+f/3,this.matrix[1]=d*f-e,this.matrix[2]=d*f+e,this.matrix[5]=d*f+e,this.matrix[6]=b+d*f,this.matrix[7]=d*f-e,this.matrix[10]=d*f-e,this.matrix[11]=d*f+e,this.matrix[12]=b+d*f},applyTo:function(a){this.calculateMatrix(),b.Image.filters.BaseFilter.prototype.applyTo.call(this,a)}}),b.Image.filters.HueRotation.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!=typeof c?c:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.clone,d=2,e=200;if(b.Text)return void b.warn("fabric.Text is already defined");var f=b.Object.prototype.stateProperties.concat();f.push("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles");var g=b.Object.prototype.cacheProperties.concat();g.push("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stateProperties:f,cacheProperties:g,stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough"],__charBounds:[],initialize:function(a,b){this.styles=b?b.styles||{}:{},this.text="",this.__skipDimension=!0,this.callSuper("initialize",b),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return b._measuringContext||(b._measuringContext=this.canvas&&this.canvas.contextCache||b.util.createCanvasElement().getContext("2d")),b._measuringContext},isEmptyStyles:function(a){if(!this.styles)return!0;if("undefined"!=typeof a&&!this.styles[a])return!0;var b="undefined"==typeof a?this.styles:{line:this.styles[a]};for(var c in b)for(var d in b[c])for(var e in b[c][d])return!1;return!0},styleHas:function(a,b){if(!this.styles||!a||""===a)return!1;if("undefined"!=typeof b&&!this.styles[b])return!1;var c="undefined"==typeof b?this.styles:{line:this.styles[b]};for(var d in c)for(var e in c[d])if("undefined"!=typeof c[d][e][a])return!0;return!1},cleanStyle:function(a){if(!this.styles||!a||""===a)return!1;var b,c,d=this.styles,e=0,f=!1,g=!0,h=0;for(var i in d){b=0;for(var j in d[i])e++,f?d[i][j][a]!==c&&(g=!1):(c=d[i][j][a],f=!0),d[i][j][a]===this[a]&&delete d[i][j][a],0!==Object.keys(d[i][j]).length?b++:delete d[i][j];0===b&&delete d[i]}for(var k=0;k<this._textLines.length;k++)h+=this._textLines[k].length;g&&e===h&&(this[a]=c,this.removeStyle(a))},removeStyle:function(a){if(this.styles&&a&&""!==a){var b,c,d,e=this.styles;for(c in e){b=e[c];for(d in b)delete b[d][a],0===Object.keys(b[d]).length&&delete b[d];0===Object.keys(b).length&&delete e[c]}}},_extendStyles:function(a,c){var d=this.get2DCursorLocation(a);this._getLineStyle(d.lineIndex)||this._setLineStyle(d.lineIndex,{}),this._getStyleDeclaration(d.lineIndex,d.charIndex)||this._setStyleDeclaration(d.lineIndex,d.charIndex,{}),b.util.object.extend(this._getStyleDeclaration(d.lineIndex,d.charIndex),c)},initDimensions:function(){if(!this.__skipDimension){var a=this._splitTextIntoLines(this.text);this.textLines=a.lines,this._unwrappedTextLines=a._unwrappedLines,this._textLines=a.graphemeLines,this._text=a.graphemeText,this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||d,"justify"===this.textAlign&&this.enlargeSpaces(),this.height=this.calcTextHeight()}},enlargeSpaces:function(){for(var a,b,c,d,e,f,g,h=0,i=this._textLines.length;h<i;h++)if(d=0,e=this._textLines[h],b=this.getLineWidth(h),b<this.width&&(g=this.textLines[h].match(this._reSpacesAndTabs))){c=g.length,a=(this.width-b)/c;for(var j=0,k=e.length;j<=k;j++)f=this.__charBounds[h][j],this._reSpaceAndTab.test(e[j])?(f.width+=a,f.kernedWidth+=a,f.left+=d,d+=a):f.left+=d}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var a=this.callSuper("_getCacheCanvasDimensions"),b=this.fontSize;return a.width+=b*a.zoomX,a.height+=b*a.zoomY,a},_render:function(a){this._setTextStyles(a),this._renderTextLinesBackground(a),this._renderTextDecoration(a,"underline"),this._renderText(a),this._renderTextDecoration(a,"overline"),this._renderTextDecoration(a,"linethrough")},_renderText:function(a){this._renderTextFill(a),this._renderTextStroke(a)},_setTextStyles:function(a,b,c){a.textBaseline="alphabetic",a.font=this._getFontDeclaration(b,c)},calcTextWidth:function(){for(var a=this.getLineWidth(0),b=1,c=this._textLines.length;b<c;b++){var d=this.getLineWidth(b);d>a&&(a=d)}return a},_renderTextLine:function(a,b,c,d,e,f){this._renderChars(a,b,c,d,e,f)},_renderTextLinesBackground:function(a){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var b,c,d,e,f,g,h=0,i=a.fillStyle,j=this._getLeftOffset(),k=this._getTopOffset(),l=0,m=0,n=0,o=this._textLines.length;n<o;n++)if(b=this.getHeightOfLine(n),this.textBackgroundColor||this.styleHas("textBackgroundColor",n)){d=this._textLines[n],c=this._getLineLeftOffset(n),m=0,l=0,e=this.getValueOfPropertyAt(n,0,"textBackgroundColor");for(var p=0,q=d.length;p<q;p++)f=this.__charBounds[n][p],g=this.getValueOfPropertyAt(n,p,"textBackgroundColor"),g!==e?(a.fillStyle=e,e&&a.fillRect(j+c+l,k+h,m,b/this.lineHeight),l=f.left,m=f.width,e=g):m+=f.kernedWidth;g&&(a.fillStyle=g,a.fillRect(j+c+l,k+h,m,b/this.lineHeight)),h+=b}else h+=b;a.fillStyle=i,this._removeShadow(a)}},getFontCache:function(a){var c=a.fontFamily.toLowerCase();b.charWidthsCache[c]||(b.charWidthsCache[c]={});var d=b.charWidthsCache[c],e=a.fontStyle.toLowerCase()+"_"+(a.fontWeight+"").toLowerCase();return d[e]||(d[e]={}),d[e]},_applyCharStyles:function(a,b,c,d,e){this._setFillStyles(b,e),this._setStrokeStyles(b,e),b.font=this._getFontDeclaration(e)},_getStyleDeclaration:function(a,b){var c=this.styles&&this.styles[a];return c?c[b]:null},getCompleteStyleDeclaration:function(a,b){for(var c,d=this._getStyleDeclaration(a,b)||{},e={},f=0;f<this._styleProperties.length;f++)c=this._styleProperties[f],e[c]="undefined"==typeof d[c]?this[c]:d[c];return e},_setStyleDeclaration:function(a,b,c){this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){delete this.styles[a][b]},_getLineStyle:function(a){return this.styles[a]},_setLineStyle:function(a,b){this.styles[a]=b},_deleteLineStyle:function(a){delete this.styles[a]},_measureChar:function(a,b,c,d){var f,g,h,i,j=this.getFontCache(b),k=this._getFontDeclaration(b),l=this._getFontDeclaration(d),m=c+a,n=k===l,o=b.fontSize/e;if(c&&j[c]&&(h=j[c]),j[a]&&(i=f=j[a]),n&&j[m]&&(g=j[m],i=g-h),!f||!h||!g){var p=this.getMeasuringContext();this._setTextStyles(p,b,!0)}if(f||(i=f=p.measureText(a).width,j[a]=f),!h&&n&&c&&(h=p.measureText(c).width,j[c]=h),n&&!g&&(g=p.measureText(m).width,j[m]=g,i=g-h,i>f)){var q=i-f;j[a]=i,j[m]+=q,f=i}return{width:f*o,kernedWidth:i*o}},getHeightOfChar:function(a,b){return this.getValueOfPropertyAt(a,b,"fontSize")},measureLine:function(a){var b=this._measureLine(a);return 0!==this.charSpacing&&(b.width-=this._getWidthOfCharSpacing()),b.width<0&&(b.width=0),b},_measureLine:function(a){var b,c,d,e,f=0,g=this._textLines[a],h=0,i=new Array(g.length);for(this.__charBounds[a]=i,b=0;b<g.length;b++)c=g[b],e=this._getGraphemeBox(c,a,b,d),i[b]=e,f+=e.kernedWidth,d=c;return i[b]={left:e?e.left+e.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:f,numOfSpaces:h}},_getGraphemeBox:function(a,b,c,d,e){var f=this.getCompleteStyleDeclaration(b,c),g=d?this.getCompleteStyleDeclaration(b,c-1):{},h=this._measureChar(a,f,d,g),i=h.kernedWidth,j=h.width;0!==this.charSpacing&&(j+=this._getWidthOfCharSpacing(),i+=this._getWidthOfCharSpacing());var k={width:j,left:0,height:f.fontSize,kernedWidth:i};if(c>0&&!e){var l=this.__charBounds[b][c-1];k.left=l.left+l.width+h.kernedWidth-h.width}return k},getHeightOfLine:function(a){if(this.__lineHeights[a])return this.__lineHeights[a];for(var b=this._textLines[a],c=this.getHeightOfChar(a,0),d=1,e=b.length;d<e;d++){var f=this.getHeightOfChar(a,d);f>c&&(c=f)}return this.__lineHeights[a]=c*this.lineHeight*this._fontSizeMult,this.__lineHeights[a]},calcTextHeight:function(){for(var a,b=0,c=0,d=this._textLines.length;c<d;c++)a=this.getHeightOfLine(c),b+=c===d-1?a/this.lineHeight:a;return b},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(a,b){for(var c=0,d=this._getLeftOffset(),e=this._getTopOffset(),f=0,g=this._textLines.length;f<g;f++){var h=this.getHeightOfLine(f),i=h/this.lineHeight,j=this._getLineLeftOffset(f);this._renderTextLine(b,a,this._textLines[f],d+j,e+c+i,f),c+=h}},_renderTextFill:function(a){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())},_renderChars:function(a,b,c,d,e,f){var g,h,i,j,k=this.getHeightOfLine(f),l="",m=0;b.save(),e-=k*this._fontSizeFraction/this.lineHeight;for(var n=0,o=c.length-1;n<=o;n++)j=n===o||this.charSpacing,l+=c[n],i=this.__charBounds[f][n],0===m&&(d+=i.kernedWidth-i.width),m+=i.kernedWidth,"justify"!==this.textAlign||j||this._reSpaceAndTab.test(c[n])&&(j=!0),j||(g=g||this.getCompleteStyleDeclaration(f,n),h=this.getCompleteStyleDeclaration(f,n+1),j=this._hasStyleChanged(g,h)),j&&(this._renderChar(a,b,f,n,l,d,e,k),l="",g=h,d+=m,m=0);b.restore()},_renderChar:function(a,b,c,d,e,f,g){var h=this._getStyleDeclaration(c,d),i=this.getCompleteStyleDeclaration(c,d),j="fillText"===a&&i.fill,k="strokeText"===a&&i.stroke&&i.strokeWidth;(k||j)&&(h&&b.save(),this._applyCharStyles(a,b,c,d,i),h&&h.textBackgroundColor&&this._removeShadow(b),j&&b.fillText(e,f,g),k&&b.strokeText(e,f,g),h&&b.restore())},_hasStyleChanged:function(a,b){return a.fill!==b.fill||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth||a.fontSize!==b.fontSize||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle},_getLineLeftOffset:function(a){var b=this.getLineWidth(a);return"center"===this.textAlign?(this.width-b)/2:"right"===this.textAlign?this.width-b:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__numberOfSpaces=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var a=this._forceClearCache;return a||(a=this.hasStateChanged("_dimensionAffectingProps")),a&&(this.saveState({propertySet:"_dimensionAffectingProps"}),this.dirty=!0,this._forceClearCache=!1),a},getLineWidth:function(a){if(this.__lineWidths[a])return this.__lineWidths[a];var b,c,d=this._textLines[a];return""===d?b=0:(c=this.measureLine(a),b=c.width),this.__lineWidths[a]=b,this.__numberOfSpaces[a]=c.numberOfSpaces,b},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(a,b,c){var d=this._getStyleDeclaration(a,b),e=d&&"undefined"!=typeof d[c];return e?d[c]:this[c]},_renderTextDecoration:function(a,b){if(this[b]||this.styleHas(b)){for(var c,d,e,f,g,h,i,j,k,l,m,n=this._getLeftOffset(),o=this._getTopOffset(),p=0,q=this._textLines.length;p<q;p++)if(c=this.getHeightOfLine(p),this[b]||this.styleHas(b,p)){e=this._textLines[p],k=c/this.lineHeight,d=this._getLineLeftOffset(p),g=0,h=0,f=this.getValueOfPropertyAt(p,0,b),m=this.getValueOfPropertyAt(p,0,"fill");for(var r=0,s=e.length;r<s;r++)i=this.__charBounds[p][r],j=this.getValueOfPropertyAt(p,r,b),l=this.getValueOfPropertyAt(p,r,"fill"),(j!==f||l!==m)&&h>0?(a.fillStyle=m,f&&m&&a.fillRect(n+d+g,o+k*(1-this._fontSizeFraction)+this.offsets[b]*this.fontSize,h,this.fontSize/15),g=i.left,h=i.width,f=j,m=l):h+=i.kernedWidth;a.fillStyle=l,j&&l&&a.fillRect(n+d+g,o+k*(1-this._fontSizeFraction)+this.offsets[b]*this.fontSize,h,this.fontSize/15),o+=c}else o+=c;this._removeShadow(a)}},_getFontDeclaration:function(a,c){var d=a||this;return[b.isLikelyNode?d.fontWeight:d.fontStyle,b.isLikelyNode?d.fontStyle:d.fontWeight,c?e+"px":d.fontSize+"px",b.isLikelyNode?'"'+d.fontFamily+'"':d.fontFamily].join(" ")},render:function(a){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",a)));
},_splitTextIntoLines:function(a){for(var c=a.split(this._reNewline),d=new Array(c.length),e=["\n"],f=[],g=0;g<c.length;g++)d[g]=b.util.string.graphemeSplit(c[g]),f=f.concat(d[g],e);return f.pop(),{_unwrappedLines:d,lines:c,graphemeText:f,graphemeLines:d}},toObject:function(a){var b=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(a),d=this.callSuper("toObject",b);return d.styles=c(this.styles,!0),d},_set:function(a,b){this.callSuper("_set",a,b),this._dimensionAffectingProps.indexOf(a)>-1&&(this.initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,d,e){if(!a)return d(null);var f=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES),g=f.textAnchor||"left";if(e=b.util.object.extend(e?c(e):{},f),e.top=e.top||0,e.left=e.left||0,f.textDecoration){var h=f.textDecoration;h.indexOf("underline")!==-1&&(e.underline=!0),h.indexOf("overline")!==-1&&(e.overline=!0),h.indexOf("line-through")!==-1&&(e.linethrough=!0),delete e.textDecoration}"dx"in f&&(e.left+=f.dx),"dy"in f&&(e.top+=f.dy),"fontSize"in e||(e.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE);var i="";"textContent"in a?i=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(i=a.firstChild.data),i=i.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var j=new b.Text(i,e),k=j.getScaledHeight()/j.height,l=(j.height+j.strokeWidth)*j.lineHeight-j.height,m=l*k,n=j.getScaledHeight()+m,o=0;"center"===g&&(o=j.getScaledWidth()/2),"right"===g&&(o=j.getScaledWidth()),j.set({left:j.left-o,top:j.top-(n-j.fontSize*(.18+j._fontSizeFraction))/j.lineHeight}),d(j)},b.Text.fromObject=function(a,c){return b.Object._fromObject("Text",a,c,"text")},b.util.createAccessors&&b.util.createAccessors(b.Text)}("undefined"!=typeof c?c:this)}).call(this,a("buffer").Buffer)},{buffer:3,jsdom:2}]},{},[6])(6)});